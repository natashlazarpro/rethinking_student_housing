<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>2.4 Global Spatial Autocorrelation - Rethinking Student Housing in Berlin</title><meta property="og:title" content="2.4 Global Spatial Autocorrelation - Rethinking Student Housing in Berlin"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/rethinking_student_housing/build/_assets/app-OIHP3NGU.css"/><link rel="stylesheet" href="/rethinking_student_housing/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/rethinking_student_housing/favicon.ico"/><link rel="stylesheet" href="/rethinking_student_housing/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/rethinking_student_housing/"><div class="myst-home-link-logo mr-3 flex items-center dark:bg-white dark:rounded px-1"><img src="/rethinking_student_housing/build/logo-18e48197487fb9b98f6d8e7252c859f7.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="Rethinking Student Housing in Berlin" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/rethinking_student_housing/">Rethinking Student Housing in Berlin</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="0. Prelimitary Pages" class="block break-words rounded py-2 grow cursor-pointer">0. Prelimitary Pages</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="1. Introduction" class="block break-words rounded py-2 grow cursor-pointer">1. Introduction</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2. Capacities, Demand &amp; Spatial Distribution" class="block break-words rounded py-2 grow cursor-pointer">2. Capacities, Demand &amp; Spatial Distribution</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="3. Student Housing Market Imbalance" class="block break-words rounded py-2 grow cursor-pointer">3. Student Housing Market Imbalance</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="4. Students Behind the Numbers" class="block break-words rounded py-2 grow cursor-pointer">4. Students Behind the Numbers</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="5. Data-Driven Decisions" class="block break-words rounded py-2 grow cursor-pointer">5. Data-Driven Decisions</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="6. Appendix" class="block break-words rounded py-2 grow cursor-pointer">6. Appendix</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/natashlazarpro/rethinking_student_housing" title="GitHub Repository: natashlazarpro/rethinking_student_housing" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/natashlazarpro/rethinking_student_housing/edit/main/student-housing-book/notebooks/2.4_global_spatial_autocorrelation.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">2.4 Global Spatial Autocorrelation</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block myst-fm-author-comma text-comma"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:Rb8ucp:" data-state="closed"><span class="myst-fm-author-name">Lazareva Nataliia</span></button></span><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block myst-fm-author-comma text-comma"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:Rd8ucp:" data-state="closed"><span class="myst-fm-author-name">Urban Design M.Sc.</span></button></span><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:Rf8ucp:" data-state="closed"><span class="myst-fm-author-name">Technical University of Berlin</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="FTWalqFRYr" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import warnings

warnings.filterwarnings(&quot;ignore&quot;)

import os
hf = r&#x27;../outputs/2.4_global_spatial_autocorrelation/&#x27;
os.makedirs(hf, exist_ok=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="7j_jzGDleFDnDJUckLZvT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="g1jqZjezAW" class="myst-jp-nb-block relative group/block"><h1 id="id-2-4-global-spatial-autocorrelation" class="relative group"><span class="heading-text">2.4 Global Spatial Autocorrelation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-4-global-spatial-autocorrelation" title="Link to this Section" aria-label="Link to this Section">¶</a></h1></div><div id="jBnJOop23e" class="myst-jp-nb-block relative group/block"><p>In the Descriptive Market Statistics Chapter, a descriptive analysis of two datasets was conducted: student accommodations and higher education universities. However, in order to access spatial distribution across cities, it is necessary to measure spatial dependency.</p><p>Spatial autocorrelation measures spatial dependency. In other words, how much the value of a variable in a specific location is related to the values of the same variable at neighboring locations. Spatial autocorrelation (either positive or negative) is a key concept in geographic analysis. Spatial autocorrelation can be explained by the first law of geography. According to the law, objects in a neighborhood tend to have more similarities and interactions than those lying further away (Grekousis, 2020).</p></div><div id="ns5gcIMZFz" class="myst-jp-nb-block relative group/block"><h3 id="set-up" class="relative group"><span class="heading-text">Set Up</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#set-up" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="rzZomLaits" class="myst-jp-nb-block relative group/block"><p>Import Libraries</p></div><div id="rW3OOcn70U" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
import numpy as np  
import pandas as pd 
import matplotlib.pyplot as plt  
import matplotlib as mpl 
import seaborn as sns 
from matplotlib.colors import LinearSegmentedColormap  
import matplotlib.patches as mpatches  
import matplotlib.patheffects as path_effects  
import geopandas as gpd  
from shapely.geometry import Point, MultiPoint  
from pyproj import CRS  
from scipy.stats import norm 
import libpysal  
from esda import Moran 
from libpysal.weights.spatial_lag import lag_spatial 
from libpysal.weights import KNN 
from libpysal.weights import weights</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3wEyWxky0WKjlD1WEQtVT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="PL7I8y5kRa" class="myst-jp-nb-block relative group/block hidden"><p>Colors</p></div><div id="fkpRWp4mZ1" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">color_palettes = {
    &quot;Mint&quot;: [&quot;#EAF4E8&quot;, &quot;#C8E0D4&quot;, &quot;#A9CCC1&quot;, &quot;#8FB9AE&quot;, &quot;#76A79D&quot;, &quot;#5F968E&quot;, &quot;#498581&quot;], 
    &quot;Pi&quot;: [&quot;#F8EDEB&quot;, &quot;#FAE1DD&quot;, &quot;#FCD5CE&quot;, &quot;#FEC5BB&quot;, &quot;#F8AD9D&quot;, &quot;#F4978E&quot;, &quot;#F08080&quot;],
    &quot;Or&quot;: [&quot;#FFE5D9&quot;, &quot;#FFD7BA&quot;, &quot;#FEC89A&quot;, &quot;#FFB78F&quot;, &quot;#F49F7D&quot;, &quot;#F28B6D&quot;, &quot;#E1755CFF&quot;],
    &quot;GrSc&quot;:  [&#x27;#EFEFEF&#x27;, &#x27;#D9D9D9&#x27;, &#x27;#CCCCCC&#x27;, &#x27;#B7B7B7&#x27;, &#x27;#999999&#x27;, &#x27;#666666&#x27;, &#x27;#434343&#x27;],
    &quot;MintPi&quot;: [&quot;#76A79D&quot;, &quot;#8FB9AE&quot;, &quot;#A9CCC1&quot;, &quot;#C8E0D4&quot;, &quot;#FBF0EA&quot;, &quot;#FCD5CE&quot;, &quot;#FEC5BB&quot;, &quot;#F8AD9D&quot;, &quot;#F4978E&quot;],
    &quot;MintOr&quot;: [&quot;#76A79D&quot;, &quot;#8FB9AE&quot;, &quot;#A9CCC1&quot;, &quot;#C8E0D4&quot;, &quot;#FBF0EA&quot;, &quot;#FFD7BA&quot;, &quot;#FEC89A&quot;, &quot;#FFB78F&quot;, &quot;#F28B6D&quot;],
    &quot;MiPiOr&quot;: [&#x27;#EAF4E8&#x27;, &#x27;#FAE1DD&#x27;, &#x27;#C8E0D4&#x27;, &#x27;#FFD7BA&#x27;, &#x27;#F8EDEB&#x27;, &#x27;#FCD5CE&#x27;, &#x27;#FFE5D9&#x27;]
} 

from matplotlib.colors import LinearSegmentedColormap

cmap_mint = LinearSegmentedColormap.from_list(&quot;Mint&quot;, color_palettes[&quot;Mint&quot;])
cmap_pi = LinearSegmentedColormap.from_list(&quot;Pi&quot;, color_palettes[&quot;Pi&quot;])
cmap_or = LinearSegmentedColormap.from_list(&quot;Or&quot;, color_palettes[&quot;Or&quot;])
cmap_mintpi = LinearSegmentedColormap.from_list(&quot;MintPi&quot;, color_palettes[&quot;MintPi&quot;])
cmap_mintor = LinearSegmentedColormap.from_list(&quot;MintOr&quot;, color_palettes[&quot;MintOr&quot;])
cmap_grsc = LinearSegmentedColormap.from_list(&quot;GrSc&quot;, color_palettes[&quot;GrSc&quot;])
cmap_mipior = LinearSegmentedColormap.from_list(&quot;MiPiOr&quot;, color_palettes[&quot;MiPiOr&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="rgHRrdghTlcmJJVuhbqc0" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="VY6vPi6TCL" class="myst-jp-nb-block relative group/block hidden"><p>Font</p></div><div id="L5uesGEqu7" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plt.rcParams[&quot;font.family&quot;] = &quot;Helvetica&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ahiKc_9b0OL2natnZxpzm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="YFKOJ5qIQs" class="myst-jp-nb-block relative group/block"><p>Berlin Spatial Boundaries</p></div><div id="K4724uOZyD" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">pf = r&quot;../inputs/2.4_global_spatial_autocorrelation/lor_pgr.gpkg&quot;
pgr = gpd.read_file(pf)
pgr.replace({&#x27;-&#x27;: np.nan, 0: np.nan, &#x27;&#x27;: np.nan}, inplace=True)

bf = r&quot;../inputs/2.4_global_spatial_autocorrelation/adm_bz.gpkg&quot;
bz = gpd.read_file(bf)
bz.replace({&#x27;-&#x27;: np.nan, 0: np.nan, &#x27;&#x27;: np.nan}, inplace=True)

of = r&quot;../inputs/2.4_global_spatial_autocorrelation/adm_out.gpkg&quot;
out = gpd.read_file(of)
out.replace({&#x27;-&#x27;: np.nan, 0: np.nan, &#x27;&#x27;: np.nan}, inplace=True)

mf = r&quot;../inputs/2.4_global_spatial_autocorrelation/berlin_mauer.gpkg&quot;
mauer = gpd.read_file(mf)
mauer.replace({&#x27;-&#x27;: np.nan, 0: np.nan, &#x27;&#x27;: np.nan}, inplace=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GVgxhOqQ9zmNmQcHtC9wL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="sZhOxSZGSZ" class="myst-jp-nb-block relative group/block"><h1 id="student-accommodation-capacity" class="relative group"><span class="heading-text">Student Accommodation Capacity</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#student-accommodation-capacity" title="Link to this Section" aria-label="Link to this Section">¶</a></h1></div><div id="uHZ987bUZn" class="myst-jp-nb-block relative group/block"><h2 id="data-import" class="relative group"><span class="heading-text">Data Import</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data-import" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="nOiWUUV7ZC" class="myst-jp-nb-block relative group/block"><p>The data obtained as a result of Urban Data Mining was used as input data for the analysis (since no changes were made to the data during Descriptive Market Statistics).</p></div><div id="p8aW9XeBH8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">pf = r&quot;../inputs/2.4_global_spatial_autocorrelation/pbsa_c.gpkg&quot;
pbsa_c = gpd.read_file(pf)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="CGw7ArmDBWYAHHWmr84FP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="aFdz6pDfFS" class="myst-jp-nb-block relative group/block"><p>Before calculating global spatial autocorrelation, it is also necessary to perform tests: Moran’s I Scatterplots Test and K-Nearest Neighbor Test, as well as calculate the Significance Threshold test.</p><p>Since the research focused on market parameters, global autocorrelation will focus on <code>capacity</code>, which measures the market supply.</p></div><div id="oKF3rRGXiR" class="myst-jp-nb-block relative group/block"><h2 id="standartalisation" class="relative group"><span class="heading-text">Standartalisation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#standartalisation" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Data standardisation is used to assess the correlation of neighbouring values relative to the overall average and to eliminate the outliers identified in the previous chapter. Standardisation converts data into dimensionless values, which allows for accurate comparison of clustering for different student accommodations. Positive standardised capacity values (<code>!cap_std</code>) indicate above-average objects, while negative values indicate below-average objects. This will help to clearly identify student accommodation clusters in the future.</p></div><div id="sfCFzuEPBz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">pbsa_c[&quot;!cap_std&quot;] = pbsa_c[&quot;!cap&quot;] - pbsa_c[&quot;!cap&quot;].mean()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="SZ3xEMXWJe2RG5qiDkPf9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="roVmZK4SCi" class="myst-jp-nb-block relative group/block"><h2 id="morans-i-scatterplots-test-k-nearest-neighbor-test" class="relative group"><span class="heading-text">Moran’s I Scatterplots Test &amp; K-Nearest Neighbor Test</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#morans-i-scatterplots-test-k-nearest-neighbor-test" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Several diagnostic measures can be used to identify spatial autocorrelation. Those that estimate spatial autocorrelation by a single value for the entire study area are named global spatial autocorrelation measures. The most commonly used is Moran’s I (Grekousis, 2020).</p><p><strong>Moran’s I</strong> computes global spatial autocorrelation by taking into account<br/>feature locations and attribute values (of a single attribute) simultaneously.
It is calculated by the following formula:</p><div id="hZo4HqFmzx" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mo>=</mo><mfrac><mi>n</mi><mrow><munder><mo>∑</mo><mi>i</mi></munder><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo>⋅</mo><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>x</mi><mo>ˉ</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">I = \frac{n}{\sum_i \sum_j w_{ij}} \cdot 
\frac{\sum_i \sum_j w_{ij}(x_i - \bar{x})(x_j - \bar{x})}
{\sum_i (x_i - \bar{x})^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2294em;vertical-align:-1.1218em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1218em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.5615em;vertical-align:-0.9857em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5758em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.8258em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9857em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#hZo4HqFmzx" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->1<!-- -->)</a></div></div><p>where:</p><p>n — number of spatial features<br/>xᵢ — attribute value of feature i (a variable in a spatial analysis context)<br/>xⱼ — attribute value of feature j<br/>x̄ — mean of this attribute<br/>wᵢⱼ — spatial weight between feature i and j<br/>∑ᵢ∑ⱼ wᵢⱼ — aggregation of all spatial weights</p><p>In order to calculate spatial weights between features, K-nearest neighbor weights are used. K-nearest neighbor weights are distance-based weights defines the neighbor set of a particular observation as containing its nearest observations, where the user specifies the number of nearest neighbors (<code>k</code>). If we do not test <code>k</code>, Moran’s I Index might have values beyond the [-1,1] boundaries (Grekousis, 2020).</p><p>To understand the intuition behind its math, it is useful to begin with a graphical interpretation: the Moran Plot for different numbers of neighbors (Figure XX). The Moran Plot is a way of visualizing a spatial dataset to explore the nature and strength of spatial autocorrelation. It is essentially a traditional scatter plot in which the variable of interest is displayed against its spatial lag (Rey et al., 2023).</p></div><div id="kiXnZIj8aE" class="myst-jp-nb-block relative group/block"><p>The Moran’s I scatterplots (Figure XX) across increasing k-values (<code>k_values = list(range(1, 21))</code>) reveal that student accommodation capacity in Berlin exhibits a weak but consistently positive spatial autocorrelation, which strengthens as the neighborhood definition expands. Each point represents a student accommodation and its relationship to the capacities of its surrounding neighbors. The four quadrants provide insight into the spatial logic of student housing distribution:</p><p><strong>Q1 – High–High (HH)</strong><br/>These locations have high student accommodation capacity and are surrounded by other areas with similarly high capacities. These clusters signal where the market has already developed a strong supply.</p><p><strong>Q2 – Low–High (LH)</strong><br/>These student accommodations have low capacity themselves, but are neighboring high-capacity ones. They often represent transition zones—places that have the potential to absorb future student housing development because they border well-served districts. These locations highlight opportunity areas where relatively small additions could significantly improve spatial balance.</p><p><strong>Q3 – Low–Low (LL)</strong><br/>These locations exhibit low capacity and are surrounded by other low-capacity areas, marking systemic undersupply zones. For policy-making, these locations indicate structurally disadvantaged parts of the city, where students face limited options.</p><p><strong>Q4 – High–Low (HL)</strong><br/>These student accommodations have high capacity but are surrounded by low-capacity neighbors. Such areas represent isolated clusters—individual dorms or private student residences located in otherwise undersupplied districts. They highlight mismatches where supply exists but lacks integration into broader student housing networks, potentially limiting accessibility.</p><p>In conclusion, the Moran’s I scatterplots illustrate that Berlin’s student housing supply is spatially uneven, featuring concentrated high-capacity cores, isolated developments, transitional opportunity zones, and persistent undersupply areas.</p></div><div id="hDhopAgJ0f" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">np.random.seed(55)

pbsa_c[&quot;!cap_std&quot;] = pbsa_c[&quot;!cap&quot;] - pbsa_c[&quot;!cap&quot;].mean()

# Define k values and threshold
k_values = list(range(1, 21))
threshold = 1.0  # Customize this if needed

# Subplot grid
n_cols = 5
n_rows = (len(k_values) + n_cols - 1) // n_cols
n_plots = len(k_values)

fig, axes = plt.subplots(n_rows, n_cols, figsize=(20, 4 * n_rows))
axes = axes.flatten()

# Generate plots
def new_func(k, ax, moran_i, p_val):
    #ax.set_title(f&#x27;k={k}\nMoran\&#x27;s I = {moran_i:.3f}, P-value = {p_val:.3f}&#x27;, fontsize=9)
    ax.set_title(f&#x27;k={k}&#x27;, fontsize=12)

for i, k in enumerate(k_values):
    ax = axes[i]
    
    # Create spatial weights matrix
    w_k = libpysal.weights.KNN.from_dataframe(pbsa_c, k=k)
    w_k.transform = &quot;R&quot;
    
    # Compute spatial lag for this k
    slag_col = f&#x27;!cap_slag_std_k{k}&#x27;
    pbsa_c[slag_col] = lag_spatial(w_k, pbsa_c[&quot;!cap_std&quot;])

    # Generate quadrant-based colors
    colors = []
    clusters = []
    for x, y in zip(pbsa_c[&#x27;!cap_std&#x27;], pbsa_c[slag_col]):
        if abs(x) &lt;= threshold and abs(y) &lt;= threshold:
            colors.append(&#x27;#FBF0EA&#x27;)  # Cream = Not Significant
            clusters.append(&#x27;NS&#x27;)
        elif x &gt; 0 and y &gt; 0:
            colors.append(&#x27;#F28B6D&#x27;)  # Coral = High-High
            clusters.append(&#x27;HH&#x27;)
        elif x &gt; 0 and y &lt; 0:
            colors.append(&#x27;#C8E0D4&#x27;)  # Light teal = Low-High
            clusters.append(&#x27;LH&#x27;)
        elif x &lt; 0 and y &lt; 0:
            colors.append(&#x27;#5F968E&#x27;)  # Dark teal = Low-Low
            clusters.append(&#x27;LL&#x27;)
        elif x &lt; 0 and y &gt; 0:
            colors.append(&#x27;#FEC89A&#x27;)  # Peach = High-Low
            clusters.append(&#x27;HL&#x27;)
    
    # Scatter plot
    ax.scatter(
        pbsa_c[&#x27;!cap_std&#x27;], pbsa_c[slag_col],
        c=colors, s=np.random.seed(55), edgecolor=&#x27;white&#x27;, linewidth=0.3, alpha=0.8
    )

    # Add regression line
    sns.regplot(
        x=&#x27;!cap_std&#x27;, y=slag_col, data=pbsa_c,
        scatter=False, ci=None, line_kws={&quot;color&quot;: &#x27;#999999&#x27;, &quot;linewidth&quot;: 1.2}, ax=ax
    )

    # Axes
    ax.axvline(0, color=&#x27;#aaaaaa&#x27;, linestyle=&#x27;--&#x27;, linewidth=0.8)
    ax.axhline(0, color=&#x27;#aaaaaa&#x27;, linestyle=&#x27;--&#x27;, linewidth=0.8)

    # Moran calculation
    moran_k = Moran(pbsa_c[&#x27;!cap&#x27;], w_k)
    moran_i = moran_k.I
    p_val = moran_k.p_sim

    # Title
    new_func(k, ax, moran_i, p_val)

    # Axis labels (only for edges)
    if i % n_cols == 0:
        ax.set_ylabel(&#x27;spatial lag of standardised capacity (!cap_slag_std)&#x27;, fontsize=9)
    if i &gt;= n_plots - n_cols:
        ax.set_xlabel(&#x27;standardised capacity (!cap_std)&#x27;, fontsize=12)
    if i % n_cols != 0:
        ax.set_ylabel(&#x27;&#x27;)
    if i &lt; n_plots - n_cols:
        ax.set_xlabel(&#x27;&#x27;)

    # Tight axes
    ax.set_xlim(pbsa_c[&#x27;!cap_std&#x27;].min() - 0.1, pbsa_c[&#x27;!cap_std&#x27;].max() + 0.1)
    ax.set_ylim(pbsa_c[slag_col].min() - 0.1, pbsa_c[slag_col].max() + 0.1)

# Hide any extra subplots
for j in range(len(k_values), len(axes)):
    axes[j].set_visible(False)

# Layout
fig.suptitle(&quot;Student Accommodation Capacity Moran&#x27;s I Scatterplots for Different Number of Neighbours (k)&quot;, fontsize=16, y=0.98)
plt.subplots_adjust(top=0.93, hspace=0.5, wspace=0.5)

save_path = os.path.join(hf, &quot;Student Accommodation Capacity Moran&#x27;s I Scatterplots for Different Number of Neighbours (k).png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="8KmaT7dCJjzRIbbyhq7i9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/f7eab9b49d321ccc8d4410ca3d389419.png" alt="&lt;Figure size 2000x1600 with 20 Axes&gt;"/></div></div></div><div id="homhOsU0rV" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Student Accommodation Capacity Moran’s I Scatterplots for Different Number of Neighbours (k)</em></p></div><div id="LUUbTpfpki" class="myst-jp-nb-block relative group/block"><p>The difference between the scatterplots (Figure XX) must be evaluated based on Moran’s I index and P-value. Through these metrics, we assess whether spatial autocorrelation is statistically significant. To do this, we need to calculate the parameters for each value of the number of nearest neighbors (<code>k</code>) (Table XX).</p><p>Moran’s I index and P-value can be interpreted as follows. A Moran’s I index score higher than 0.3 is an indication of relatively strong positive autocorrelation, while a score lower than -0.3 is an indication of relatively strong negative autocorrelation. If the p-value is large (usually p &gt; 0.05), the results are not statistically significant, and we cannot reject spatial dependency (Grekousis, 2020).</p></div><div id="vj6H7Tx8Jz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">np.random.seed(55)

k_values = [ 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
morans_I = []
p_values = []

for k in k_values:
    w = libpysal.weights.KNN.from_dataframe(pbsa_c, k=k)
    w.transform = &quot;R&quot;
    moran = Moran(pbsa_c[&#x27;!cap&#x27;], w)
    morans_I.append(moran.I)
    p_values.append(moran.p_sim)

# Create DataFrame
pbsa_k_test = pd.DataFrame({
    &#x27;k&#x27;: k_values,
    &quot;Moran&#x27;s I&quot;: morans_I,
    &#x27;P-value&#x27;: p_values
})

pbsa_k_test</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="TwpPxro40bh7feUGTuoSw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="q4eE4MwD9n" class="myst-jp-nb-block relative group/block"><p><em>Table XX. Student Accommodation Capacity Moran’s I index and P-value for Different Number of Neighbors (k)</em></p></div><div id="vf3cTsbeG5" class="myst-jp-nb-block relative group/block"><p>The task of finding the desired value of the number of nearest neighbors (<code>k</code>) can be solved by plotting a graph of the dependence of Moran’s I index and P-value on k (Figure XX). On this graph, it is necessary to find the maximum values of the Moran’s I index modulus and then compare the P-value.</p><p>The maximum values of Moran’s I index are achieved at k from 15 to 17. Since there are only 88 student dormitories, the minimum value of 15 neighbors (<code>k = 15</code>) was chosen. That is, each student dormitory is compared with its 15 closest neighbors in order to identify spatial dependence.</p></div><div id="x4hOltLO9U" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plt.figure(figsize=(6, 6))
plt.plot(pbsa_k_test[&#x27;k&#x27;], pbsa_k_test[&quot;Moran&#x27;s I&quot;], label=&quot;Moran&#x27;s I&quot;, color=&#x27;#FFB78F&#x27;)
plt.plot(pbsa_k_test[&#x27;k&#x27;], pbsa_k_test[&#x27;P-value&#x27;], label=&#x27;P-value&#x27;, color=&#x27;#76A79D&#x27;)

plt.axhline(0.05, color=&#x27;#A9CCC1&#x27;, linestyle=&#x27;--&#x27;, linewidth=1.5, label=&quot;P = 0.05 (Significance Threshold)&quot;)
plt.grid(True, color=&#x27;#cccccc&#x27;, linestyle=&#x27;--&#x27;, alpha=0.5)

plt.xlabel(&#x27;k (number of neighbors)&#x27;)
plt.title(&quot;Student Accommodation Capacity Moran&#x27;s I and P-value&quot;)
plt.xticks(pbsa_k_test[&#x27;k&#x27;])
plt.legend(loc=&#x27;best&#x27;, frameon=False)

save_path = os.path.join(hf, &quot;Student Accommodation Capacity Moran&#x27;s I and P-value.png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="DpibGVh1xbQg4eX5CmpZI" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/ccde0aa3841b1fc76e0d7e45cc7bfe66.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div></div><div id="Cb2x34eDY9" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Student Accommodation Capacity Moran’s I index and P-value for Different Number of Neighbours (k)</em></p></div><div id="Ek7mGrsvFr" class="myst-jp-nb-block relative group/block"><h2 id="significance-threshold-test" class="relative group"><span class="heading-text">Significance Threshold Test</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#significance-threshold-test" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="iovwXLKvPR" class="myst-jp-nb-block relative group/block"><p>In the original Moran’s I Scatterplots for Different Number of Neighbors (Figure XX), the points are distributed across four quadrants: HH, HL, LH, LL. However, points near zero may accidentally fall into false categories, even though they do not demonstrate real spatial dependence. This can lead to distorted results and the identification of false points of spatial autocorrelation.</p><p>The Significance Threshold Test sets a significance threshold (<code>theshold</code>) for standardized capacity (<code>!cap_std</code>) and spatial lag standardized capacity (<code>!cap_slag_std</code>), and filters out not significant points where both variables take neutral values.</p></div><div id="kxNbnSRB1m" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Option 1: Based on percentiles (recommended for your data)
threshold_percentile = np.percentile(np.abs(pbsa_c[&#x27;!cap_std&#x27;]), 75)  # 75th percentile of absolute values
print(f&quot;Option 1 - Percentile-based threshold: {threshold_percentile:.3f}&quot;)
print(f&quot;  (75th percentile of absolute values)&quot;)

# Option 2: Based on standard deviation
std_dev = pbsa_c[&#x27;!cap_std&#x27;].std()
threshold_std = 0.5 * std_dev  # 0.5 standard deviations
print(f&quot;Option 2 - Standard deviation-based threshold: {threshold_std:.3f}&quot;)
print(f&quot;  (0.5 * standard deviation)&quot;)

# Option 3: Fixed threshold based on your data range
threshold_fixed = 50.0  # Fixed value appropriate for your range
print(f&quot;Option 3 - Fixed threshold: {threshold_fixed:.3f}&quot;)
print(f&quot;  (Fixed value for data range)&quot;)

# Option 4: Median-based threshold
median_abs = np.median(np.abs(pbsa_c[&#x27;!cap_std&#x27;]))
threshold_median = median_abs * 0.5
print(f&quot;Option 4 - Median-based threshold: {threshold_median:.3f}&quot;)
print(f&quot;  (0.5 * median of absolute values)&quot;)

thresholds_to_test = [threshold_percentile, threshold_std, threshold_fixed, threshold_median]

for i, test_threshold in enumerate(thresholds_to_test, 1):
    print(f&quot;\nTest {i}: threshold = {test_threshold:.3f}&quot;)
    
    # Count points in each category
    ns_count = 0
    hh_count = 0
    lh_count = 0
    ll_count = 0
    hl_count = 0
    
    for x, y in zip(pbsa_c[&#x27;!cap_std&#x27;], pbsa_c[slag_col]):
        if abs(x) &lt;= test_threshold and abs(y) &lt;= test_threshold:
            ns_count += 1
        elif x &gt; 0 and y &gt; 0:
            hh_count += 1
        elif x &gt; 0 and y &lt; 0:
            lh_count += 1
        elif x &lt; 0 and y &lt; 0:
            ll_count += 1
        elif x &lt; 0 and y &gt; 0:
            hl_count += 1
    
    total = len(pbsa_c)
    print(f&quot;  NS: {ns_count} ({ns_count/total*100:.1f}%)&quot;)
    print(f&quot;  HH: {hh_count} ({hh_count/total*100:.1f}%)&quot;)
    print(f&quot;  LH: {lh_count} ({lh_count/total*100:.1f}%)&quot;)
    print(f&quot;  LL: {ll_count} ({ll_count/total*100:.1f}%)&quot;)
    print(f&quot;  HL: {hl_count} ({hl_count/total*100:.1f}%)&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="-to6mtiTCrfnjzMDiErvg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Option 1 - Percentile-based threshold: 234.375
  (75th percentile of absolute values)
Option 2 - Standard deviation-based threshold: 124.090
  (0.5 * standard deviation)
Option 3 - Fixed threshold: 50.000
  (Fixed value for data range)
Option 4 - Median-based threshold: 78.750
  (0.5 * median of absolute values)

Test 1: threshold = 234.375
  NS: 66 (75.0%)
  HH: 8 (9.1%)
  LH: 6 (6.8%)
  LL: 6 (6.8%)
  HL: 2 (2.3%)

Test 2: threshold = 124.090
  NS: 25 (28.4%)
  HH: 15 (17.0%)
  LH: 10 (11.4%)
  LL: 26 (29.5%)
  HL: 12 (13.6%)

Test 3: threshold = 50.000
  NS: 6 (6.8%)
  HH: 16 (18.2%)
  LH: 12 (13.6%)
  LL: 35 (39.8%)
  HL: 19 (21.6%)

Test 4: threshold = 78.750
  NS: 11 (12.5%)
  HH: 16 (18.2%)
  LH: 12 (13.6%)
  LL: 35 (39.8%)
  HL: 14 (15.9%)
</span></code></pre></div></div></div></div><div id="kMNLlIwfPP" class="myst-jp-nb-block relative group/block"><p>In order to correctly interpret the Significance Threshold Test, it is necessary to pay attention to the distribution of points across four squares - spatial clusters.</p><p><strong>Option 1 - Percentile-based threshold: 234.375</strong><br/>With a high threshold value, 75% of the points became neutral, and the global autocorrelation analysis lost its meaning.</p><p><strong>Option 2 - Standard deviation-based threshold: 124.090</strong><br/>It will eliminate the outliers that were described in the Descriptive Market Statistics chapter, as it is calculated according to the standard deviation.</p><p><strong>Option 3 - Fixed threshold: 50.000</strong><br/>A threshold value that is too low results in the percentage of neutral points being too low at 6.8%.</p><p><strong>Option 4 - Median-based threshold: 78.750</strong><br/>Median-based threshold does not react to abnormally large values.
Therefore, this threshold creates a threshold that reflects the real “central” distribution structure (<code>threshold = threshold_median</code>).</p><p>Using three tests: Moran’s I Scatterplots Test, K-Nearest Neighbour Test, and Significance Threshold Test, it can be confirmed that the results of local spatial autocorrelation are stable.</p></div><div id="PK758nwVaQ" class="myst-jp-nb-block relative group/block"><h2 id="spatial-weights-morans-i-p-value" class="relative group"><span class="heading-text">Spatial Weights &amp; Moran’s I &amp; P-value</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spatial-weights-morans-i-p-value" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="hKuS4E0z63" class="myst-jp-nb-block relative group/block"><p>After performing all necessary tests, it is possible to proceed to the direct calculation of Spatial Weights, Moran’s I, and P-value for the selected value of numbers of nearest neighbors (<code>k=15</code>). To do this, the method of spatial weights standardization must be defined. Row-standardization (<code>w.transform = “R”</code>) makes Moran’s I and other spatial indices comparable between different areas, even if the number of neighbors for objects is different. For each row of the weight matrix (each object), the sum of all neighbor weights is normalized to 1.</p><div id="tlnKhaKzF4" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mfrac><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{ij}^{(R)} = \frac{w_{ij}}{\sum_{j} w_{ij}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2294em;vertical-align:-1.1218em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1218em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#tlnKhaKzF4" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->2<!-- -->)</a></div></div></div><div id="kjqpWbAje5" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">w = KNN.from_dataframe(pbsa_c, k=15)

w.transform = &quot;R&quot; 

values = pbsa_c[&#x27;!cap&#x27;]

moran = Moran(values, w)
print(f&quot;Moran&#x27;s I: {moran.I:.3f}&quot;)
print(f&quot;P-value: {moran.p_sim:.3f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="AnYy04NHlmFuE3kZI5Ns-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Moran&#x27;s I: 0.136
P-value: 0.001
</span></code></pre></div></div></div></div><div id="pcxQ2Wbwo5" class="myst-jp-nb-block relative group/block"><p>Moran’s I (<code>Moran&#x27;s I: 0.136</code>) indicates positive spatial autocorrelation. In the context of urban planning, this indicates that student accommodations have a weak but stable tendency to form clusters.</p><p>P-value (<code>P-value: 0.001</code>) indicates that the probability of obtaining such a result by chance is 0.1%. In the context of urban planning, this shows that the observed spatial clusters actually exist and are not random.</p></div><div id="Fcb4NuRHY7" class="myst-jp-nb-block relative group/block"><h2 id="spatial-lag-standardised-spatial-lag" class="relative group"><span class="heading-text">Spatial Lag &amp; Standardised Spatial Lag</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spatial-lag-standardised-spatial-lag" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="EPYKkpeJQ7" class="myst-jp-nb-block relative group/block"><p>After calculating spatial weights, it is necessary to compute the spatial lag. The spatial lag operator is one of the most common and direct applications of spatial weights matrices (called <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="bold">W</mtext></mrow><annotation encoding="application/x-tex">\textbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord text"><span class="mord textbf">W</span></span></span></span></span></span> formally) in spatial analysis. Conceptually, the spatial lag captures the behavior of a variable in the immediate surroundings of each location; in that respect, it is akin to a local smoother of a variable (Rey et al., 2023).</p><p>We can formally express it in matrix notation as:</p><div id="zI6QqE8QrA" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Y</mi><mrow><mi>s</mi><mi>l</mi></mrow></msub><mo>=</mo><mtext mathvariant="bold">W</mtext><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y_{sl} = \textbf{W} Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord text"><span class="mord textbf">W</span></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#zI6QqE8QrA" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->3<!-- -->)</a></div></div><p>or, in individual notation as:</p><div id="dK146N1ejt" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mrow><mi>s</mi><mi>l</mi><mo>−</mo><mi>i</mi></mrow></msub><mo>=</mo><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>y</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">y_{sl-i} = \sum_j w_{ij} y_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4638em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#dK146N1ejt" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->4<!-- -->)</a></div></div><p>where:</p><p><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span> is the cell in <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="bold">W</mtext></mrow><annotation encoding="application/x-tex">\textbf{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"></span><span class="mord text"><span class="mord textbf">W</span></span></span></span></span></span> on the <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span>-th row and <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>-th column, thus capturing the spatial relationship between observations <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span> and <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>, in other words <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>s</mi><mi>l</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{sl-i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></span> is the weighted average values in a specified neighborhood.<br/><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>s</mi><mi>l</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{sl-i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></span> thus captures the product of the values and weights of each observation other than <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span> in the dataset.</p><p>Spatial lag is a key element of many spatial analysis techniques including spatial autocorrelation (Rey et al., 2023).</p></div><div id="dn5xIHuPGY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">pbsa_c[&quot;!cap_slag&quot;] = lag_spatial(w, pbsa_c[&quot;!cap&quot;])
pbsa_c[&quot;!cap_std&quot;] = pbsa_c[&quot;!cap&quot;] - pbsa_c[&quot;!cap&quot;].mean()
pbsa_c[&quot;!cap_slag_std&quot;] = lag_spatial(w, pbsa_c[&quot;!cap_std&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="6Nn6DCa2ZVoZJ2dzRFvna" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="lQXEwI0It1" class="myst-jp-nb-block relative group/block"><p>The maps (Figure XX) illustrate the various stages of data preparation for global autocorrelation — from actual capacity values (<code>!cap</code>) and their spatial relationships (<code>!cap_slag</code>) to their standardized values (<code>!cap_std</code> and <code>!cap_slag_std</code>).</p><p><strong>a. Student Housing Capacity (!cap)</strong><br/>The first map shows the absolute capacity of student housing. Despite the presence of large facilities in central areas, the overall structure remains fragmented, with significant heterogeneity between districts. This map reflects the actual market and serves as a starting point for analysis.</p><p><strong>b. Student Housing Capacity Influence (!cap_slag)</strong><br/>The second map displays the spatial lag of capacity — the average capacity in neighboring locations. It captures the influence of neighboring facilities, smoothing out local peaks and revealing latent clusters that are not visible in the absolute data. This shows not only where large dormitories are located, but also where their surroundings are saturated or deficient.</p><p><strong>c. Standardized Capacity (!cap_std)</strong><br/>The third map shows standardised values (centered around the mean). Here you can see which areas have above- or below-average capacity for the city, rather than simply “large/small.” This is a key step for Moran’s I, as it allows you to identify deviations from the overall trend rather than absolute values.</p><p><strong>d. Standardized Capacity Influence (!cap_slag_std)</strong><br/>The fourth map displays standardized spatial lag—how much neighboring areas are above or below average. In combination with map (c), it shows where High–High (HH) and Low–Low (LL) clusters form and where anomalies (High–Low / Low–High) occur. These patterns form the basis for interpreting the Moran Scatterplot.</p><p>Together, maps (a–d) demonstrate that the distribution of student housing in Berlin is highly heterogeneous and structurally dependent on the spatial environment. The transition from absolute values (<code>!cap</code>) to standardized spatial lags (<code>!cap_slag_std</code>) allows us to identify hidden clusters and areas of shortage — key information for rethinking student housing placement strategies and developing spatially sensitive solutions.</p></div><div id="aUeLad0L0Y" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig, axs  = plt.subplots(2, 2, figsize=(18, 12))

pgr.plot(ax=axs[0, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[0, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[0, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
pbsa_c.plot(ax=axs[0, 0],
          column=&#x27;!cap&#x27;,
          cmap=cmap_or,
          markersize = np.sqrt(pbsa_c[&#x27;!cap&#x27;]) * 2,  # Scale marker size
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;capacity&quot;},
          vmin=0,
          vmax=pbsa_c[&#x27;!cap&#x27;].quantile(0.95))  # Cap extremes
axs[0, 0].set_title(&#x27;a. Student Housing Capacity (!cap)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[0, 0].set_axis_off()

pgr.plot(ax=axs[0, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[0, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[0, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
pbsa_c.plot(ax=axs[0, 1],
          column=&#x27;!cap_slag&#x27;,
          cmap=cmap_or,
          markersize=np.sqrt(pbsa_c[&#x27;!cap_slag&#x27;]) * 2,
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;capacity spatial lag&quot;},
          vmin=0,
          vmax=pbsa_c[&#x27;!cap&#x27;].quantile(0.95))  # Matching Previous plott
axs[0, 1].set_title(&#x27;b. Student Housing Capacity Influence (!cap_slag)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[0, 1].set_axis_off()


max_abs_value = max(abs(pbsa_c[&#x27;!cap_std&#x27;].min()), abs(pbsa_c[&#x27;!cap_std&#x27;].max()))
vmin, vmax = -max_abs_value, max_abs_value
pgr.plot(ax=axs[1, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[1, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[1, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
pbsa_c.plot(ax=axs[1, 0],
          column=&#x27;!cap_std&#x27;,
          cmap=cmap_mintor,
          markersize = np.sqrt(np.abs(pbsa_c[&#x27;!cap_std&#x27;])) * 2,  # Scale marker size
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;standardised capacity&quot;},
          vmin=vmin,  # Symmetrical lower bound
          vmax=vmax)      # Cap extremes
axs[1, 0].set_title(&#x27;c.Standardised Student Housing Capacity (!cap_std)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[1, 0].set_axis_off()

max_abs_value = max(abs(pbsa_c[&#x27;!cap_slag_std&#x27;].min()), abs(pbsa_c[&#x27;!cap_slag_std&#x27;].max()))
vmin, vmax = -max_abs_value, max_abs_value
pgr.plot(ax=axs[1, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[1, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[1, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
pbsa_c.plot(ax=axs[1, 1],
          column=&#x27;!cap_slag_std&#x27;,
          cmap=cmap_mintor,
          markersize=np.sqrt(np.abs(pbsa_c[&#x27;!cap_slag_std&#x27;])) * 2,
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;standardised capacity spatial lag&quot;},
          vmin=vmin,  # Symmetrical lower bound
          vmax=vmax)
axs[1, 1].legend(loc=&#x27;lower center&#x27;, ncol=2, frameon=False, prop={&#x27;size&#x27;: 10})
axs[1, 1].set_title(&#x27;d. Standardised Student Housing Capacity Influence (!cap_slag_std)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[1, 1].set_axis_off()

save_path = os.path.join(hf, &quot;Standardised Student Housing Capacity.png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="IJUwdXfP9w9tE8-biuoh3" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/9781eb9778e4ddf3ec7bc4f5ec806273.png" alt="&lt;Figure size 1800x1200 with 8 Axes&gt;"/></div></div></div><div id="HWX3yIApbT" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Stages of Preparing Student Accommodation Capacity Data</em></p></div><div id="mkUuC21Cgf" class="myst-jp-nb-block relative group/block"><p>Moran’s graph shows the spatial relationship between the standardised capacity of student housing (<code>!cap_std</code>) and its spatial lag (<code>!cap_slag_std</code>) — that is, the average capacity of neighbouring locations. Dividing the graph into four quadrants allows us to identify types of spatial patterns:</p><p><strong>Q1 – High–High (HH)</strong><br/>These are high-capacity clusters where several large student residences are concentrated close to each other. For example, Studentenwohnheim Alfred-Jung-Straße, with a capacity of 800, is located less than 200 metres from another large student accommodation facility, WH Storkower Straße, with a capacity of 508 students, forming a stable centre for foreign students. At the same time, 12 of the 17 student facilities in the HH quadrant are state-owned. This leads to the conclusion that these centres of attraction are formed by state-owned facilities.</p><p><strong>Q2 – Low–High (LH)</strong>
These are local pockets near developed clusters where a particular facility has low capacity compared to its saturated surroundings. For example, four facilities located in Wed: Norderoog, Studentenwohnheim Paul-Hertz-Haus, Süderoog, WH Augustenburger Platz with a total capacity of 471 students. Such areas are particularly important for analysis, as they may represent missed opportunities for growth.</p><p><strong>Q3 – Low–Low (LL)</strong><br/>These are supply shortage clusters where both the property and its surroundings have low capacity. For example, student accommodation in the direct vicinity of the Technical University of Berlin (Insider Apartments Leibniz Straße, WH Fraunhoferstraße, WH Hardenbergstraße). Such areas indicate structurally underserved areas – potential territories for development.</p><p><strong>Q4 – High–Low (HL)</strong><br/>These are spatial anomalies where one large property appears in an environment where neighbouring areas have low supply. For example, Student Village Berlin Adlershof, is an early indicator of the development of new student areas.</p><p>The graph shows that the distribution of student housing capacity in Berlin includes both stable high-density clusters (HH) and structural gaps (LL), as well as a number of spatial anomalies (HL, LH), indicating uneven market development. These patterns describe indicators of the student housing crisis.</p></div><div id="Ky53HVjyal" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define thresholds for &quot;Not Significant&quot;
threshold = threshold_median

# Prepare lists
colors = []
clusters = []

# Loop through each row
for x, y in zip(pbsa_c[&#x27;!cap_std&#x27;], pbsa_c[&#x27;!cap_slag_std&#x27;]):
    if abs(x) &lt;= threshold and abs(y) &lt;= threshold:
        colors.append(&#x27;#FBF0EA&#x27;)         # Cream for Not Significant
        clusters.append(&#x27;NS&#x27;)            # Not Significant
    elif x &gt; 0 and y &gt; 0:
        colors.append(&#x27;#F28B6D&#x27;)         # Coral
        clusters.append(&#x27;HH&#x27;)            # High-High
    elif x &gt; 0 and y &lt; 0:
        colors.append(&#x27;#C8E0D4&#x27;)         # Light teal
        clusters.append(&#x27;LH&#x27;)            # Low-High
    elif x &lt; 0 and y &lt; 0:
        colors.append(&#x27;#5F968E&#x27;)         # Dark teal
        clusters.append(&#x27;LL&#x27;)            # Low-Low
    elif x &lt; 0 and y &gt; 0:
        colors.append(&#x27;#FEC89A&#x27;)         # Peach
        clusters.append(&#x27;HL&#x27;)            # High-Low

# Assign to GeoDataFrame
pbsa_c[&#x27;color&#x27;] = colors
pbsa_c[&#x27;cluster_cap&#x27;] = clusters</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="oWqiDZlhsqsyqGHz7d8LG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="PMJx9TKg4f" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">f, ax = plt.subplots(1, figsize=(6, 6))

# Scatter plot with manual colors
scatter = ax.scatter(
    x=pbsa_c[&#x27;!cap_std&#x27;],
    y=pbsa_c[&#x27;!cap_slag_std&#x27;],
    c=colors,  # Use our manually assigned colors
    s=40,
    edgecolor=&#x27;white&#x27;,
    linewidth=0.3
)

sns.regplot(
    x=&#x27;!cap_std&#x27;,
    y=&#x27;!cap_slag_std&#x27;,
    ci=None,
    data=pbsa_c,
    scatter=False,  # Disable default points
    line_kws={&quot;color&quot;:&#x27;#cccccc&#x27;, &quot;linewidth&quot;: 2},
    ax=ax
)

# Axes lines
ax.axvline(0, color=&#x27;#cccccc&#x27;, alpha=0.75, linestyle=&quot;--&quot;)
ax.axhline(0, color=&#x27;#cccccc&#x27;, alpha=0.75, linestyle=&quot;--&quot;)

# Title and labels
ax.set_title(&quot;Moran Scatterplot: Standardised Student Accommodation Capacity&quot;, fontsize=12, weight=&#x27;bold&#x27;)
ax.set_xlabel(&quot;standardised capacity (!cap_std)&quot;, fontsize=10)
ax.set_ylabel(&quot;spatial lag of standardised capacity (!cap_slag_std)&quot;, fontsize=10)

# Quadrant labels
ax.text(400, 125, &quot;High–High (HH)&quot;, fontsize=9, color=&quot;gray&quot;)
ax.text(400, -75, &quot;Low–High (LH)&quot;, fontsize=9, color=&quot;gray&quot;)
ax.text(-200, -75, &quot;Low–Low (LL)&quot;, fontsize=9, color=&quot;gray&quot;)
ax.text(-200, 125, &quot;High–Low (HL)&quot;, fontsize=9, color=&quot;gray&quot;)

# Style
ax.set_xlim(pbsa_c[&#x27;!cap_std&#x27;].min() - 0.5, pbsa_c[&#x27;!cap_std&#x27;].max() + 0.5)
ax.set_ylim(pbsa_c[&#x27;!cap_slag_std&#x27;].min() - 0.5, pbsa_c[&#x27;!cap_slag_std&#x27;].max() + 0.5)

save_path = os.path.join(hf, &quot;Moran Scatterplot: Standardised Student Accommodation Capacity&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="40fqy3VdMoJLCV4X70oyn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/0cccb3a0daacad0289cb53986ee5754e.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div></div><div id="gowgdKNTOI" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Student Accommodation Capacity Moran Scatterplot</em></p></div><div id="bnofYtXBvK" class="myst-jp-nb-block relative group/block"><p>The map (Figure XX) visualises the results of global spatial autocorrelation, which allows spatial clusters of student housing capacity to be identified.</p><p>In addition to identifying point clusters, the map clearly demonstrates the structural difference between East and West Berlin, which persists decades after the city’s reunification. The map reveals clear spatial segregation.</p><p>East Berlin shows a high concentration of large student complexes and compact clusters. In the districts of Lichtenberg, Marzahn-Hellersdorf, and parts of the central districts, large halls of residence (HH) are spatially clustered, indicating strategically strong market areas. Individual high-capacity facilities (HL) are located in areas with low supply (e.g., in the south-east of the city). This is partly due to the historical legacy of the former East Berlin, where student residences were actively developed as part of the social infrastructure.</p><p>Western Berlin, on the other hand, is characterised by a predominance of stable areas with low capacity and a shortage of supply. Areas of systemic shortage are concentrated mainly in Charlottenburg-Wilmersdorf, Tempelhof-Schöneberg, Neukölln, and Steglitz-Zehlendorf. Properties with low capacity are surrounded by large student complexes, most often in areas where local conditions or urban planning restrictions hinder expansion, such as in Mitte. This reflects a market that is more oriented towards the private rental sector, where student accommodation has developed more slowly.</p><p>The spatial distribution of student housing in Berlin remains uneven and historically conditioned: the east has concentrated large, state-owned housing clusters, while the west faces a systemic supply shortage. This asymmetry increases pressure on rental markets in western districts and serves as a key signal of the ongoing student housing crisis.</p></div><div id="WWZmsloavt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig, ax = plt.subplots(figsize=(12, 12))

# Plot the base map (replace &#x27;lor&#x27; with your local authority boundaries if needed)

pgr.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
mauer.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1.25, linestyle=&quot;--&quot;)
bz.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
for idx, row in bz.iterrows():
    centroid = row[&#x27;geometry&#x27;].centroid
    txt = ax.text(
        centroid.x, centroid.y,
        str(row[&#x27;namgem&#x27;]),
        fontsize=8, color=&#x27;#666666&#x27;, ha=&#x27;center&#x27;, va=&#x27;center&#x27;
    )
    txt.set_path_effects([
        path_effects.Stroke(linewidth=2, foreground=&#x27;white&#x27;),
        path_effects.Normal()
    ])
out.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1.25)

# Plot the student housing with colors based on cluster classification
pbsa_c.plot(ax=ax,
            color=pbsa_c[&#x27;color&#x27;],
            markersize=np.sqrt(np.abs(pbsa_c[&#x27;!cap_std&#x27;])) * 3 + 5,  # Adjust size based on standardized capacity
            alpha=0.9,
            edgecolor=&#x27;white&#x27;,
            linewidth=0.3)

legend_elements = [
    mpatches.Patch(color=&#x27;#F28B6D&#x27;, label=&#x27;High-High (HH)&#x27;, edgecolor=&#x27;none&#x27;),
    mpatches.Patch(color=&#x27;#FEC89A&#x27;, label=&#x27;High-Low (HL)&#x27;, edgecolor=&#x27;none&#x27;),
    mpatches.Patch(color=&#x27;#C8E0D4&#x27;, label=&#x27;Low-High (LH)&#x27;, edgecolor=&#x27;none&#x27;),
    mpatches.Patch(color=&#x27;#5F968E&#x27;, label=&#x27;Low-Low (LL)&#x27;, edgecolor=&#x27;none&#x27;), 
    mpatches.Patch(color=&#x27;#FBF0EA&#x27;, label=&#x27;Not Significant (NS)&#x27;, edgecolor=&#x27;#FAE1DD&#x27;), 
]

# Add the legend to the plot
ax.legend(handles=legend_elements, loc=&#x27;lower center&#x27;, ncol=5, frameon=False, prop={&#x27;size&#x27;: 10})

# Add titles and customize the layout
ax.set_title(&#x27;Student Housing Capacity Clusters in Berlin&#x27;, fontsize=16, weight=&#x27;bold&#x27;)
ax.set_axis_off()

save_path = os.path.join(hf, &quot;Student Housing Capacity Clusters in Berlin.png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qCJAscgYzN4SuMDKqDr1-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/b902e13ac9d4d3f03ae5c8444c16984e.png" alt="&lt;Figure size 1200x1200 with 1 Axes&gt;"/></div></div></div><div id="dcsdbmcc1D" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Student Accommodation Capacity Clusters in Berlin</em></p></div><div id="jt8SNLIvi9" class="myst-jp-nb-block relative group/block"><h2 id="data-export" class="relative group"><span class="heading-text">Data Export</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data-export" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="G1aw2LAoAi" class="myst-jp-nb-block relative group/block"><p>The student accommodation data obtained from global spatial autocorrelation was stored for further market analysis.</p></div><div id="OFhWmlrGbA" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># List of columns to drop
cols_to_drop = [f&#x27;!cap_slag_std_k{i}&#x27; for i in range(1, 21)]

# Drop them from the GeoDataFrame
pbsa_c = pbsa_c.drop(columns=cols_to_drop)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="YID8wEPvTnlRi9jiviDEe" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="P9V5lRjV43" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ef = r&#x27;../outputs/2.4_global_spatial_autocorrelation/pbsa_capacity_analysis.gpkg&#x27;
pbsa_c.to_file(ef, driver=&quot;GPKG&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="YXVFgOblCgROHPrq0JLwx" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="RLlsSs2evO" class="myst-jp-nb-block relative group/block"><h1 id="higher-education-universities-international-demand" class="relative group"><span class="heading-text">Higher Education Universities International Demand</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#higher-education-universities-international-demand" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Similarly, an analysis of the spatial distribution of higher education university student demand across the city was conducted.</p></div><div id="j7TlR5JfVG" class="myst-jp-nb-block relative group/block"><h2 id="data-import-1" class="relative group"><span class="heading-text">Data Import</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data-import-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="bOpotdalOm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">uf = r&#x27;../inputs/2.4_global_spatial_autocorrelation/uni_c.gpkg&#x27;
uni_c = gpd.read_file(uf)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="rcSsbhIzb6kk4soEs0wCv" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="yxt5Efr6p2" class="myst-jp-nb-block relative group/block"><h2 id="standartalisation-1" class="relative group"><span class="heading-text">Standartalisation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#standartalisation-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="qUL4aMITW1" class="myst-jp-nb-block relative group/block"><p>Since the research focused on international students, global autocorrelation will focus on number of international students (<code>!s_aus</code>), which measures the market demand.</p></div><div id="Mqm8DNmRRv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">uni_c[&quot;!s_aus_std&quot;] = uni_c[&quot;!s_aus&quot;] - uni_c[&quot;!s_aus&quot;].mean()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="F_0Rk1abBhWujAolBi0sp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="yLrP4fO8o4" class="myst-jp-nb-block relative group/block"><h2 id="morans-i-scatterplots-test-k-nearest-neighbor-test-1" class="relative group"><span class="heading-text">Moran’s I Scatterplots Test &amp; K-Nearest Neighbor Test</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#morans-i-scatterplots-test-k-nearest-neighbor-test-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="Ef9z5wgVsS" class="myst-jp-nb-block relative group/block"><p>Moran’s I Scatterplots (Figure XX) demonstrate how the spatial structure of international student demand changes as the number of nearest neighbours increases (<code>k_values = list(range(1, 21))</code>). The main conclusion is that, unlike the student housing market, demand from universities does not form stable spatial clusters. Most points in all graphs are concentrated near zero on the standardised international demand axis (<code>!s_aus_std</code>), indicating that neighbouring universities do not have a strong influence on demand values.</p><p><strong>Q1 – High–High (HH)</strong><br/>Unlike student dormitories, there are virtually no high-density clusters because large universities are located far from each other, and their demand values do not correlate with each other, i.e., universities attract foreign students regardless of their location.</p><p><strong>Q2 – Low–High (LH)</strong><br/>These are local pockets near universities with a large number of foreign students, where a particular university has low demand compared to its saturated surroundings.</p><p><strong>Q3 – Low–Low (LL)</strong><br/>For most values of the number of nearest neighbours (<code>k</code>), there is a high concentration of universities with a low number of foreign students surrounded by similar institutions. This indicates a generally uniform low density of international student demand across the city.</p><p><strong>Q4 – High–Low (HL)</strong><br/>Several universities with very high numbers of international students are isolated “peaks of demand”, not forming full-fledged spatial clusters.</p><p>In conclusion, Moran’s I scatterplots illustrate that the demand generated by international students is structurally dispersed and does not form clusters across the city.</p></div><div id="LacmiWUfpk" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">np.random.seed(55)

k_values = list(range(1, 21))
threshold = 1.0  # Customize this if needed

# Subplot grid
n_cols = 5
n_rows = (len(k_values) + n_cols - 1) // n_cols
n_plots = len(k_values)

fig, axes = plt.subplots(n_rows, n_cols, figsize=(20, 4 * n_rows))
axes = axes.flatten()

# Generate plots
for i, k in enumerate(k_values):
    ax = axes[i]
    
    # Create spatial weights matrix
    w_k = libpysal.weights.KNN.from_dataframe(uni_c, k=k)
    w_k.transform = &quot;R&quot;
    
    # Compute spatial lag for this k
    slag_col = f&#x27;!s_aus_slag_std_k{k}&#x27;
    uni_c[slag_col] = lag_spatial(w_k, uni_c[&quot;!s_aus_std&quot;])

    # Generate quadrant-based colors
    colors = []
    clusters = []
    for x, y in zip(uni_c[&#x27;!s_aus_std&#x27;], uni_c[slag_col]):
        if abs(x) &lt;= threshold and abs(y) &lt;= threshold:
            colors.append(&#x27;#FBF0EA&#x27;)         # Cream for Not Significant
            clusters.append(&#x27;NS&#x27;)
        elif x &gt; 0 and y &gt; 0:
            colors.append(&#x27;#F08080&#x27;)         # Pink
            clusters.append(&#x27;HH&#x27;)
        elif x &gt; 0 and y &lt; 0:
            colors.append(&#x27;#C8E0D4&#x27;)         # Light teal
            clusters.append(&#x27;LH&#x27;)
        elif x &lt; 0 and y &lt; 0:
            colors.append(&#x27;#5F968E&#x27;)         # Dark teal
            clusters.append(&#x27;LL&#x27;)
        elif x &lt; 0 and y &gt; 0:
            colors.append(&#x27;#FCD5CE&#x27;)         # Light Pink 
            clusters.append(&#x27;HL&#x27;)
    
    # Scatter plot
    ax.scatter(
        uni_c[&#x27;!s_aus_std&#x27;], uni_c[slag_col],
        c=colors, s=np.random.seed(55), edgecolor=&#x27;white&#x27;, linewidth=0.3, alpha=0.8
    )

    # Add regression line
    sns.regplot(
        x=&#x27;!s_aus_std&#x27;, y=slag_col, data=uni_c,
        scatter=False, ci=None, line_kws={&quot;color&quot;: &#x27;#999999&#x27;, &quot;linewidth&quot;: 1.2}, ax=ax
    )

    # Axes
    ax.axvline(0, color=&#x27;#aaaaaa&#x27;, linestyle=&#x27;--&#x27;, linewidth=0.8)
    ax.axhline(0, color=&#x27;#aaaaaa&#x27;, linestyle=&#x27;--&#x27;, linewidth=0.8)

    # Moran calculation
    moran_k = Moran(uni_c[&#x27;!s_aus&#x27;], w_k)
    moran_i = moran_k.I
    p_val = moran_k.p_sim

    # Title
    ax.set_title(f&#x27;k={k}&#x27;, fontsize=12)
    #ax.set_title(f&#x27;k={k}\nMoran\&#x27;s I = {moran_i:.3f}, P-value = {p_val:.3f}&#x27;, fontsize=9)
    # Axis labels
    if i % n_cols == 0:
        ax.set_ylabel(&quot;spatial lag of standardised university int. demand (!s_aus_slag_std)&quot;, fontsize=8)
    if i &gt;= len(k_values) - n_cols:
        ax.set_xlabel(&quot;standardised university international demand (!s_aus_std)&quot;, fontsize=8)
    if i % n_cols != 0:
        ax.set_ylabel(&#x27;&#x27;)
    if i &lt; n_plots - n_cols:
        ax.set_xlabel(&#x27;&#x27;)

    # Tight axes
    ax.set_xlim(uni_c[&#x27;!s_aus_std&#x27;].min() - 0.1, uni_c[&#x27;!s_aus_std&#x27;].max() + 0.1)
    ax.set_ylim(uni_c[slag_col].min() - 0.1, uni_c[slag_col].max() + 0.1)

# Hide any extra subplots
for j in range(len(k_values), len(axes)):
    axes[j].set_visible(False)

# Layout
fig.suptitle(&quot;Higher Education Universities International Students Demand Moran&#x27;s I Scatterplots for Different Number of Neighbours (k)&quot;, fontsize=16, y=0.98)
plt.tight_layout()
plt.subplots_adjust(top=0.93, hspace=0.5, wspace=0.5)

save_path = os.path.join(hf, &quot;Higher Education Universities International Students Demand Moran&#x27;s I Scatterplots for Different Number of Neighbours (k).png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="JejLfdvCzjhT1d_Dy5MZn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/76ac97c580c380abf688196964a3385b.png" alt="&lt;Figure size 2000x1600 with 20 Axes&gt;"/></div></div></div><div id="s6PWvpnl4C" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Higher Education Universities International Students Demand Moran’s I Scatterplots for Different Number of Neighbours (k)</em></p></div><div id="MTLmrvagU0" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">np.random.seed(55)

k_values = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
morans_I = []
p_values = []

for k in k_values:
    w = libpysal.weights.KNN.from_dataframe(uni_c, k=k)
    w.transform = &quot;R&quot;
    moran = Moran(uni_c[&#x27;!s_aus&#x27;], w)
    morans_I.append(moran.I)
    p_values.append(moran.p_sim)

# Create DataFrame
uni_k_test = pd.DataFrame({
    &#x27;k&#x27;: k_values,
    &quot;Moran&#x27;s I&quot;: morans_I,
    &#x27;P-value&#x27;: p_values
})

uni_k_test</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="h9JGIKxx3ZIyQ0WG2Auwt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="EQrKngZFaR" class="myst-jp-nb-block relative group/block"><p><em>Table XX. Higher Education Universities International Students Demand Moran’s I index and P-value for Different Number of Neighbors (k)</em></p></div><div id="vbztVq06XX" class="myst-jp-nb-block relative group/block"><p>The Moran’s I distribution graph and P-value (Figure XX) show that the P-value takes acceptable values (P &lt; 0.05) when k is between 2 and 10. Since we are talking about global spatial autocorrelation, the purpose of which is to identify patterns throughout Berlin, it is necessary to choose the maximum value of k. At the same time, the P-value when choosing 10 nearest neighbours is critically close to the significance threshold. Therefore, the previous value <code>k=9</code> was chosen.</p></div><div id="LJbtIeq2XI" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plt.figure(figsize=(6, 6))
plt.plot(uni_k_test[&#x27;k&#x27;], uni_k_test[&quot;Moran&#x27;s I&quot;], label=&quot;Moran&#x27;s I&quot;, color=&#x27;#FEC5BB&#x27;)
plt.plot(uni_k_test[&#x27;k&#x27;], uni_k_test[&#x27;P-value&#x27;], label=&#x27;P-value&#x27;, color=&#x27;#76A79D&#x27;)

plt.axhline(0.05, color=&#x27;#A9CCC1&#x27;, linestyle=&#x27;--&#x27;, linewidth=1.5, label=&quot;P = 0.05 (Significance Threshold)&quot;)
plt.grid(True, color=&#x27;#cccccc&#x27;, linestyle=&#x27;--&#x27;, alpha=0.3)

plt.xlabel(&#x27;k (number of neighbors)&#x27;)
plt.title(&quot;Moran&#x27;s I and P-value&quot;)
plt.xticks(uni_k_test[&#x27;k&#x27;])
plt.legend(loc=&#x27;best&#x27;, frameon=False)

save_path = os.path.join(hf, &quot;International Students Demand Moran’s I index and P-value for Different Number of Neighbours (k).png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OSTFR_Dx5KFoknqJ8tqLH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/5ce32cc145b4b6d0e1da132006bb3cf6.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div></div><div id="wrz1Ax6Uv0" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Higher Education Universities International Students Demand Moran’s I index and P-value for Different Number of Neighbours (k)</em></p></div><div id="faHsm01xBA" class="myst-jp-nb-block relative group/block"><h2 id="significance-threshold-test-1" class="relative group"><span class="heading-text">Significance Threshold Test</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#significance-threshold-test-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="ye7taT1utX" class="myst-jp-nb-block relative group/block"><p>By analogy with student accommodation capacity, the significance threshold was calculated as half of the median of the absolute value (<code>median_abs * 0.5</code>).</p></div><div id="AmCUfG38kq" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Option 1: Based on percentiles (recommended for your data)
threshold_percentile = np.percentile(np.abs(uni_c[&#x27;!s_aus_std&#x27;]), 75)  # 75th percentile of absolute values
print(f&quot;Option 1 - Percentile-based threshold: {threshold_percentile:.3f}&quot;)
print(f&quot;  (75th percentile of absolute values)&quot;)

# Option 2: Based on standard deviation
std_dev = uni_c[&#x27;!s_aus_std&#x27;].std()
threshold_std = 0.5 * std_dev  # 0.5 standard deviations
print(f&quot;Option 2 - Standard deviation-based threshold: {threshold_std:.3f}&quot;)
print(f&quot;  (0.5 * standard deviation)&quot;)

# Option 3: Fixed threshold based on your data range
threshold_fixed = 550.0  # Fixed value appropriate for your range
print(f&quot;Option 3 - Fixed threshold: {threshold_fixed:.3f}&quot;)
print(f&quot;  (Fixed value for your data range)&quot;)

# Option 4: Median-based threshold
median_abs = np.median(np.abs(uni_c[&#x27;!s_aus_std&#x27;]))
threshold_median = median_abs * 0.5
print(f&quot;Option 4 - Median-based threshold: {threshold_median:.3f}&quot;)
print(f&quot; (0.5 * median of absolute values)&quot;)

thresholds_to_test = [threshold_percentile, threshold_std, threshold_fixed, threshold_median]

for i, test_threshold in enumerate(thresholds_to_test, 1):
    print(f&quot;\nTest {i}: threshold = {test_threshold:.3f}&quot;)
    
    # Count points in each category
    ns_count = 0
    hh_count = 0
    lh_count = 0
    ll_count = 0
    hl_count = 0
    
    for x, y in zip(uni_c[&#x27;!s_aus_std&#x27;], uni_c[slag_col]):
        if abs(x) &lt;= test_threshold and abs(y) &lt;= test_threshold:
            ns_count += 1
        elif x &gt; 0 and y &gt; 0:
            hh_count += 1
        elif x &gt; 0 and y &lt; 0:
            lh_count += 1
        elif x &lt; 0 and y &lt; 0:
            ll_count += 1
        elif x &lt; 0 and y &gt; 0:
            hl_count += 1
    
    total = len(uni_c)
    print(f&quot;  NS: {ns_count} ({ns_count/total*100:.1f}%)&quot;)
    print(f&quot;  HH: {hh_count} ({hh_count/total*100:.1f}%)&quot;)
    print(f&quot;  LH: {lh_count} ({lh_count/total*100:.1f}%)&quot;)
    print(f&quot;  LL: {ll_count} ({ll_count/total*100:.1f}%)&quot;)
    print(f&quot;  HL: {hl_count} ({hl_count/total*100:.1f}%)&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="O4loPGXrP3xI7n9djDBcO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Option 1 - Percentile-based threshold: 679.990
  (75th percentile of absolute values)
Option 2 - Standard deviation-based threshold: 828.251
  (0.5 * standard deviation)
Option 3 - Fixed threshold: 550.000
  (Fixed value for your data range)
Option 4 - Median-based threshold: 304.745
 (0.5 * median of absolute values)

Test 1: threshold = 679.990
  NS: 54 (76.1%)
  HH: 2 (2.8%)
  LH: 6 (8.5%)
  LL: 5 (7.0%)
  HL: 4 (5.6%)

Test 2: threshold = 828.251
  NS: 64 (90.1%)
  HH: 2 (2.8%)
  LH: 5 (7.0%)
  LL: 0 (0.0%)
  HL: 0 (0.0%)

Test 3: threshold = 550.000
  NS: 23 (32.4%)
  HH: 4 (5.6%)
  LH: 7 (9.9%)
  LL: 23 (32.4%)
  HL: 14 (19.7%)

Test 4: threshold = 304.745
  NS: 5 (7.0%)
  HH: 5 (7.0%)
  LH: 7 (9.9%)
  LL: 34 (47.9%)
  HL: 20 (28.2%)
</span></code></pre></div></div></div></div><div id="dgA4zXt5nO" class="myst-jp-nb-block relative group/block"><h2 id="spatial-weights-morans-i-spatial-lag" class="relative group"><span class="heading-text">Spatial Weights &amp; Moran’s I &amp; Spatial Lag</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spatial-weights-morans-i-spatial-lag" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="vIdLIhpyhr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Generate spatial weights from the GeoDataFrame
w = KNN.from_dataframe(uni_c, k=9) 
w.transform = &quot;R&quot;  # Row-standardize weights

values = uni_c[&#x27;!s_aus&#x27;]

moran = Moran(values, w)
print(f&quot;Moran&#x27;s I: {moran.I:.3f}&quot;)
print(f&quot;P-value: {moran.p_sim:.3f}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1d6Z9dPHfBTbTNiVY1c3h" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Moran&#x27;s I: -0.082
P-value: 0.009
</span></code></pre></div></div></div></div><div id="OEx8WcYomB" class="myst-jp-nb-block relative group/block"><p>Moran’s I (<code>Moran&#x27;s I: -0.082</code>) indicates a weak negative spatial autocorrelation. In the context of urban planning, this indicates that higher education universities do not create spatial clusters; in other words, they are unevenly distributed throughout the city.</p><p>P-value (<code>P-value: 0.007</code>) indicates that the probability of obtaining such a result by chance is 0.7%, i.e., the result obtained is statistically significant.</p></div><div id="AxqjqvjTM2" class="myst-jp-nb-block relative group/block"><h2 id="spatial-lag-standardised-spatial-lag-1" class="relative group"><span class="heading-text">Spatial Lag &amp; Standardised Spatial Lag</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spatial-lag-standardised-spatial-lag-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="IFgKGTMo20" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add spatial lag and standardized columns
uni_c[&quot;!s_aus_slag&quot;] = lag_spatial(w, uni_c[&quot;!s_aus&quot;])
uni_c[&quot;!s_aus_std&quot;] = uni_c[&quot;!s_aus&quot;] - uni_c[&quot;!s_aus&quot;].mean()
uni_c[&quot;!s_aus_slag_std&quot;] = lag_spatial(w, uni_c[&quot;!s_aus_std&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="7LYUxsC7_fXd5cbVj9TMT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FEyInQViSf" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define thresholds for &quot;Not Significant&quot;
threshold = threshold_median

colors = []
clusters = []

for x, y in zip(uni_c[&#x27;!s_aus_std&#x27;], uni_c[&#x27;!s_aus_slag_std&#x27;]):
    if abs(x) &lt;= threshold and abs(y) &lt;= threshold:
        colors.append(&#x27;#FBF0EA&#x27;)         # Cream for Not Significant
        clusters.append(&#x27;NS&#x27;)
    elif x &gt; 0 and y &gt; 0:
        colors.append(&#x27;#F08080&#x27;)         # Pink
        clusters.append(&#x27;HH&#x27;)
    elif x &gt; 0 and y &lt; 0:
        colors.append(&#x27;#C8E0D4&#x27;)         # Light teal
        clusters.append(&#x27;LH&#x27;)
    elif x &lt; 0 and y &lt; 0:
        colors.append(&#x27;#5F968E&#x27;)         # Dark teal
        clusters.append(&#x27;LL&#x27;)
    elif x &lt; 0 and y &gt; 0:
        colors.append(&#x27;#FCD5CE&#x27;)         # Light Pink 
        clusters.append(&#x27;HL&#x27;)

uni_c[&#x27;color&#x27;] = colors
uni_c[&#x27;cluster_aus&#x27;] = clusters</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="se9FvXvF37McBcYf-mNU5" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="dAzPM7XziV" class="myst-jp-nb-block relative group/block"><p>The maps (Figure XX) visualise the different stages of preparing international demand data for spatial analysis.</p></div><div id="VsryloXpfs" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig, axs  = plt.subplots(2, 2, figsize=(18, 12))

# a. University Demand (!s_aus)
pgr.plot(ax=axs[0, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[0, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[0, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
uni_c.plot(ax=axs[0, 0],
          column=&#x27;!s_aus&#x27;,
          cmap=cmap_pi,
          markersize = np.sqrt(uni_c[&#x27;!s_aus&#x27;]),
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;university international demand&quot;},
          vmin=0,
          vmax=uni_c[&#x27;!s_aus&#x27;].quantile(0.95))
axs[0, 0].set_title(&#x27;a. University International Demand (!s_aus)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[0, 0].set_axis_off()

# b. University Demand Influence (!s_aus_slag)
pgr.plot(ax=axs[0, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[0, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[0, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
uni_c.plot(ax=axs[0, 1],
          column=&#x27;!s_aus_slag&#x27;,
          cmap=cmap_pi,
          markersize=np.sqrt(uni_c[&#x27;!s_aus_slag&#x27;]),
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;university international demand spatial lag&quot;},
          vmin=0,
          vmax=uni_c[&#x27;!s_aus&#x27;].quantile(0.95))
axs[0, 1].set_title(&#x27;b. University International Demand Influence (!s_aus_slag)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[0, 1].set_axis_off()

# c. Standardised University Demand (!s_all_std)
max_abs_value = max(abs(uni_c[&#x27;!s_aus_std&#x27;].min()), abs(uni_c[&#x27;!s_aus_std&#x27;].max()))
vmin, vmax = -max_abs_value, max_abs_value
pgr.plot(ax=axs[1, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[1, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[1, 0], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
uni_c.plot(ax=axs[1, 0],
          column=&#x27;!s_aus_std&#x27;,
          cmap=cmap_mintpi,
          markersize = np.sqrt(np.abs(uni_c[&#x27;!s_aus_std&#x27;])),
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;standardised university international demand&quot;},
          vmin=vmin,
          vmax=vmax)
axs[1, 0].set_title(&#x27;c. Standardised University International Demand (!s_aus_std)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[1, 0].set_axis_off()

# d. Standardised University Demand Influence (!s_aus_slag_std)
max_abs_value = max(abs(uni_c[&#x27;!s_aus_slag_std&#x27;].min()), abs(uni_c[&#x27;!s_aus_slag_std&#x27;].max()))
vmin, vmax = -max_abs_value, max_abs_value
pgr.plot(ax=axs[1, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
bz.plot(ax=axs[1, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
out.plot(ax=axs[1, 1], facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1)
uni_c.plot(ax=axs[1, 1],
          column=&#x27;!s_aus_slag_std&#x27;,
          cmap=cmap_mintpi,
          markersize=np.sqrt(np.abs(uni_c[&#x27;!s_aus_slag_std&#x27;])),
          alpha=0.9,
          edgecolor=&#x27;white&#x27;,
          linewidth=0.3,
          legend=True,
          legend_kwds={&#x27;shrink&#x27;: 0.6, &#x27;label&#x27;: &quot;standardised university international demand spatial lag&quot;},
          vmin=vmin,
          vmax=vmax)
axs[1, 1].legend(loc=&#x27;lower center&#x27;, ncol=2, frameon=False, prop={&#x27;size&#x27;: 10})
axs[1, 1].set_title(&#x27;d. Standardised University International Demand Influence (!s_aus_slag_std)&#x27;, fontsize=14, pad=15, fontweight=&#x27;bold&#x27;)
axs[1, 1].set_axis_off()

save_path = os.path.join(hf, &quot;Stages of Preparing Higher Education Universities International Students Demand Data.png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="P2w1KaT1zgYs-teeu4wT7" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/73a5cb0b0987c775b9177c49175dab20.png" alt="&lt;Figure size 1800x1200 with 8 Axes&gt;"/></div></div></div><div id="Jf5hfltZ49" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Stages of Preparing Higher Education Universities International Students Demand Data</em></p></div><div id="ku25GtmglB" class="myst-jp-nb-block relative group/block"><p>Moran’s graph (Figure XX) visualises the spatial relationships between standardised international university demand (<code>!s_aus_std</code>) and its spatial lag (<code>!s_aus_slag_std</code>). The division into four quadrants allows us to identify characteristic spatial patterns of demand distribution and understand where areas of high competition or, conversely, a lack of educational attractiveness are forming.</p><p><strong>Q1 – High–High (HH)</strong><br/>These are clusters of high international demand, where universities with a large proportion of foreign students are located next to similarly significant neighbours. Such areas form stable ‘magnets’ for international students, for example, the College of Business and Law (HWR – 1,336 foreign students), the University of the Arts Berlin (UKB – 1,244 foreign students), and ESCP Business School Berlin (ESCP – 1,092 foreign students). At the same time, two of the three universities in the HH quadrant are publicly owned (HWR and UKB) and located in Willensdorf, while the private ESCP University is located in Charlottenburg. These three universities form a powerful spatial core of global education in West Berlin.</p><p><strong>Q2 – High–Low (HL)</strong><br/>Spatial anomalies, where a university with high international demand is located among neighbouring universities with low values. This is the largest cluster among all universities. It mainly consists of individual private universities that have a localised impact and signal the beginning of the formation of new educational centres. Among the universities belonging to the HL cluster but funded by the state are the Technical University of Berlin, the Protestant University of Applied Sciences Berlin, and the Charité – University Medicine Berlin campuses in the south-west of the city.</p><p><strong>Q3 – Low–Low (LL)</strong><br/>Clusters of low demand, where both the university itself and its surroundings attract relatively few foreign students. LL zones indicate areas where international educational activity is weak, such as Pankow, Lichtenberg, Friedrichshain-Kreuzberg, and Neukölln. Among the reasons for unrealised educational potential, one can assume a lack of infrastructure, limited academic activity, or weak integration into the city’s structure.</p><p><strong>Q4 – Low–High (LH)</strong><br/>These are local failures, where a university demonstrates low international demand, but its environment demonstrates high demand. At the same time, seven of the nine universities in the LH quadrant are publicly owned. Universities such as the Free University of Berlin and Humboldt University of Berlin have the potential to participate in existing educational clusters, but are not yet strategically integrated into them.</p><p>This distribution indicates competition between universities, the existence of ‘hot spots’ of international activity, and, at the same time, structural territorial gaps.
All these patterns are important for studying the student housing crisis, as international demand directly correlates with increased pressure on the rental market, especially in highly attractive local clusters.</p></div><div id="e5xVLLJ5Vi" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">f, ax = plt.subplots(1, figsize=(6, 6))

scatter = ax.scatter(
    x=uni_c[&#x27;!s_aus_std&#x27;],
    y=uni_c[&#x27;!s_aus_slag_std&#x27;],
    c=colors,
    s=40,
    edgecolor=&#x27;white&#x27;,
    linewidth=0.3
)

sns.regplot(
    x=&#x27;!s_aus_std&#x27;,
    y=&#x27;!s_aus_slag_std&#x27;,
    ci=None,
    data=uni_c,
    scatter=False,
    line_kws={&quot;color&quot;:&#x27;#cccccc&#x27;, &quot;linewidth&quot;: 2},
    ax=ax
)

ax.axvline(0, color=&#x27;#cccccc&#x27;, alpha=0.75, linestyle=&quot;--&quot;)
ax.axhline(0, color=&#x27;#cccccc&#x27;, alpha=0.75, linestyle=&quot;--&quot;)

ax.set_title(&quot;Moran Scatterplot: Standardised University International Demand&quot;, fontsize=12, weight=&#x27;bold&#x27;)
ax.set_xlabel(&quot;standardised university international demand (!s_aus_std)&quot;, fontsize=10)
ax.set_ylabel(&quot;spatial lag of standardised university international demand (!s_aus_slag_std)&quot;, fontsize=10)

ax.text(4200, 600, &quot;High–High (HH)&quot;, fontsize=9, color=&quot;gray&quot;)
ax.text(4200, -300, &quot;Low–High (LH)&quot;, fontsize=9, color=&quot;gray&quot;) 
ax.text(-500, -300, &quot;Low–Low (LL)&quot;, fontsize=9, color=&quot;gray&quot;) #
ax.text(-500, 600, &quot;High–Low (HL)&quot;, fontsize=9, color=&quot;gray&quot;) #


ax.set_xlim(uni_c[&#x27;!s_aus_std&#x27;].min() - 0.5, uni_c[&#x27;!s_aus_std&#x27;].max() + 0.5)
ax.set_ylim(uni_c[&#x27;!s_aus_slag_std&#x27;].min() - 0.5, uni_c[&#x27;!s_aus_slag_std&#x27;].max() + 0.5)

save_path = os.path.join(hf, &quot;Higher Education Universities International Students Demand Moran Scatterplot.png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1yKp2UOCcGvU_fSSh97yh" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/47929ea370dde2f6c07b52081df23282.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div></div><div id="sne3ob59xV" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Higher Education Universities International Students Demand Moran Scatterplot</em></p></div><div id="nn4P2RIHLy" class="myst-jp-nb-block relative group/block"><p>The map showing the spatial distribution of international student demand in Berlin (Figure XX) reveals that, unlike the supply of student housing, demand does not form stable clusters of high concentration. Instead of the expected spatial agglomeration around large public universities, there is a dispersion (scattering) of values. In other words, universities with high numbers of international students are not grouped geographically, but rather distributed in a fragmented manner and often separated from similar neighbours.</p><p>The east-west divide highlights Berlin’s historical asymmetry: the West traditionally concentrates international academic demand, while the East remains unattractive in an international context.</p><p>The demand for international students is distributed more chaotically and does not correlate with the spatial patterns of student housing supply, which exacerbates the structural imbalance between the housing market and the city’s academic infrastructure.</p></div><div id="vyXrw3cC1e" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig, ax = plt.subplots(figsize=(12, 12))

# Replace pgr, bz, out with your base layers if needed
pgr.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#cccccc&#x27;, linewidth=0.5, linestyle=&quot;--&quot;)
mauer.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1.25, linestyle=&quot;--&quot;)
bz.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#999999&#x27;, linewidth=0.75)
for idx, row in bz.iterrows():
    centroid = row[&#x27;geometry&#x27;].centroid
    txt = ax.text(
        centroid.x, centroid.y,
        str(row[&#x27;namgem&#x27;]),
        fontsize=8, color=&#x27;#666666&#x27;, ha=&#x27;center&#x27;, va=&#x27;center&#x27;
    )
    txt.set_path_effects([
        path_effects.Stroke(linewidth=2, foreground=&#x27;white&#x27;),
        path_effects.Normal()
    ])

out.plot(ax=ax, facecolor=&#x27;none&#x27;, edgecolor=&#x27;#666666&#x27;, linewidth=1.25)

uni_c.plot(ax=ax,
           color=uni_c[&#x27;color&#x27;],
           markersize=np.sqrt(np.abs(uni_c[&#x27;!s_aus_std&#x27;])) + 5,
           alpha=0.9,
           edgecolor=&#x27;white&#x27;,
           linewidth=0.3)

legend_elements = [
    mpatches.Patch(color=&#x27;#F08080&#x27;, label=&#x27;High-High (HH)&#x27;, edgecolor=&#x27;none&#x27;),
    mpatches.Patch(color=&#x27;#FCD5CE&#x27;, label=&#x27;High-Low (HL)&#x27;, edgecolor=&#x27;none&#x27;),
    mpatches.Patch(color=&#x27;#C8E0D4&#x27;, label=&#x27;Low-High (LH)&#x27;, edgecolor=&#x27;none&#x27;),
    mpatches.Patch(color=&#x27;#5F968E&#x27;, label=&#x27;Low-Low (LL)&#x27;, edgecolor=&#x27;none&#x27;), 
    mpatches.Patch(color=&#x27;#FBF0EA&#x27;, label=&#x27;Not Significant (NS)&#x27;, edgecolor=&#x27;#FAE1DD&#x27;), 
]

uni_c[&#x27;color&#x27;] = colors
uni_c[&#x27;cluster&#x27;] = clusters

ax.legend(handles=legend_elements, loc=&#x27;lower center&#x27;, ncol=5, frameon=False, prop={&#x27;size&#x27;: 10})
ax.set_title(&#x27;Higher Education Universities International Demand Dispersion in Berlin&#x27;, fontsize=16, weight=&#x27;bold&#x27;)
ax.set_axis_off()

save_path = os.path.join(hf, &quot;Higher_Education_Universities_International_Demand_Dispersion_in_Berlin.png&quot;)
plt.savefig(save_path, dpi=300, bbox_inches=&quot;tight&quot;)

plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OJw8OysNqNtTNl0wF8lco" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/rethinking_student_housing/build/a85dd59dcba412f1eb12e8c283df7834.png" alt="&lt;Figure size 1200x1200 with 1 Axes&gt;"/></div></div></div><div id="NyuT2CFP8X" class="myst-jp-nb-block relative group/block"><p><em>Figure XX. Higher Education Universities International Demand Dispersion in Berlin</em></p></div><div id="TMhdNj0LqM" class="myst-jp-nb-block relative group/block"><h2 id="data-export-1" class="relative group"><span class="heading-text">Data Export</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data-export-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="Bb1LekmXup" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># List of columns to drop
cols_to_drop = [f&#x27;!s_aus_slag_std_k{i}&#x27; for i in range(1, 21)]

# Drop them from the GeoDataFrame
uni_c = uni_c.drop(columns=cols_to_drop)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="XwFokobSKHI2IoUBYH8kJ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="sTvFDLk4r3" class="myst-jp-nb-block relative group/block"><p>The data on higher education universities’ international students demand obtained as a result of global spatial autocorrelation was collected for further market analysis.</p></div><div id="NcUT1HYOae" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">hf = r&#x27;../outputs/2.4_global_spatial_autocorrelation/uni_int_demand_analysis.gpkg&#x27;
uni_c.to_file(hf, driver=&quot;GPKG&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="4aoCI6blxcW7nnyli4uFo" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/rethinking_student_housing/notebooks/descriptive-market-statistics"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">2. Capacities, Demand &amp; Spatial Distribution</div>2.3 Descriptive Market Statistics</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/rethinking_student_housing/notebooks/overview-1"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">3. Student Housing Market Imbalance</div>3.1 Overview</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/rethinking_student_housing/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-7UUHRSK3.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/root-EDJFWIEV.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/_shared/chunk-ECLX7DIY.js"/><link rel="modulepreload" href="/rethinking_student_housing/build/routes/$-AD65NCUT.js"/><script>window.__remixContext = {"url":"/notebooks/global-spatial-autocorrelation","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/rethinking_student_housing/build/logo-18e48197487fb9b98f6d8e7252c859f7.png","folders":true},"nav":[],"actions":[],"projects":[{"bibliography":["references.bib"],"exports":[],"title":"Rethinking Student Housing in Berlin","authors":[{"nameParsed":{"literal":"Lazareva Nataliia","given":"Lazareva","family":"Nataliia"},"name":"Lazareva Nataliia","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Urban Design M.Sc.","given":"Urban Design","family":"M.Sc."},"name":"Urban Design M.Sc.","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Technical University of Berlin","given":"Technical University","non_dropping_particle":"of","family":"Berlin"},"name":"Technical University of Berlin","id":"contributors-myst-generated-uid-2"}],"github":"https://github.com/natashlazarpro/rethinking_student_housing","copyright":"2025","toc":[{"file":"intro.md"},{"children":[{"file":"notebooks/0.1_title_page.md"},{"file":"markdowns/0.2_table_of_contens.md"},{"file":"notebooks/0.3_list_of_figures.ipynb"},{"file":"notebooks/0.4_list_of_tables.ipynb"}],"title":"0. Prelimitary Pages"},{"children":[{"file":"notebooks/1.1_european_student_accommodation_crisis.ipynb"},{"file":"notebooks/1.2_berlin_housing_crisis_history.md"},{"file":"notebooks/1.3_theoretical_framework.md"},{"file":"notebooks/1.4_rethinking_student_housing.md"}],"title":"1. Introduction"},{"children":[{"file":"notebooks/2.1_overview.md"},{"file":"notebooks/2.2_urban_data_mining.ipynb"},{"file":"notebooks/2.3_descriptive_market_statistics.ipynb"},{"file":"notebooks/2.4_global_spatial_autocorrelation.ipynb"}],"title":"2. Capacities, Demand \u0026 Spatial Distribution"},{"children":[{"file":"notebooks/3.1_overview.md"},{"file":"notebooks/3.2_central_place_analysis.ipynb"},{"file":"notebooks/3.3_market_pressure_analysis.ipynb"}],"title":"3. Student Housing Market Imbalance"},{"children":[{"file":"notebooks/4.1_overview.md"},{"file":"notebooks/4.2_students_needs_and_preferences.ipynb"},{"file":"notebooks/4.3_students_experiences.ipynb"}],"title":"4. Students Behind the Numbers"},{"children":[{"file":"notebooks/5.1_conclusion.md"},{"file":"notebooks/5.2_discussion.md"},{"file":"notebooks/5.3_future_research.md"}],"title":"5. Data-Driven Decisions"},{"children":[{"file":"notebooks/6.1_references.ipynb"},{"file":"notebooks/xx_materials_and_data.ipynb"},{"file":"notebooks/xx_behavioral_study"},{"file":"notebooks/xx_color_palettes.ipynb"}],"title":"6. Appendix"}],"index":"index","pages":[{"level":1,"title":"0. Prelimitary Pages"},{"slug":"notebooks.title-page","title":"0.1 Title Page","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdowns.table-of-contens","title":"0.2 Table of Contents","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.list-of-figures","title":"0.3 List of Figures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.list-of-tables","title":"0.4 List of Tables","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"1. Introduction"},{"slug":"notebooks.european-student-accommodation-crisis","title":"1.1 European Student Accommodation Crisis","description":"","date":"","thumbnail":"/rethinking_student_housing/build/countries_map-714d24d02c18e6dbce203f91f0a0c573.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.berlin-housing-crisis-history","title":"1.2 Berlin Housing Crisis History","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.theoretical-framework","title":"1.3 Theoretical Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.rethinking-student-housing","title":"1.4 Rethinking Student Housing in Berlin","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2. Capacities, Demand \u0026 Spatial Distribution"},{"slug":"notebooks.overview","title":"2.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.urban-data-mining","title":"2.2 Urban Data Mining","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.descriptive-market-statistics","title":"2.3 Descriptive Market Statistics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.global-spatial-autocorrelation","title":"2.4 Global Spatial Autocorrelation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"3. Student Housing Market Imbalance"},{"slug":"notebooks.overview-1","title":"3.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.central-place-analysis","title":"3.2 Central Place Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.market-pressure-analysis","title":"3.3 Market Pressure Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"4. Students Behind the Numbers"},{"slug":"notebooks.overview-2","title":"4.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.students-needs-and-preferences","title":"4.2 Student Needs and Preferences","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.students-experiences","title":"4.3 Student Experiences","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"5. Data-Driven Decisions"},{"slug":"notebooks.conclusion","title":"5.1 Conclusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.discussion","title":"5.2 Reflection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.future-research","title":"5.3 Future Research","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"6. Appendix"},{"slug":"notebooks.references","title":"6.1 References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.xx-materials-and-data","title":"Material \u0026 Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.xx-color-palettes","title":"Colour Palettes Design","description":"","date":"","thumbnail":"/rethinking_student_housing/build/color_test-b14dc3465d49509a7b93f53f06a18503.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/rethinking_student_housing"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"logo":"/rethinking_student_housing/build/logo-18e48197487fb9b98f6d8e7252c859f7.png","folders":true},"nav":[],"actions":[],"projects":[{"bibliography":["references.bib"],"exports":[],"title":"Rethinking Student Housing in Berlin","authors":[{"nameParsed":{"literal":"Lazareva Nataliia","given":"Lazareva","family":"Nataliia"},"name":"Lazareva Nataliia","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Urban Design M.Sc.","given":"Urban Design","family":"M.Sc."},"name":"Urban Design M.Sc.","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Technical University of Berlin","given":"Technical University","non_dropping_particle":"of","family":"Berlin"},"name":"Technical University of Berlin","id":"contributors-myst-generated-uid-2"}],"github":"https://github.com/natashlazarpro/rethinking_student_housing","copyright":"2025","toc":[{"file":"intro.md"},{"children":[{"file":"notebooks/0.1_title_page.md"},{"file":"markdowns/0.2_table_of_contens.md"},{"file":"notebooks/0.3_list_of_figures.ipynb"},{"file":"notebooks/0.4_list_of_tables.ipynb"}],"title":"0. Prelimitary Pages"},{"children":[{"file":"notebooks/1.1_european_student_accommodation_crisis.ipynb"},{"file":"notebooks/1.2_berlin_housing_crisis_history.md"},{"file":"notebooks/1.3_theoretical_framework.md"},{"file":"notebooks/1.4_rethinking_student_housing.md"}],"title":"1. Introduction"},{"children":[{"file":"notebooks/2.1_overview.md"},{"file":"notebooks/2.2_urban_data_mining.ipynb"},{"file":"notebooks/2.3_descriptive_market_statistics.ipynb"},{"file":"notebooks/2.4_global_spatial_autocorrelation.ipynb"}],"title":"2. Capacities, Demand \u0026 Spatial Distribution"},{"children":[{"file":"notebooks/3.1_overview.md"},{"file":"notebooks/3.2_central_place_analysis.ipynb"},{"file":"notebooks/3.3_market_pressure_analysis.ipynb"}],"title":"3. Student Housing Market Imbalance"},{"children":[{"file":"notebooks/4.1_overview.md"},{"file":"notebooks/4.2_students_needs_and_preferences.ipynb"},{"file":"notebooks/4.3_students_experiences.ipynb"}],"title":"4. Students Behind the Numbers"},{"children":[{"file":"notebooks/5.1_conclusion.md"},{"file":"notebooks/5.2_discussion.md"},{"file":"notebooks/5.3_future_research.md"}],"title":"5. Data-Driven Decisions"},{"children":[{"file":"notebooks/6.1_references.ipynb"},{"file":"notebooks/xx_materials_and_data.ipynb"},{"file":"notebooks/xx_behavioral_study"},{"file":"notebooks/xx_color_palettes.ipynb"}],"title":"6. Appendix"}],"index":"index","pages":[{"level":1,"title":"0. Prelimitary Pages"},{"slug":"notebooks.title-page","title":"0.1 Title Page","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdowns.table-of-contens","title":"0.2 Table of Contents","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.list-of-figures","title":"0.3 List of Figures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.list-of-tables","title":"0.4 List of Tables","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"1. Introduction"},{"slug":"notebooks.european-student-accommodation-crisis","title":"1.1 European Student Accommodation Crisis","description":"","date":"","thumbnail":"/rethinking_student_housing/build/countries_map-714d24d02c18e6dbce203f91f0a0c573.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.berlin-housing-crisis-history","title":"1.2 Berlin Housing Crisis History","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.theoretical-framework","title":"1.3 Theoretical Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.rethinking-student-housing","title":"1.4 Rethinking Student Housing in Berlin","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2. Capacities, Demand \u0026 Spatial Distribution"},{"slug":"notebooks.overview","title":"2.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.urban-data-mining","title":"2.2 Urban Data Mining","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.descriptive-market-statistics","title":"2.3 Descriptive Market Statistics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.global-spatial-autocorrelation","title":"2.4 Global Spatial Autocorrelation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"3. Student Housing Market Imbalance"},{"slug":"notebooks.overview-1","title":"3.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.central-place-analysis","title":"3.2 Central Place Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.market-pressure-analysis","title":"3.3 Market Pressure Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"4. Students Behind the Numbers"},{"slug":"notebooks.overview-2","title":"4.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.students-needs-and-preferences","title":"4.2 Student Needs and Preferences","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.students-experiences","title":"4.3 Student Experiences","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"5. Data-Driven Decisions"},{"slug":"notebooks.conclusion","title":"5.1 Conclusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.discussion","title":"5.2 Reflection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.future-research","title":"5.3 Future Research","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"6. Appendix"},{"slug":"notebooks.references","title":"6.1 References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.xx-materials-and-data","title":"Material \u0026 Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.xx-color-palettes","title":"Colour Palettes Design","description":"","date":"","thumbnail":"/rethinking_student_housing/build/color_test-b14dc3465d49509a7b93f53f06a18503.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"e8bb9eb9d8f87e8c1255dac7010cbbaa8765e7a947c24e755848f54fe900aa3a","slug":"notebooks.global-spatial-autocorrelation","location":"/notebooks/2.4_global_spatial_autocorrelation.ipynb","dependencies":[],"frontmatter":{"title":"2.4 Global Spatial Autocorrelation","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"geodatascience2.0","language":"python"},"authors":[{"nameParsed":{"literal":"Lazareva Nataliia","given":"Lazareva","family":"Nataliia"},"name":"Lazareva Nataliia","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Urban Design M.Sc.","given":"Urban Design","family":"M.Sc."},"name":"Urban Design M.Sc.","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Technical University of Berlin","given":"Technical University","non_dropping_particle":"of","family":"Berlin"},"name":"Technical University of Berlin","id":"contributors-myst-generated-uid-2"}],"github":"https://github.com/natashlazarpro/rethinking_student_housing","copyright":"2025","numbering":{"title":{"offset":1}},"source_url":"https://github.com/natashlazarpro/rethinking_student_housing/blob/main/student-housing-book/notebooks/2.4_global_spatial_autocorrelation.ipynb","edit_url":"https://github.com/natashlazarpro/rethinking_student_housing/edit/main/student-housing-book/notebooks/2.4_global_spatial_autocorrelation.ipynb","exports":[{"format":"ipynb","filename":"2.4_global_spatial_autocorrelation.ipynb","url":"/rethinking_student_housing/build/2.4_global_spatial_a-24cc925dd17f6c555b9e4329354091b2.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import warnings\n\nwarnings.filterwarnings(\"ignore\")\n\nimport os\nhf = r'../outputs/2.4_global_spatial_autocorrelation/'\nos.makedirs(hf, exist_ok=True)","visibility":"show","key":"XUEKL1rXkg"},{"type":"outputs","id":"7j_jzGDleFDnDJUckLZvT","children":[],"visibility":"show","key":"ucfDN2Qsaq"}],"visibility":"remove","key":"FTWalqFRYr"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.4 Global Spatial Autocorrelation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VFhspsq2Na"}],"identifier":"id-2-4-global-spatial-autocorrelation","label":"2.4 Global Spatial Autocorrelation","html_id":"id-2-4-global-spatial-autocorrelation","implicit":true,"key":"FLJp1xjchU"}],"key":"g1jqZjezAW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In the Descriptive Market Statistics Chapter, a descriptive analysis of two datasets was conducted: student accommodations and higher education universities. However, in order to access spatial distribution across cities, it is necessary to measure spatial dependency.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XPRTXms0EK"}],"key":"uTd8PliPbN"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Spatial autocorrelation measures spatial dependency. In other words, how much the value of a variable in a specific location is related to the values of the same variable at neighboring locations. Spatial autocorrelation (either positive or negative) is a key concept in geographic analysis. Spatial autocorrelation can be explained by the first law of geography. According to the law, objects in a neighborhood tend to have more similarities and interactions than those lying further away (Grekousis, 2020).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nVn2dNC1a5"}],"key":"QgSBmHkQnf"}],"key":"jBnJOop23e"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set Up","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VYZv0vzrjw"}],"identifier":"set-up","label":"Set Up","html_id":"set-up","implicit":true,"key":"XauTBUYNsN"}],"key":"ns5gcIMZFz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C8rqqawP5p"}],"key":"frJ2z6eY9m"}],"key":"rzZomLaits"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport numpy as np  \nimport pandas as pd \nimport matplotlib.pyplot as plt  \nimport matplotlib as mpl \nimport seaborn as sns \nfrom matplotlib.colors import LinearSegmentedColormap  \nimport matplotlib.patches as mpatches  \nimport matplotlib.patheffects as path_effects  \nimport geopandas as gpd  \nfrom shapely.geometry import Point, MultiPoint  \nfrom pyproj import CRS  \nfrom scipy.stats import norm \nimport libpysal  \nfrom esda import Moran \nfrom libpysal.weights.spatial_lag import lag_spatial \nfrom libpysal.weights import KNN \nfrom libpysal.weights import weights","key":"Od3IX56MCe"},{"type":"outputs","id":"3wEyWxky0WKjlD1WEQtVT","children":[],"key":"S01g1SqBHw"}],"key":"rW3OOcn70U"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Colors","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZD5EwCdCRW"}],"key":"ij9Khw8qRc"}],"visibility":"remove","key":"PL7I8y5kRa"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"color_palettes = {\n    \"Mint\": [\"#EAF4E8\", \"#C8E0D4\", \"#A9CCC1\", \"#8FB9AE\", \"#76A79D\", \"#5F968E\", \"#498581\"], \n    \"Pi\": [\"#F8EDEB\", \"#FAE1DD\", \"#FCD5CE\", \"#FEC5BB\", \"#F8AD9D\", \"#F4978E\", \"#F08080\"],\n    \"Or\": [\"#FFE5D9\", \"#FFD7BA\", \"#FEC89A\", \"#FFB78F\", \"#F49F7D\", \"#F28B6D\", \"#E1755CFF\"],\n    \"GrSc\":  ['#EFEFEF', '#D9D9D9', '#CCCCCC', '#B7B7B7', '#999999', '#666666', '#434343'],\n    \"MintPi\": [\"#76A79D\", \"#8FB9AE\", \"#A9CCC1\", \"#C8E0D4\", \"#FBF0EA\", \"#FCD5CE\", \"#FEC5BB\", \"#F8AD9D\", \"#F4978E\"],\n    \"MintOr\": [\"#76A79D\", \"#8FB9AE\", \"#A9CCC1\", \"#C8E0D4\", \"#FBF0EA\", \"#FFD7BA\", \"#FEC89A\", \"#FFB78F\", \"#F28B6D\"],\n    \"MiPiOr\": ['#EAF4E8', '#FAE1DD', '#C8E0D4', '#FFD7BA', '#F8EDEB', '#FCD5CE', '#FFE5D9']\n} \n\nfrom matplotlib.colors import LinearSegmentedColormap\n\ncmap_mint = LinearSegmentedColormap.from_list(\"Mint\", color_palettes[\"Mint\"])\ncmap_pi = LinearSegmentedColormap.from_list(\"Pi\", color_palettes[\"Pi\"])\ncmap_or = LinearSegmentedColormap.from_list(\"Or\", color_palettes[\"Or\"])\ncmap_mintpi = LinearSegmentedColormap.from_list(\"MintPi\", color_palettes[\"MintPi\"])\ncmap_mintor = LinearSegmentedColormap.from_list(\"MintOr\", color_palettes[\"MintOr\"])\ncmap_grsc = LinearSegmentedColormap.from_list(\"GrSc\", color_palettes[\"GrSc\"])\ncmap_mipior = LinearSegmentedColormap.from_list(\"MiPiOr\", color_palettes[\"MiPiOr\"])","visibility":"show","key":"zDIgE0nbuy"},{"type":"outputs","id":"rgHRrdghTlcmJJVuhbqc0","children":[],"visibility":"show","key":"cqCpuwyPnk"}],"visibility":"remove","key":"fkpRWp4mZ1"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Font","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YXMarszG4J"}],"key":"rCbK64FP61"}],"visibility":"remove","key":"VY6vPi6TCL"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.rcParams[\"font.family\"] = \"Helvetica\"","visibility":"show","key":"NdagRRSBbC"},{"type":"outputs","id":"ahiKc_9b0OL2natnZxpzm","children":[],"visibility":"show","key":"uiaygA31fj"}],"visibility":"remove","key":"L5uesGEqu7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Berlin Spatial Boundaries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DdLZzMPRN9"}],"key":"lzrMJwY3nV"}],"key":"YFKOJ5qIQs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pf = r\"../inputs/2.4_global_spatial_autocorrelation/lor_pgr.gpkg\"\npgr = gpd.read_file(pf)\npgr.replace({'-': np.nan, 0: np.nan, '': np.nan}, inplace=True)\n\nbf = r\"../inputs/2.4_global_spatial_autocorrelation/adm_bz.gpkg\"\nbz = gpd.read_file(bf)\nbz.replace({'-': np.nan, 0: np.nan, '': np.nan}, inplace=True)\n\nof = r\"../inputs/2.4_global_spatial_autocorrelation/adm_out.gpkg\"\nout = gpd.read_file(of)\nout.replace({'-': np.nan, 0: np.nan, '': np.nan}, inplace=True)\n\nmf = r\"../inputs/2.4_global_spatial_autocorrelation/berlin_mauer.gpkg\"\nmauer = gpd.read_file(mf)\nmauer.replace({'-': np.nan, 0: np.nan, '': np.nan}, inplace=True)","key":"Jh29qkaQ3P"},{"type":"outputs","id":"GVgxhOqQ9zmNmQcHtC9wL","children":[],"key":"w6Ykra8n8i"}],"key":"K4724uOZyD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Student Accommodation Capacity","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hZemcQZKdx"}],"identifier":"student-accommodation-capacity","label":"Student Accommodation Capacity","html_id":"student-accommodation-capacity","implicit":true,"key":"SWCwZCwtKY"}],"key":"sZhOxSZGSZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Import","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SMauJNdm7E"}],"identifier":"data-import","label":"Data Import","html_id":"data-import","implicit":true,"key":"vmXMK9I066"}],"key":"uHZ987bUZn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The data obtained as a result of Urban Data Mining was used as input data for the analysis (since no changes were made to the data during Descriptive Market Statistics).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E1xlqOQFiS"}],"key":"iecF3mIzJw"}],"key":"nOiWUUV7ZC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pf = r\"../inputs/2.4_global_spatial_autocorrelation/pbsa_c.gpkg\"\npbsa_c = gpd.read_file(pf)","key":"Q82lO480vV"},{"type":"outputs","id":"CGw7ArmDBWYAHHWmr84FP","children":[],"key":"FibrtGrW7N"}],"key":"p8aW9XeBH8"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Before calculating global spatial autocorrelation, it is also necessary to perform tests: Moran’s I Scatterplots Test and K-Nearest Neighbor Test, as well as calculate the Significance Threshold test.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yl3VJyGjGW"}],"key":"JL9R86mbYF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Since the research focused on market parameters, global autocorrelation will focus on ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wEAgUR0PP2"},{"type":"inlineCode","value":"capacity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"igTj6MHNGS"},{"type":"text","value":", which measures the market supply.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SnfjaVw6d9"}],"key":"if7FvDZqvd"}],"key":"aFdz6pDfFS"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Standartalisation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lLdPbrYJ4P"}],"identifier":"standartalisation","label":"Standartalisation","html_id":"standartalisation","implicit":true,"key":"hLsR4ZgZtO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data standardisation is used to assess the correlation of neighbouring values relative to the overall average and to eliminate the outliers identified in the previous chapter. Standardisation converts data into dimensionless values, which allows for accurate comparison of clustering for different student accommodations. Positive standardised capacity values (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j7yOCciTNV"},{"type":"inlineCode","value":"!cap_std","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LflhjeaTwf"},{"type":"text","value":") indicate above-average objects, while negative values indicate below-average objects. This will help to clearly identify student accommodation clusters in the future.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dCmdzuIA4S"}],"key":"noIILfmOjD"}],"key":"oKF3rRGXiR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pbsa_c[\"!cap_std\"] = pbsa_c[\"!cap\"] - pbsa_c[\"!cap\"].mean()","key":"kz7CCkOVt7"},{"type":"outputs","id":"SZ3xEMXWJe2RG5qiDkPf9","children":[],"key":"pVNMgyPjJ8"}],"key":"sfCFzuEPBz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Moran’s I Scatterplots Test \u0026 K-Nearest Neighbor Test","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G6bVYjAo4I"}],"identifier":"morans-i-scatterplots-test-k-nearest-neighbor-test","label":"Moran’s I Scatterplots Test \u0026 K-Nearest Neighbor Test","html_id":"morans-i-scatterplots-test-k-nearest-neighbor-test","implicit":true,"key":"hClv5nm0pV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Several diagnostic measures can be used to identify spatial autocorrelation. Those that estimate spatial autocorrelation by a single value for the entire study area are named global spatial autocorrelation measures. The most commonly used is Moran’s I (Grekousis, 2020).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vZsdjVY9Nw"}],"key":"AW4aYeEFlD"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Moran’s I","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"am3gJ9I5SN"}],"key":"pRhFcttOuB"},{"type":"text","value":" computes global spatial autocorrelation by taking into account","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qrBapCHwJV"},{"type":"break","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"I46YiLdpTJ"},{"type":"text","value":"feature locations and attribute values (of a single attribute) simultaneously.\nIt is calculated by the following formula:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"O9mSyesbEQ"}],"key":"ZXAojflspv"},{"type":"math","value":"I = \\frac{n}{\\sum_i \\sum_j w_{ij}} \\cdot \n\\frac{\\sum_i \\sum_j w_{ij}(x_i - \\bar{x})(x_j - \\bar{x})}\n{\\sum_i (x_i - \\bar{x})^2}","position":{"start":{"line":9,"column":1},"end":{"line":13,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmfrac\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmrow\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/munder\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/munder\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmfrac\u003e\u003cmrow\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/munder\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/munder\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmo\u003eˉ\u003c/mo\u003e\u003c/mover\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmo\u003eˉ\u003c/mo\u003e\u003c/mover\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/munder\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmo\u003eˉ\u003c/mo\u003e\u003c/mover\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eI = \\frac{n}{\\sum_i \\sum_j w_{ij}} \\cdot \n\\frac{\\sum_i \\sum_j w_{ij}(x_i - \\bar{x})(x_j - \\bar{x})}\n{\\sum_i (x_i - \\bar{x})^2}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.2294em;vertical-align:-1.1218em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.1076em;\"\u003e\u003cspan style=\"top:-2.314em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mop\"\u003e\u003cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\"\u003e∑\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.162em;\"\u003e\u003cspan style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2997em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop\"\u003e\u003cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\"\u003e∑\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.162em;\"\u003e\u003cspan style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.4358em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.677em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.1218em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.5615em;vertical-align:-0.9857em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.5758em;\"\u003e\u003cspan style=\"top:-2.314em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mop\"\u003e\u003cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\"\u003e∑\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.162em;\"\u003e\u003cspan style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2997em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5678em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.2222em;\"\u003e\u003cspan class=\"mord\"\u003eˉ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.7401em;\"\u003e\u003cspan style=\"top:-2.989em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.8258em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mop\"\u003e\u003cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\"\u003e∑\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.162em;\"\u003e\u003cspan style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2997em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop\"\u003e\u003cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\"\u003e∑\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.162em;\"\u003e\u003cspan style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.4358em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5678em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.2222em;\"\u003e\u003cspan class=\"mord\"\u003eˉ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5678em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.2222em;\"\u003e\u003cspan class=\"mord\"\u003eˉ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9857em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"1","key":"hZo4HqFmzx"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"where:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"y2iTeb8Uro"}],"key":"jIuQ8yujvW"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"n — number of spatial features","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"tSQqvD8yul"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"HXK0bGahYa"},{"type":"text","value":"xᵢ — attribute value of feature i (a variable in a spatial analysis context)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"dZIx2xcnvZ"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"kqDh5h5rwR"},{"type":"text","value":"xⱼ — attribute value of feature j","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Um27VDyIJo"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"msS8zEjmkF"},{"type":"text","value":"x̄ — mean of this attribute","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ssXqvTHLLK"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"g6idq5bm9a"},{"type":"text","value":"wᵢⱼ — spatial weight between feature i and j","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"YvNqAAsp5v"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"HXtwZEazDS"},{"type":"text","value":"∑ᵢ∑ⱼ wᵢⱼ — aggregation of all spatial weights","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Dap84xRs47"}],"key":"Tpr2pgZgAq"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"In order to calculate spatial weights between features, K-nearest neighbor weights are used. K-nearest neighbor weights are distance-based weights defines the neighbor set of a particular observation as containing its nearest observations, where the user specifies the number of nearest neighbors (","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"WcF9bDnnDi"},{"type":"inlineCode","value":"k","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"FTqfaXx0jm"},{"type":"text","value":"). If we do not test ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"LmvpP8fFnF"},{"type":"inlineCode","value":"k","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"LXVqn1U5UB"},{"type":"text","value":", Moran’s I Index might have values beyond the [-1,1] boundaries (Grekousis, 2020).","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"QJclyJvFA5"}],"key":"SLT4n5ZOH1"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"To understand the intuition behind its math, it is useful to begin with a graphical interpretation: the Moran Plot for different numbers of neighbors (Figure XX). The Moran Plot is a way of visualizing a spatial dataset to explore the nature and strength of spatial autocorrelation. It is essentially a traditional scatter plot in which the variable of interest is displayed against its spatial lag (Rey et al., 2023).","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"nP4vorcA6v"}],"key":"QWwowPaclN"}],"key":"roVmZK4SCi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Moran’s I scatterplots (Figure XX) across increasing k-values (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mJOtU05ddI"},{"type":"inlineCode","value":"k_values = list(range(1, 21))","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cq5wtF1Er1"},{"type":"text","value":") reveal that student accommodation capacity in Berlin exhibits a weak but consistently positive spatial autocorrelation, which strengthens as the neighborhood definition expands. Each point represents a student accommodation and its relationship to the capacities of its surrounding neighbors. The four quadrants provide insight into the spatial logic of student housing distribution:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cBh21dcASk"}],"key":"URuMt3LCAG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Q1 – High–High (HH)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FLxdAiBkvD"}],"key":"Ifaw78tQKY"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CSznboOyX5"},{"type":"text","value":"These locations have high student accommodation capacity and are surrounded by other areas with similarly high capacities. These clusters signal where the market has already developed a strong supply.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rWfSWQW2Xe"}],"key":"iP8VJ9y9Ad"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Q2 – Low–High (LH)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"LKt0ueaspD"}],"key":"YiKSVrMcM4"},{"type":"break","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"T9a6wJg0xi"},{"type":"text","value":"These student accommodations have low capacity themselves, but are neighboring high-capacity ones. They often represent transition zones—places that have the potential to absorb future student housing development because they border well-served districts. These locations highlight opportunity areas where relatively small additions could significantly improve spatial balance.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JQ5R6ovB4l"}],"key":"Nkldb2YsHC"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Q3 – Low–Low (LL)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Jc3VRBDJhQ"}],"key":"HCj9km4oHc"},{"type":"break","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"oTSCBoBPYo"},{"type":"text","value":"These locations exhibit low capacity and are surrounded by other low-capacity areas, marking systemic undersupply zones. For policy-making, these locations indicate structurally disadvantaged parts of the city, where students face limited options.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"VzgkqWwgIB"}],"key":"qdNJm8CKet"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Q4 – High–Low (HL)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"qCvQjJqR2a"}],"key":"PWnum8zkvp"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"hJaeDeNstp"},{"type":"text","value":"These student accommodations have high capacity but are surrounded by low-capacity neighbors. Such areas represent isolated clusters—individual dorms or private student residences located in otherwise undersupplied districts. They highlight mismatches where supply exists but lacks integration into broader student housing networks, potentially limiting accessibility.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"X6mKlmNH1V"}],"key":"s1Hjn4lrqq"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"In conclusion, the Moran’s I scatterplots illustrate that Berlin’s student housing supply is spatially uneven, featuring concentrated high-capacity cores, isolated developments, transitional opportunity zones, and persistent undersupply areas.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"OWabLE7CXS"}],"key":"cc2xLML7Af"}],"key":"kiXnZIj8aE"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"np.random.seed(55)\n\npbsa_c[\"!cap_std\"] = pbsa_c[\"!cap\"] - pbsa_c[\"!cap\"].mean()\n\n# Define k values and threshold\nk_values = list(range(1, 21))\nthreshold = 1.0  # Customize this if needed\n\n# Subplot grid\nn_cols = 5\nn_rows = (len(k_values) + n_cols - 1) // n_cols\nn_plots = len(k_values)\n\nfig, axes = plt.subplots(n_rows, n_cols, figsize=(20, 4 * n_rows))\naxes = axes.flatten()\n\n# Generate plots\ndef new_func(k, ax, moran_i, p_val):\n    #ax.set_title(f'k={k}\\nMoran\\'s I = {moran_i:.3f}, P-value = {p_val:.3f}', fontsize=9)\n    ax.set_title(f'k={k}', fontsize=12)\n\nfor i, k in enumerate(k_values):\n    ax = axes[i]\n    \n    # Create spatial weights matrix\n    w_k = libpysal.weights.KNN.from_dataframe(pbsa_c, k=k)\n    w_k.transform = \"R\"\n    \n    # Compute spatial lag for this k\n    slag_col = f'!cap_slag_std_k{k}'\n    pbsa_c[slag_col] = lag_spatial(w_k, pbsa_c[\"!cap_std\"])\n\n    # Generate quadrant-based colors\n    colors = []\n    clusters = []\n    for x, y in zip(pbsa_c['!cap_std'], pbsa_c[slag_col]):\n        if abs(x) \u003c= threshold and abs(y) \u003c= threshold:\n            colors.append('#FBF0EA')  # Cream = Not Significant\n            clusters.append('NS')\n        elif x \u003e 0 and y \u003e 0:\n            colors.append('#F28B6D')  # Coral = High-High\n            clusters.append('HH')\n        elif x \u003e 0 and y \u003c 0:\n            colors.append('#C8E0D4')  # Light teal = Low-High\n            clusters.append('LH')\n        elif x \u003c 0 and y \u003c 0:\n            colors.append('#5F968E')  # Dark teal = Low-Low\n            clusters.append('LL')\n        elif x \u003c 0 and y \u003e 0:\n            colors.append('#FEC89A')  # Peach = High-Low\n            clusters.append('HL')\n    \n    # Scatter plot\n    ax.scatter(\n        pbsa_c['!cap_std'], pbsa_c[slag_col],\n        c=colors, s=np.random.seed(55), edgecolor='white', linewidth=0.3, alpha=0.8\n    )\n\n    # Add regression line\n    sns.regplot(\n        x='!cap_std', y=slag_col, data=pbsa_c,\n        scatter=False, ci=None, line_kws={\"color\": '#999999', \"linewidth\": 1.2}, ax=ax\n    )\n\n    # Axes\n    ax.axvline(0, color='#aaaaaa', linestyle='--', linewidth=0.8)\n    ax.axhline(0, color='#aaaaaa', linestyle='--', linewidth=0.8)\n\n    # Moran calculation\n    moran_k = Moran(pbsa_c['!cap'], w_k)\n    moran_i = moran_k.I\n    p_val = moran_k.p_sim\n\n    # Title\n    new_func(k, ax, moran_i, p_val)\n\n    # Axis labels (only for edges)\n    if i % n_cols == 0:\n        ax.set_ylabel('spatial lag of standardised capacity (!cap_slag_std)', fontsize=9)\n    if i \u003e= n_plots - n_cols:\n        ax.set_xlabel('standardised capacity (!cap_std)', fontsize=12)\n    if i % n_cols != 0:\n        ax.set_ylabel('')\n    if i \u003c n_plots - n_cols:\n        ax.set_xlabel('')\n\n    # Tight axes\n    ax.set_xlim(pbsa_c['!cap_std'].min() - 0.1, pbsa_c['!cap_std'].max() + 0.1)\n    ax.set_ylim(pbsa_c[slag_col].min() - 0.1, pbsa_c[slag_col].max() + 0.1)\n\n# Hide any extra subplots\nfor j in range(len(k_values), len(axes)):\n    axes[j].set_visible(False)\n\n# Layout\nfig.suptitle(\"Student Accommodation Capacity Moran's I Scatterplots for Different Number of Neighbours (k)\", fontsize=16, y=0.98)\nplt.subplots_adjust(top=0.93, hspace=0.5, wspace=0.5)\n\nsave_path = os.path.join(hf, \"Student Accommodation Capacity Moran's I Scatterplots for Different Number of Neighbours (k).png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"OH1Lmi2Y13"},{"type":"outputs","id":"8KmaT7dCJjzRIbbyhq7i9","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f7eab9b49d321ccc8d4410ca3d389419","path":"/rethinking_student_housing/build/f7eab9b49d321ccc8d4410ca3d389419.png"},"text/plain":{"content":"\u003cFigure size 2000x1600 with 20 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"ZT7pGVZQux"}],"visibility":"show","key":"R8KuixyjzQ"}],"visibility":"show","key":"hDhopAgJ0f"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Student Accommodation Capacity Moran’s I Scatterplots for Different Number of Neighbours (k)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EtqY2WFl1N"}],"key":"fDdwGTWfCp"}],"key":"n0mTT6pmLG"}],"key":"homhOsU0rV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The difference between the scatterplots (Figure XX) must be evaluated based on Moran’s I index and P-value. Through these metrics, we assess whether spatial autocorrelation is statistically significant. To do this, we need to calculate the parameters for each value of the number of nearest neighbors (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nGpm2AUkqQ"},{"type":"inlineCode","value":"k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ui3E1ktrWh"},{"type":"text","value":") (Table XX).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WVYo11m1s9"}],"key":"VGhQIazbHS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Moran’s I index and P-value can be interpreted as follows. A Moran’s I index score higher than 0.3 is an indication of relatively strong positive autocorrelation, while a score lower than -0.3 is an indication of relatively strong negative autocorrelation. If the p-value is large (usually p \u003e 0.05), the results are not statistically significant, and we cannot reject spatial dependency (Grekousis, 2020).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jcj8W5eBig"}],"key":"qY0jn4ci0F"}],"key":"LUUbTpfpki"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"np.random.seed(55)\n\nk_values = [ 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]\nmorans_I = []\np_values = []\n\nfor k in k_values:\n    w = libpysal.weights.KNN.from_dataframe(pbsa_c, k=k)\n    w.transform = \"R\"\n    moran = Moran(pbsa_c['!cap'], w)\n    morans_I.append(moran.I)\n    p_values.append(moran.p_sim)\n\n# Create DataFrame\npbsa_k_test = pd.DataFrame({\n    'k': k_values,\n    \"Moran's I\": morans_I,\n    'P-value': p_values\n})\n\npbsa_k_test","key":"QIoXGEUxrU"},{"type":"outputs","id":"TwpPxro40bh7feUGTuoSw","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"k\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"Moran's I\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"P-value\",\"rawType\":\"float64\",\"type\":\"float\"}],\"ref\":\"470ce562-32c3-4324-ad82-602bbd35478d\",\"rows\":[[\"0\",\"2\",\"0.13192025079700193\",\"0.076\"],[\"1\",\"3\",\"0.11055261498845644\",\"0.057\"],[\"2\",\"4\",\"0.05468681131182318\",\"0.163\"],[\"3\",\"5\",\"0.10729129725231182\",\"0.03\"],[\"4\",\"6\",\"0.11772434358089487\",\"0.017\"],[\"5\",\"7\",\"0.10045651903908621\",\"0.018\"],[\"6\",\"8\",\"0.08833017239249731\",\"0.039\"],[\"7\",\"9\",\"0.09500796348134125\",\"0.016\"],[\"8\",\"10\",\"0.09788880534514695\",\"0.012\"],[\"9\",\"11\",\"0.09963098589466306\",\"0.013\"],[\"10\",\"12\",\"0.10690472271013525\",\"0.008\"],[\"11\",\"13\",\"0.12225448583847862\",\"0.005\"],[\"12\",\"14\",\"0.13046628788184136\",\"0.002\"],[\"13\",\"15\",\"0.13584615688821156\",\"0.003\"],[\"14\",\"16\",\"0.13367490070293767\",\"0.001\"],[\"15\",\"17\",\"0.13620868590640373\",\"0.001\"],[\"16\",\"18\",\"0.1208164611999398\",\"0.002\"],[\"17\",\"19\",\"0.124203992986644\",\"0.001\"],[\"18\",\"20\",\"0.12106229189406922\",\"0.002\"]],\"shape\":{\"columns\":3,\"rows\":19}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003ek\u003c/th\u003e\n      \u003cth\u003eMoran's I\u003c/th\u003e\n      \u003cth\u003eP-value\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n      \u003ctd\u003e0.131920\u003c/td\u003e\n      \u003ctd\u003e0.076\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e3\u003c/td\u003e\n      \u003ctd\u003e0.110553\u003c/td\u003e\n      \u003ctd\u003e0.057\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e4\u003c/td\u003e\n      \u003ctd\u003e0.054687\u003c/td\u003e\n      \u003ctd\u003e0.163\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e5\u003c/td\u003e\n      \u003ctd\u003e0.107291\u003c/td\u003e\n      \u003ctd\u003e0.030\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e6\u003c/td\u003e\n      \u003ctd\u003e0.117724\u003c/td\u003e\n      \u003ctd\u003e0.017\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e5\u003c/th\u003e\n      \u003ctd\u003e7\u003c/td\u003e\n      \u003ctd\u003e0.100457\u003c/td\u003e\n      \u003ctd\u003e0.018\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e6\u003c/th\u003e\n      \u003ctd\u003e8\u003c/td\u003e\n      \u003ctd\u003e0.088330\u003c/td\u003e\n      \u003ctd\u003e0.039\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e7\u003c/th\u003e\n      \u003ctd\u003e9\u003c/td\u003e\n      \u003ctd\u003e0.095008\u003c/td\u003e\n      \u003ctd\u003e0.016\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e8\u003c/th\u003e\n      \u003ctd\u003e10\u003c/td\u003e\n      \u003ctd\u003e0.097889\u003c/td\u003e\n      \u003ctd\u003e0.012\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e9\u003c/th\u003e\n      \u003ctd\u003e11\u003c/td\u003e\n      \u003ctd\u003e0.099631\u003c/td\u003e\n      \u003ctd\u003e0.013\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e10\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003e0.106905\u003c/td\u003e\n      \u003ctd\u003e0.008\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e11\u003c/th\u003e\n      \u003ctd\u003e13\u003c/td\u003e\n      \u003ctd\u003e0.122254\u003c/td\u003e\n      \u003ctd\u003e0.005\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12\u003c/th\u003e\n      \u003ctd\u003e14\u003c/td\u003e\n      \u003ctd\u003e0.130466\u003c/td\u003e\n      \u003ctd\u003e0.002\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e13\u003c/th\u003e\n      \u003ctd\u003e15\u003c/td\u003e\n      \u003ctd\u003e0.135846\u003c/td\u003e\n      \u003ctd\u003e0.003\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e14\u003c/th\u003e\n      \u003ctd\u003e16\u003c/td\u003e\n      \u003ctd\u003e0.133675\u003c/td\u003e\n      \u003ctd\u003e0.001\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e15\u003c/th\u003e\n      \u003ctd\u003e17\u003c/td\u003e\n      \u003ctd\u003e0.136209\u003c/td\u003e\n      \u003ctd\u003e0.001\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e16\u003c/th\u003e\n      \u003ctd\u003e18\u003c/td\u003e\n      \u003ctd\u003e0.120816\u003c/td\u003e\n      \u003ctd\u003e0.002\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e17\u003c/th\u003e\n      \u003ctd\u003e19\u003c/td\u003e\n      \u003ctd\u003e0.124204\u003c/td\u003e\n      \u003ctd\u003e0.001\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e18\u003c/th\u003e\n      \u003ctd\u003e20\u003c/td\u003e\n      \u003ctd\u003e0.121062\u003c/td\u003e\n      \u003ctd\u003e0.002\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"     k  Moran's I  P-value\n0    2   0.131920    0.076\n1    3   0.110553    0.057\n2    4   0.054687    0.163\n3    5   0.107291    0.030\n4    6   0.117724    0.017\n5    7   0.100457    0.018\n6    8   0.088330    0.039\n7    9   0.095008    0.016\n8   10   0.097889    0.012\n9   11   0.099631    0.013\n10  12   0.106905    0.008\n11  13   0.122254    0.005\n12  14   0.130466    0.002\n13  15   0.135846    0.003\n14  16   0.133675    0.001\n15  17   0.136209    0.001\n16  18   0.120816    0.002\n17  19   0.124204    0.001\n18  20   0.121062    0.002","content_type":"text/plain"}}},"children":[],"key":"HnbN7JYBH1"}],"key":"OGYDPqkNYw"}],"key":"vj6H7Tx8Jz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Table XX. Student Accommodation Capacity Moran’s I index and P-value for Different Number of Neighbors (k)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pEDIR4XadQ"}],"key":"opVyuAWkHn"}],"key":"CA0VFwapJN"}],"key":"q4eE4MwD9n"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The task of finding the desired value of the number of nearest neighbors (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ISg6aZu4vc"},{"type":"inlineCode","value":"k","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N7GroNIMVk"},{"type":"text","value":") can be solved by plotting a graph of the dependence of Moran’s I index and P-value on k (Figure XX). On this graph, it is necessary to find the maximum values of the Moran’s I index modulus and then compare the P-value.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cZorF3sMuy"}],"key":"X0OBz4VjZp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The maximum values of Moran’s I index are achieved at k from 15 to 17. Since there are only 88 student dormitories, the minimum value of 15 neighbors (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yt5UuGAAFE"},{"type":"inlineCode","value":"k = 15","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YybBlaF2it"},{"type":"text","value":") was chosen. That is, each student dormitory is compared with its 15 closest neighbors in order to identify spatial dependence.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"L0jkSr2r2G"}],"key":"gfRpgDD1G5"}],"key":"vf3cTsbeG5"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(6, 6))\nplt.plot(pbsa_k_test['k'], pbsa_k_test[\"Moran's I\"], label=\"Moran's I\", color='#FFB78F')\nplt.plot(pbsa_k_test['k'], pbsa_k_test['P-value'], label='P-value', color='#76A79D')\n\nplt.axhline(0.05, color='#A9CCC1', linestyle='--', linewidth=1.5, label=\"P = 0.05 (Significance Threshold)\")\nplt.grid(True, color='#cccccc', linestyle='--', alpha=0.5)\n\nplt.xlabel('k (number of neighbors)')\nplt.title(\"Student Accommodation Capacity Moran's I and P-value\")\nplt.xticks(pbsa_k_test['k'])\nplt.legend(loc='best', frameon=False)\n\nsave_path = os.path.join(hf, \"Student Accommodation Capacity Moran's I and P-value.png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"BjRYGRM802"},{"type":"outputs","id":"DpibGVh1xbQg4eX5CmpZI","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ccde0aa3841b1fc76e0d7e45cc7bfe66","path":"/rethinking_student_housing/build/ccde0aa3841b1fc76e0d7e45cc7bfe66.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"c3PydIUFX6"}],"visibility":"show","key":"o6sx6QRV5H"}],"visibility":"show","key":"x4hOltLO9U"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Student Accommodation Capacity Moran’s I index and P-value for Different Number of Neighbours (k)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zFFfORXaQG"}],"key":"QeEjYnk2Pb"}],"key":"z3gY4gAfKw"}],"key":"Cb2x34eDY9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Significance Threshold Test","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pzqf6cMeAx"}],"identifier":"significance-threshold-test","label":"Significance Threshold Test","html_id":"significance-threshold-test","implicit":true,"key":"iUHDqUcntI"}],"key":"Ek7mGrsvFr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In the original Moran’s I Scatterplots for Different Number of Neighbors (Figure XX), the points are distributed across four quadrants: HH, HL, LH, LL. However, points near zero may accidentally fall into false categories, even though they do not demonstrate real spatial dependence. This can lead to distorted results and the identification of false points of spatial autocorrelation.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mjrlwAHawU"}],"key":"wBD031dXys"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The Significance Threshold Test sets a significance threshold (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fzFosHl962"},{"type":"inlineCode","value":"theshold","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aTrly7erAa"},{"type":"text","value":") for standardized capacity (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kmEhD7nkWm"},{"type":"inlineCode","value":"!cap_std","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r7lsDHMCOJ"},{"type":"text","value":") and spatial lag standardized capacity (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ll5dqShUq2"},{"type":"inlineCode","value":"!cap_slag_std","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jKrSlBZ9X3"},{"type":"text","value":"), and filters out not significant points where both variables take neutral values.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PimhXK9hZB"}],"key":"kO5oe27NZf"}],"key":"iovwXLKvPR"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Option 1: Based on percentiles (recommended for your data)\nthreshold_percentile = np.percentile(np.abs(pbsa_c['!cap_std']), 75)  # 75th percentile of absolute values\nprint(f\"Option 1 - Percentile-based threshold: {threshold_percentile:.3f}\")\nprint(f\"  (75th percentile of absolute values)\")\n\n# Option 2: Based on standard deviation\nstd_dev = pbsa_c['!cap_std'].std()\nthreshold_std = 0.5 * std_dev  # 0.5 standard deviations\nprint(f\"Option 2 - Standard deviation-based threshold: {threshold_std:.3f}\")\nprint(f\"  (0.5 * standard deviation)\")\n\n# Option 3: Fixed threshold based on your data range\nthreshold_fixed = 50.0  # Fixed value appropriate for your range\nprint(f\"Option 3 - Fixed threshold: {threshold_fixed:.3f}\")\nprint(f\"  (Fixed value for data range)\")\n\n# Option 4: Median-based threshold\nmedian_abs = np.median(np.abs(pbsa_c['!cap_std']))\nthreshold_median = median_abs * 0.5\nprint(f\"Option 4 - Median-based threshold: {threshold_median:.3f}\")\nprint(f\"  (0.5 * median of absolute values)\")\n\nthresholds_to_test = [threshold_percentile, threshold_std, threshold_fixed, threshold_median]\n\nfor i, test_threshold in enumerate(thresholds_to_test, 1):\n    print(f\"\\nTest {i}: threshold = {test_threshold:.3f}\")\n    \n    # Count points in each category\n    ns_count = 0\n    hh_count = 0\n    lh_count = 0\n    ll_count = 0\n    hl_count = 0\n    \n    for x, y in zip(pbsa_c['!cap_std'], pbsa_c[slag_col]):\n        if abs(x) \u003c= test_threshold and abs(y) \u003c= test_threshold:\n            ns_count += 1\n        elif x \u003e 0 and y \u003e 0:\n            hh_count += 1\n        elif x \u003e 0 and y \u003c 0:\n            lh_count += 1\n        elif x \u003c 0 and y \u003c 0:\n            ll_count += 1\n        elif x \u003c 0 and y \u003e 0:\n            hl_count += 1\n    \n    total = len(pbsa_c)\n    print(f\"  NS: {ns_count} ({ns_count/total*100:.1f}%)\")\n    print(f\"  HH: {hh_count} ({hh_count/total*100:.1f}%)\")\n    print(f\"  LH: {lh_count} ({lh_count/total*100:.1f}%)\")\n    print(f\"  LL: {ll_count} ({ll_count/total*100:.1f}%)\")\n    print(f\"  HL: {hl_count} ({hl_count/total*100:.1f}%)\")","visibility":"remove","key":"jBQ5Sz3u62"},{"type":"outputs","id":"-to6mtiTCrfnjzMDiErvg","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Option 1 - Percentile-based threshold: 234.375\n  (75th percentile of absolute values)\nOption 2 - Standard deviation-based threshold: 124.090\n  (0.5 * standard deviation)\nOption 3 - Fixed threshold: 50.000\n  (Fixed value for data range)\nOption 4 - Median-based threshold: 78.750\n  (0.5 * median of absolute values)\n\nTest 1: threshold = 234.375\n  NS: 66 (75.0%)\n  HH: 8 (9.1%)\n  LH: 6 (6.8%)\n  LL: 6 (6.8%)\n  HL: 2 (2.3%)\n\nTest 2: threshold = 124.090\n  NS: 25 (28.4%)\n  HH: 15 (17.0%)\n  LH: 10 (11.4%)\n  LL: 26 (29.5%)\n  HL: 12 (13.6%)\n\nTest 3: threshold = 50.000\n  NS: 6 (6.8%)\n  HH: 16 (18.2%)\n  LH: 12 (13.6%)\n  LL: 35 (39.8%)\n  HL: 19 (21.6%)\n\nTest 4: threshold = 78.750\n  NS: 11 (12.5%)\n  HH: 16 (18.2%)\n  LH: 12 (13.6%)\n  LL: 35 (39.8%)\n  HL: 14 (15.9%)\n"},"children":[],"key":"djUFyLsddz"}],"visibility":"show","key":"muqhFz3zQy"}],"visibility":"show","key":"kxNbnSRB1m"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In order to correctly interpret the Significance Threshold Test, it is necessary to pay attention to the distribution of points across four squares - spatial clusters.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mJSqf8cnhK"}],"key":"p3uNjLppV1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Option 1 - Percentile-based threshold: 234.375","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eZpQhqrrCA"}],"key":"JFkwuHem6M"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Dij9abKSCw"},{"type":"text","value":"With a high threshold value, 75% of the points became neutral, and the global autocorrelation analysis lost its meaning.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lbx4rgZZzt"}],"key":"D6us9gxG1U"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Option 2 - Standard deviation-based threshold: 124.090","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"DghSvG28bn"}],"key":"cn2WDlRLSZ"},{"type":"break","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"e68ItRxdlI"},{"type":"text","value":"It will eliminate the outliers that were described in the Descriptive Market Statistics chapter, as it is calculated according to the standard deviation.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Z7X8ubXg7M"}],"key":"I9LbG2itiH"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Option 3 - Fixed threshold: 50.000","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IvQTzqvm5W"}],"key":"VbguxzM6is"},{"type":"break","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"UwI9GX2qCn"},{"type":"text","value":"A threshold value that is too low results in the percentage of neutral points being too low at 6.8%.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lg7MXCeKFz"}],"key":"kFqUqYeOfC"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Option 4 - Median-based threshold: 78.750","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"IZCvs8z0WF"}],"key":"ds7IQSqNlh"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"WVOzI5KiHW"},{"type":"text","value":"Median-based threshold does not react to abnormally large values.\nTherefore, this threshold creates a threshold that reflects the real “central” distribution structure (","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KaPDDToaGH"},{"type":"inlineCode","value":"threshold = threshold_median","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"GcYTqccmsF"},{"type":"text","value":").","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"FqByYkY3ff"}],"key":"kDNPtxtn72"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Using three tests: Moran’s I Scatterplots Test, K-Nearest Neighbour Test, and Significance Threshold Test, it can be confirmed that the results of local spatial autocorrelation are stable.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"fpHfx1MG34"}],"key":"GpWOsYurxr"}],"key":"kMNLlIwfPP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spatial Weights \u0026 Moran’s I \u0026 P-value","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cxA3ZmX2xY"}],"identifier":"spatial-weights-morans-i-p-value","label":"Spatial Weights \u0026 Moran’s I \u0026 P-value","html_id":"spatial-weights-morans-i-p-value","implicit":true,"key":"c1qw5J9Sef"}],"key":"PK758nwVaQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"After performing all necessary tests, it is possible to proceed to the direct calculation of Spatial Weights, Moran’s I, and P-value for the selected value of numbers of nearest neighbors (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rr5WxhOR7p"},{"type":"inlineCode","value":"k=15","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dC0ygsrXpl"},{"type":"text","value":"). To do this, the method of spatial weights standardization must be defined. Row-standardization (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x50bkyXalb"},{"type":"inlineCode","value":"w.transform = “R”","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Aw7ZAhfmSF"},{"type":"text","value":") makes Moran’s I and other spatial indices comparable between different areas, even if the number of neighbors for objects is different. For each row of the weight matrix (each object), the sum of all neighbor weights is normalized to 1.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Icit5zO5Pb"}],"key":"MjuGR0dBg3"},{"type":"math","value":"w_{ij}^{(R)} = \\frac{w_{ij}}{\\sum_{j} w_{ij}}","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsubsup\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eR\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/msubsup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmfrac\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmrow\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/munder\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ew_{ij}^{(R)} = \\frac{w_{ij}}{\\sum_{j} w_{ij}}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.4578em;vertical-align:-0.413em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0448em;\"\u003e\u003cspan style=\"top:-2.4231em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2198em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mopen mtight\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\"\u003eR\u003c/span\u003e\u003cspan class=\"mclose mtight\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.413em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.2294em;vertical-align:-1.1218em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.1076em;\"\u003e\u003cspan style=\"top:-2.314em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mop\"\u003e\u003cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\"\u003e∑\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.162em;\"\u003e\u003cspan style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.4358em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.677em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.1218em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"2","key":"tlnKhaKzF4"}],"key":"hKuS4E0z63"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"w = KNN.from_dataframe(pbsa_c, k=15)\n\nw.transform = \"R\" \n\nvalues = pbsa_c['!cap']\n\nmoran = Moran(values, w)\nprint(f\"Moran's I: {moran.I:.3f}\")\nprint(f\"P-value: {moran.p_sim:.3f}\")","key":"dFIYMMR5n4"},{"type":"outputs","id":"AnYy04NHlmFuE3kZI5Ns-","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Moran's I: 0.136\nP-value: 0.001\n"},"children":[],"key":"sL3yVerXTY"}],"key":"IF2iKMlg17"}],"key":"kjqpWbAje5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Moran’s I (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XQG9Ezl6t8"},{"type":"inlineCode","value":"Moran's I: 0.136","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TfpOm3vtaA"},{"type":"text","value":") indicates positive spatial autocorrelation. In the context of urban planning, this indicates that student accommodations have a weak but stable tendency to form clusters.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K51CNKUw1X"}],"key":"iLEhW6tvIg"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"P-value (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HbQhy5mXGM"},{"type":"inlineCode","value":"P-value: 0.001","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dG4kKI7ieZ"},{"type":"text","value":") indicates that the probability of obtaining such a result by chance is 0.1%. In the context of urban planning, this shows that the observed spatial clusters actually exist and are not random.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zqN24kM9Bw"}],"key":"URp4fORzaT"}],"key":"pcxQ2Wbwo5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spatial Lag \u0026 Standardised Spatial Lag","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HiHFr0pjFF"}],"identifier":"spatial-lag-standardised-spatial-lag","label":"Spatial Lag \u0026 Standardised Spatial Lag","html_id":"spatial-lag-standardised-spatial-lag","implicit":true,"key":"IhZeocLbHK"}],"key":"Fcb4NuRHY7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"After calculating spatial weights, it is necessary to compute the spatial lag. The spatial lag operator is one of the most common and direct applications of spatial weights matrices (called ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QyjHT9BdNR"},{"type":"inlineMath","value":"\\textbf{W}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmtext mathvariant=\"bold\"\u003eW\u003c/mtext\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\textbf{W}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord textbf\"\u003eW\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"WtFbkraNvm"},{"type":"text","value":" formally) in spatial analysis. Conceptually, the spatial lag captures the behavior of a variable in the immediate surroundings of each location; in that respect, it is akin to a local smoother of a variable (Rey et al., 2023).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U85gZzCpc4"}],"key":"P9zI6d8EJA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We can formally express it in matrix notation as:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uZ4SJaU35V"}],"key":"KVT5uZ8JZV"},{"type":"math","value":"Y_{sl} = \\textbf{W} Y","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eY\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmi\u003el\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmtext mathvariant=\"bold\"\u003eW\u003c/mtext\u003e\u003cmi\u003eY\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eY_{sl} = \\textbf{W} Y\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eY\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003es\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord textbf\"\u003eW\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eY\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"3","key":"zI6QqE8QrA"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"or, in individual notation as:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"v7G0rwctTM"}],"key":"mLYLAjGWv5"},{"type":"math","value":"y_{sl-i} = \\sum_j w_{ij} y_j","position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmi\u003el\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/munder\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ey_{sl-i} = \\sum_j w_{ij} y_j\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003es\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e−\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.4638em;vertical-align:-1.4138em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop op-limits\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.05em;\"\u003e\u003cspan style=\"top:-1.8723em;margin-left:0em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan\u003e\u003cspan class=\"mop op-symbol large-op\"\u003e∑\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.4138em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"4","key":"dK146N1ejt"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"where:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"GYOAfV2rl8"}],"key":"FwkWenP5Q6"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"inlineMath","value":"w_{ij}","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ew_{ij}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"ahmaYnkNk7"},{"type":"text","value":" is the cell in ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"BQUlTmt7Is"},{"type":"inlineMath","value":"\\textbf{W}","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmtext mathvariant=\"bold\"\u003eW\u003c/mtext\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\textbf{W}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord textbf\"\u003eW\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"KNk09qzgG5"},{"type":"text","value":" on the ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"BvgZhLN14L"},{"type":"inlineMath","value":"i","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ei\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6595em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"rHBWXTKdRY"},{"type":"text","value":"-th row and ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Kl8tvEWdgA"},{"type":"inlineMath","value":"j","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ej\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"jkjZKgj0l0"},{"type":"text","value":"-th column, thus capturing the spatial relationship between observations ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"mHHBfGj8iR"},{"type":"inlineMath","value":"i","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ei\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6595em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"a5KBMQsie2"},{"type":"text","value":" and ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NCNFJHmHcs"},{"type":"inlineMath","value":"j","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ej\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"oSMxesDHl2"},{"type":"text","value":", in other words ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NdYNUQibEi"},{"type":"inlineMath","value":"y_{sl-i}","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmi\u003el\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ey_{sl-i}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003es\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e−\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"RuhV25AeKR"},{"type":"text","value":" is the weighted average values in a specified neighborhood.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"IrTD9o2yno"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"mutmM0MsWa"},{"type":"inlineMath","value":"y_{sl-i}","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmi\u003el\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ey_{sl-i}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003es\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e−\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"lqvQYptMcE"},{"type":"text","value":" thus captures the product of the values and weights of each observation other than ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ZlDLobS7pU"},{"type":"inlineMath","value":"i","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ei\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6595em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"ptx51pc5BG"},{"type":"text","value":" in the dataset.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"VDAMbao9g0"}],"key":"FgU6UFikNL"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Spatial lag is a key element of many spatial analysis techniques including spatial autocorrelation (Rey et al., 2023).","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"fhav67aPTs"}],"key":"vKJ3sQPsv2"}],"key":"EPYKkpeJQ7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pbsa_c[\"!cap_slag\"] = lag_spatial(w, pbsa_c[\"!cap\"])\npbsa_c[\"!cap_std\"] = pbsa_c[\"!cap\"] - pbsa_c[\"!cap\"].mean()\npbsa_c[\"!cap_slag_std\"] = lag_spatial(w, pbsa_c[\"!cap_std\"])","key":"jLBgPi4Xhy"},{"type":"outputs","id":"6Nn6DCa2ZVoZJ2dzRFvna","children":[],"key":"BkKwlIdS9I"}],"key":"dn5xIHuPGY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The maps (Figure XX) illustrate the various stages of data preparation for global autocorrelation — from actual capacity values (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GoiT6We8eL"},{"type":"inlineCode","value":"!cap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nzZnGYjXlI"},{"type":"text","value":") and their spatial relationships (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nPKkzR3l4J"},{"type":"inlineCode","value":"!cap_slag","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L6VyoCYFcD"},{"type":"text","value":") to their standardized values (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NoaJMa46Ma"},{"type":"inlineCode","value":"!cap_std","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u2V5gT4ZxV"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qYrbKQaAGl"},{"type":"inlineCode","value":"!cap_slag_std","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tidIw1IOII"},{"type":"text","value":").","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HzYaCZwfTn"}],"key":"LqaGtV0GXs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"a. Student Housing Capacity (!cap)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pbYuGLRxA0"}],"key":"F3E2Qoeu8q"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HzXtijKsHN"},{"type":"text","value":"The first map shows the absolute capacity of student housing. Despite the presence of large facilities in central areas, the overall structure remains fragmented, with significant heterogeneity between districts. This map reflects the actual market and serves as a starting point for analysis.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yW74Ot83ii"}],"key":"xpigYjA6ti"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"b. Student Housing Capacity Influence (!cap_slag)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tzkCn50iPz"}],"key":"PZQ9P82HEv"},{"type":"break","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UaYtyo25yL"},{"type":"text","value":"The second map displays the spatial lag of capacity — the average capacity in neighboring locations. It captures the influence of neighboring facilities, smoothing out local peaks and revealing latent clusters that are not visible in the absolute data. This shows not only where large dormitories are located, but also where their surroundings are saturated or deficient.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CYA0ehG3DE"}],"key":"kJaAP26cNA"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"c. Standardized Capacity (!cap_std)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"UZKx1Ajr3h"}],"key":"ia5YOAHAEg"},{"type":"break","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"H5EpBezDfB"},{"type":"text","value":"The third map shows standardised values (centered around the mean). Here you can see which areas have above- or below-average capacity for the city, rather than simply “large/small.” This is a key step for Moran’s I, as it allows you to identify deviations from the overall trend rather than absolute values.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IXf18Fe8rA"}],"key":"TxHx0vKjsm"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"d. Standardized Capacity Influence (!cap_slag_std)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"nCbdQetjPH"}],"key":"TJNldPqRGl"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"HNtWxIBqrV"},{"type":"text","value":"The fourth map displays standardized spatial lag—how much neighboring areas are above or below average. In combination with map (c), it shows where High–High (HH) and Low–Low (LL) clusters form and where anomalies (High–Low / Low–High) occur. These patterns form the basis for interpreting the Moran Scatterplot.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"swFwfndpFH"}],"key":"UGvfM3GYcu"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Together, maps (a–d) demonstrate that the distribution of student housing in Berlin is highly heterogeneous and structurally dependent on the spatial environment. The transition from absolute values (","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"qWpvDlyP12"},{"type":"inlineCode","value":"!cap","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"TWgOMY7aNn"},{"type":"text","value":") to standardized spatial lags (","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"MzU0UIg2SM"},{"type":"inlineCode","value":"!cap_slag_std","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"kizStcFeyA"},{"type":"text","value":") allows us to identify hidden clusters and areas of shortage — key information for rethinking student housing placement strategies and developing spatially sensitive solutions.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vaP1NZcaVR"}],"key":"dx8itXjnY3"}],"key":"lQXEwI0It1"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, axs  = plt.subplots(2, 2, figsize=(18, 12))\n\npgr.plot(ax=axs[0, 0], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[0, 0], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[0, 0], facecolor='none', edgecolor='#666666', linewidth=1)\npbsa_c.plot(ax=axs[0, 0],\n          column='!cap',\n          cmap=cmap_or,\n          markersize = np.sqrt(pbsa_c['!cap']) * 2,  # Scale marker size\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"capacity\"},\n          vmin=0,\n          vmax=pbsa_c['!cap'].quantile(0.95))  # Cap extremes\naxs[0, 0].set_title('a. Student Housing Capacity (!cap)', fontsize=14, pad=15, fontweight='bold')\naxs[0, 0].set_axis_off()\n\npgr.plot(ax=axs[0, 1], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[0, 1], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[0, 1], facecolor='none', edgecolor='#666666', linewidth=1)\npbsa_c.plot(ax=axs[0, 1],\n          column='!cap_slag',\n          cmap=cmap_or,\n          markersize=np.sqrt(pbsa_c['!cap_slag']) * 2,\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"capacity spatial lag\"},\n          vmin=0,\n          vmax=pbsa_c['!cap'].quantile(0.95))  # Matching Previous plott\naxs[0, 1].set_title('b. Student Housing Capacity Influence (!cap_slag)', fontsize=14, pad=15, fontweight='bold')\naxs[0, 1].set_axis_off()\n\n\nmax_abs_value = max(abs(pbsa_c['!cap_std'].min()), abs(pbsa_c['!cap_std'].max()))\nvmin, vmax = -max_abs_value, max_abs_value\npgr.plot(ax=axs[1, 0], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[1, 0], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[1, 0], facecolor='none', edgecolor='#666666', linewidth=1)\npbsa_c.plot(ax=axs[1, 0],\n          column='!cap_std',\n          cmap=cmap_mintor,\n          markersize = np.sqrt(np.abs(pbsa_c['!cap_std'])) * 2,  # Scale marker size\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"standardised capacity\"},\n          vmin=vmin,  # Symmetrical lower bound\n          vmax=vmax)      # Cap extremes\naxs[1, 0].set_title('c.Standardised Student Housing Capacity (!cap_std)', fontsize=14, pad=15, fontweight='bold')\naxs[1, 0].set_axis_off()\n\nmax_abs_value = max(abs(pbsa_c['!cap_slag_std'].min()), abs(pbsa_c['!cap_slag_std'].max()))\nvmin, vmax = -max_abs_value, max_abs_value\npgr.plot(ax=axs[1, 1], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[1, 1], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[1, 1], facecolor='none', edgecolor='#666666', linewidth=1)\npbsa_c.plot(ax=axs[1, 1],\n          column='!cap_slag_std',\n          cmap=cmap_mintor,\n          markersize=np.sqrt(np.abs(pbsa_c['!cap_slag_std'])) * 2,\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"standardised capacity spatial lag\"},\n          vmin=vmin,  # Symmetrical lower bound\n          vmax=vmax)\naxs[1, 1].legend(loc='lower center', ncol=2, frameon=False, prop={'size': 10})\naxs[1, 1].set_title('d. Standardised Student Housing Capacity Influence (!cap_slag_std)', fontsize=14, pad=15, fontweight='bold')\naxs[1, 1].set_axis_off()\n\nsave_path = os.path.join(hf, \"Standardised Student Housing Capacity.png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"F9HDgvOa0l"},{"type":"outputs","id":"IJUwdXfP9w9tE8-biuoh3","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9781eb9778e4ddf3ec7bc4f5ec806273","path":"/rethinking_student_housing/build/9781eb9778e4ddf3ec7bc4f5ec806273.png"},"text/plain":{"content":"\u003cFigure size 1800x1200 with 8 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"yUO0FpqCqM"}],"visibility":"show","key":"RVJ759Jxxq"}],"visibility":"show","key":"aUeLad0L0Y"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Stages of Preparing Student Accommodation Capacity Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hwdoJH1EqD"}],"key":"QZXt7t1CSP"}],"key":"XcAPE8FvtZ"}],"key":"HWX3yIApbT"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Moran’s graph shows the spatial relationship between the standardised capacity of student housing (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uBudaobu1Z"},{"type":"inlineCode","value":"!cap_std","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xhLyniFrJq"},{"type":"text","value":") and its spatial lag (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YWmKgGtSrQ"},{"type":"inlineCode","value":"!cap_slag_std","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kpMxqtZvDf"},{"type":"text","value":") — that is, the average capacity of neighbouring locations. Dividing the graph into four quadrants allows us to identify types of spatial patterns:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tM0CKuDRGd"}],"key":"uvQClRgrj5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Q1 – High–High (HH)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iVCNCqhk0z"}],"key":"zy83ouMZIw"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IF9M2FBqna"},{"type":"text","value":"These are high-capacity clusters where several large student residences are concentrated close to each other. For example, Studentenwohnheim Alfred-Jung-Straße, with a capacity of 800, is located less than 200 metres from another large student accommodation facility, WH Storkower Straße, with a capacity of 508 students, forming a stable centre for foreign students. At the same time, 12 of the 17 student facilities in the HH quadrant are state-owned. This leads to the conclusion that these centres of attraction are formed by state-owned facilities.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HejQktnVwj"}],"key":"m4ADTaNga5"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Q2 – Low–High (LH)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"TxVmfAHcHM"}],"key":"X8viGK9pb4"},{"type":"text","value":"\nThese are local pockets near developed clusters where a particular facility has low capacity compared to its saturated surroundings. For example, four facilities located in Wed: Norderoog, Studentenwohnheim Paul-Hertz-Haus, Süderoog, WH Augustenburger Platz with a total capacity of 471 students. Such areas are particularly important for analysis, as they may represent missed opportunities for growth.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"PyonBdMxgL"}],"key":"ZpCqaZ7GT8"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Q3 – Low–Low (LL)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"drJyq1SdfC"}],"key":"dWN0Hd3jaB"},{"type":"break","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"G4aUDaYajg"},{"type":"text","value":"These are supply shortage clusters where both the property and its surroundings have low capacity. For example, student accommodation in the direct vicinity of the Technical University of Berlin (Insider Apartments Leibniz Straße, WH Fraunhoferstraße, WH Hardenbergstraße). Such areas indicate structurally underserved areas – potential territories for development.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"LW7DqeFoGy"}],"key":"DeVZsc2WyH"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Q4 – High–Low (HL)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"xfKpH1984p"}],"key":"KdFhSBt7Bn"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"RdaYSgCVmS"},{"type":"text","value":"These are spatial anomalies where one large property appears in an environment where neighbouring areas have low supply. For example, Student Village Berlin Adlershof, is an early indicator of the development of new student areas.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"AbUDHJ4A38"}],"key":"oelZ8atBgR"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"The graph shows that the distribution of student housing capacity in Berlin includes both stable high-density clusters (HH) and structural gaps (LL), as well as a number of spatial anomalies (HL, LH), indicating uneven market development. These patterns describe indicators of the student housing crisis.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"TFBhfbA4lL"}],"key":"jFWUD9WFRt"}],"key":"mkUuC21Cgf"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define thresholds for \"Not Significant\"\nthreshold = threshold_median\n\n# Prepare lists\ncolors = []\nclusters = []\n\n# Loop through each row\nfor x, y in zip(pbsa_c['!cap_std'], pbsa_c['!cap_slag_std']):\n    if abs(x) \u003c= threshold and abs(y) \u003c= threshold:\n        colors.append('#FBF0EA')         # Cream for Not Significant\n        clusters.append('NS')            # Not Significant\n    elif x \u003e 0 and y \u003e 0:\n        colors.append('#F28B6D')         # Coral\n        clusters.append('HH')            # High-High\n    elif x \u003e 0 and y \u003c 0:\n        colors.append('#C8E0D4')         # Light teal\n        clusters.append('LH')            # Low-High\n    elif x \u003c 0 and y \u003c 0:\n        colors.append('#5F968E')         # Dark teal\n        clusters.append('LL')            # Low-Low\n    elif x \u003c 0 and y \u003e 0:\n        colors.append('#FEC89A')         # Peach\n        clusters.append('HL')            # High-Low\n\n# Assign to GeoDataFrame\npbsa_c['color'] = colors\npbsa_c['cluster_cap'] = clusters","visibility":"show","key":"AYfH8OY2h4"},{"type":"outputs","id":"oWqiDZlhsqsyqGHz7d8LG","children":[],"visibility":"show","key":"TI8w23z4Wi"}],"visibility":"remove","key":"Ky53HVjyal"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"f, ax = plt.subplots(1, figsize=(6, 6))\n\n# Scatter plot with manual colors\nscatter = ax.scatter(\n    x=pbsa_c['!cap_std'],\n    y=pbsa_c['!cap_slag_std'],\n    c=colors,  # Use our manually assigned colors\n    s=40,\n    edgecolor='white',\n    linewidth=0.3\n)\n\nsns.regplot(\n    x='!cap_std',\n    y='!cap_slag_std',\n    ci=None,\n    data=pbsa_c,\n    scatter=False,  # Disable default points\n    line_kws={\"color\":'#cccccc', \"linewidth\": 2},\n    ax=ax\n)\n\n# Axes lines\nax.axvline(0, color='#cccccc', alpha=0.75, linestyle=\"--\")\nax.axhline(0, color='#cccccc', alpha=0.75, linestyle=\"--\")\n\n# Title and labels\nax.set_title(\"Moran Scatterplot: Standardised Student Accommodation Capacity\", fontsize=12, weight='bold')\nax.set_xlabel(\"standardised capacity (!cap_std)\", fontsize=10)\nax.set_ylabel(\"spatial lag of standardised capacity (!cap_slag_std)\", fontsize=10)\n\n# Quadrant labels\nax.text(400, 125, \"High–High (HH)\", fontsize=9, color=\"gray\")\nax.text(400, -75, \"Low–High (LH)\", fontsize=9, color=\"gray\")\nax.text(-200, -75, \"Low–Low (LL)\", fontsize=9, color=\"gray\")\nax.text(-200, 125, \"High–Low (HL)\", fontsize=9, color=\"gray\")\n\n# Style\nax.set_xlim(pbsa_c['!cap_std'].min() - 0.5, pbsa_c['!cap_std'].max() + 0.5)\nax.set_ylim(pbsa_c['!cap_slag_std'].min() - 0.5, pbsa_c['!cap_slag_std'].max() + 0.5)\n\nsave_path = os.path.join(hf, \"Moran Scatterplot: Standardised Student Accommodation Capacity\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"XApmCoO2Js"},{"type":"outputs","id":"40fqy3VdMoJLCV4X70oyn","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0cccb3a0daacad0289cb53986ee5754e","path":"/rethinking_student_housing/build/0cccb3a0daacad0289cb53986ee5754e.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"XicUu7kGEJ"}],"visibility":"show","key":"N7IUS3qFV3"}],"visibility":"show","key":"PMJx9TKg4f"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Student Accommodation Capacity Moran Scatterplot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yfUHb2Bb5X"}],"key":"bKFgxWs0Li"}],"key":"nmBqphbWNA"}],"key":"gowgdKNTOI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The map (Figure XX) visualises the results of global spatial autocorrelation, which allows spatial clusters of student housing capacity to be identified.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CPh4D8fTAf"}],"key":"pQwiYeWKEV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In addition to identifying point clusters, the map clearly demonstrates the structural difference between East and West Berlin, which persists decades after the city’s reunification. The map reveals clear spatial segregation.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TyN94d5MYy"}],"key":"AEyfOQkyJk"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"East Berlin shows a high concentration of large student complexes and compact clusters. In the districts of Lichtenberg, Marzahn-Hellersdorf, and parts of the central districts, large halls of residence (HH) are spatially clustered, indicating strategically strong market areas. Individual high-capacity facilities (HL) are located in areas with low supply (e.g., in the south-east of the city). This is partly due to the historical legacy of the former East Berlin, where student residences were actively developed as part of the social infrastructure.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fhiQP9wJ8O"}],"key":"ikqaduxJO6"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Western Berlin, on the other hand, is characterised by a predominance of stable areas with low capacity and a shortage of supply. Areas of systemic shortage are concentrated mainly in Charlottenburg-Wilmersdorf, Tempelhof-Schöneberg, Neukölln, and Steglitz-Zehlendorf. Properties with low capacity are surrounded by large student complexes, most often in areas where local conditions or urban planning restrictions hinder expansion, such as in Mitte. This reflects a market that is more oriented towards the private rental sector, where student accommodation has developed more slowly.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"foh6MlzuwU"}],"key":"ybPPAPUVRh"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The spatial distribution of student housing in Berlin remains uneven and historically conditioned: the east has concentrated large, state-owned housing clusters, while the west faces a systemic supply shortage. This asymmetry increases pressure on rental markets in western districts and serves as a key signal of the ongoing student housing crisis.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"MpppoqXqrI"}],"key":"INQb5zz3Xt"}],"key":"bnofYtXBvK"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(figsize=(12, 12))\n\n# Plot the base map (replace 'lor' with your local authority boundaries if needed)\n\npgr.plot(ax=ax, facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nmauer.plot(ax=ax, facecolor='none', edgecolor='#666666', linewidth=1.25, linestyle=\"--\")\nbz.plot(ax=ax, facecolor='none', edgecolor='#999999', linewidth=0.75)\nfor idx, row in bz.iterrows():\n    centroid = row['geometry'].centroid\n    txt = ax.text(\n        centroid.x, centroid.y,\n        str(row['namgem']),\n        fontsize=8, color='#666666', ha='center', va='center'\n    )\n    txt.set_path_effects([\n        path_effects.Stroke(linewidth=2, foreground='white'),\n        path_effects.Normal()\n    ])\nout.plot(ax=ax, facecolor='none', edgecolor='#666666', linewidth=1.25)\n\n# Plot the student housing with colors based on cluster classification\npbsa_c.plot(ax=ax,\n            color=pbsa_c['color'],\n            markersize=np.sqrt(np.abs(pbsa_c['!cap_std'])) * 3 + 5,  # Adjust size based on standardized capacity\n            alpha=0.9,\n            edgecolor='white',\n            linewidth=0.3)\n\nlegend_elements = [\n    mpatches.Patch(color='#F28B6D', label='High-High (HH)', edgecolor='none'),\n    mpatches.Patch(color='#FEC89A', label='High-Low (HL)', edgecolor='none'),\n    mpatches.Patch(color='#C8E0D4', label='Low-High (LH)', edgecolor='none'),\n    mpatches.Patch(color='#5F968E', label='Low-Low (LL)', edgecolor='none'), \n    mpatches.Patch(color='#FBF0EA', label='Not Significant (NS)', edgecolor='#FAE1DD'), \n]\n\n# Add the legend to the plot\nax.legend(handles=legend_elements, loc='lower center', ncol=5, frameon=False, prop={'size': 10})\n\n# Add titles and customize the layout\nax.set_title('Student Housing Capacity Clusters in Berlin', fontsize=16, weight='bold')\nax.set_axis_off()\n\nsave_path = os.path.join(hf, \"Student Housing Capacity Clusters in Berlin.png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"gpALcE7Xmu"},{"type":"outputs","id":"qCJAscgYzN4SuMDKqDr1-","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b902e13ac9d4d3f03ae5c8444c16984e","path":"/rethinking_student_housing/build/b902e13ac9d4d3f03ae5c8444c16984e.png"},"text/plain":{"content":"\u003cFigure size 1200x1200 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"RntJGt8ygC"}],"visibility":"show","key":"VvlbFIh7cj"}],"visibility":"show","key":"WWZmsloavt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Student Accommodation Capacity Clusters in Berlin","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AYUzCAisxd"}],"key":"yrJ8tJP6l3"}],"key":"QdmGfmHsmG"}],"key":"dcsdbmcc1D"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Export","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"re1O8uNVaz"}],"identifier":"data-export","label":"Data Export","html_id":"data-export","implicit":true,"key":"cuN3lvMlUK"}],"key":"jt8SNLIvi9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The student accommodation data obtained from global spatial autocorrelation was stored for further market analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GNYRBv3Edf"}],"key":"Yc8DBPlS9G"}],"key":"G1aw2LAoAi"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# List of columns to drop\ncols_to_drop = [f'!cap_slag_std_k{i}' for i in range(1, 21)]\n\n# Drop them from the GeoDataFrame\npbsa_c = pbsa_c.drop(columns=cols_to_drop)","visibility":"show","key":"w9PdC2t7nn"},{"type":"outputs","id":"YID8wEPvTnlRi9jiviDEe","children":[],"visibility":"show","key":"NiXJEP6Hou"}],"visibility":"remove","key":"OFhWmlrGbA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ef = r'../outputs/2.4_global_spatial_autocorrelation/pbsa_capacity_analysis.gpkg'\npbsa_c.to_file(ef, driver=\"GPKG\")","key":"F7WnZwGpVW"},{"type":"outputs","id":"YXVFgOblCgROHPrq0JLwx","children":[],"key":"pbdhWopOyt"}],"key":"P9V5lRjV43"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Higher Education Universities International Demand","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hQaaZHzfHT"}],"identifier":"higher-education-universities-international-demand","label":"Higher Education Universities International Demand","html_id":"higher-education-universities-international-demand","implicit":true,"key":"ktPOyY0pT1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Similarly, an analysis of the spatial distribution of higher education university student demand across the city was conducted.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fEPLe0njcC"}],"key":"Cuzw36Osbn"}],"key":"RLlsSs2evO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Import","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a669hg8LLW"}],"identifier":"data-import","label":"Data Import","html_id":"data-import-1","implicit":true,"key":"AWfBVgifT1"}],"key":"j7TlR5JfVG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"uf = r'../inputs/2.4_global_spatial_autocorrelation/uni_c.gpkg'\nuni_c = gpd.read_file(uf)","key":"Hn0dhbksdt"},{"type":"outputs","id":"rcSsbhIzb6kk4soEs0wCv","children":[],"key":"oTrSdREd2X"}],"key":"bOpotdalOm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Standartalisation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jOUkj3fPNs"}],"identifier":"standartalisation","label":"Standartalisation","html_id":"standartalisation-1","implicit":true,"key":"sjFv9Mqew9"}],"key":"yxt5Efr6p2"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Since the research focused on international students, global autocorrelation will focus on number of international students (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZPirgSoNff"},{"type":"inlineCode","value":"!s_aus","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M6l3MFXPJq"},{"type":"text","value":"), which measures the market demand.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wW91R206v9"}],"key":"nygFRdXJDr"}],"key":"qUL4aMITW1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"uni_c[\"!s_aus_std\"] = uni_c[\"!s_aus\"] - uni_c[\"!s_aus\"].mean()","key":"nCYoUWbrO5"},{"type":"outputs","id":"F_0Rk1abBhWujAolBi0sp","children":[],"key":"cZ8VmiyfHD"}],"key":"Mqm8DNmRRv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Moran’s I Scatterplots Test \u0026 K-Nearest Neighbor Test","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZC9YwkclRU"}],"identifier":"morans-i-scatterplots-test-k-nearest-neighbor-test","label":"Moran’s I Scatterplots Test \u0026 K-Nearest Neighbor Test","html_id":"morans-i-scatterplots-test-k-nearest-neighbor-test-1","implicit":true,"key":"NaPQlNq2DF"}],"key":"yLrP4fO8o4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Moran’s I Scatterplots (Figure XX) demonstrate how the spatial structure of international student demand changes as the number of nearest neighbours increases (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ugEMb0M104"},{"type":"inlineCode","value":"k_values = list(range(1, 21))","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yDboGuSJ8b"},{"type":"text","value":"). The main conclusion is that, unlike the student housing market, demand from universities does not form stable spatial clusters. Most points in all graphs are concentrated near zero on the standardised international demand axis (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iF8Baoaho6"},{"type":"inlineCode","value":"!s_aus_std","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cVmsZdva1L"},{"type":"text","value":"), indicating that neighbouring universities do not have a strong influence on demand values.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Wl3QdtY8kQ"}],"key":"avm1ff1K5A"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Q1 – High–High (HH)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DBljgZtHlU"}],"key":"jkkonZ9MR9"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wghFFrM2PD"},{"type":"text","value":"Unlike student dormitories, there are virtually no high-density clusters because large universities are located far from each other, and their demand values do not correlate with each other, i.e., universities attract foreign students regardless of their location.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dgvcQNs53V"}],"key":"Z9ImKacZZg"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Q2 – Low–High (LH)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"dfxDkW4sat"}],"key":"uvQC5xZSon"},{"type":"break","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vdOcMiV2xL"},{"type":"text","value":"These are local pockets near universities with a large number of foreign students, where a particular university has low demand compared to its saturated surroundings.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BXFDkRknof"}],"key":"EkKqQWbRpw"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Q3 – Low–Low (LL)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JHLzemboJG"}],"key":"qCq8YaeLkm"},{"type":"break","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"sxgtvDOOZ6"},{"type":"text","value":"For most values of the number of nearest neighbours (","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"OoXujQhc9w"},{"type":"inlineCode","value":"k","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vGBuujodrD"},{"type":"text","value":"), there is a high concentration of universities with a low number of foreign students surrounded by similar institutions. This indicates a generally uniform low density of international student demand across the city.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"K56AiaVOyg"}],"key":"BoDm26Fzsl"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Q4 – High–Low (HL)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"vf0NywIgTW"}],"key":"asKEaR6iH5"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ctoiG0iG7S"},{"type":"text","value":"Several universities with very high numbers of international students are isolated “peaks of demand”, not forming full-fledged spatial clusters.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"IRGNeh6HhW"}],"key":"etvTWGpv1l"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"In conclusion, Moran’s I scatterplots illustrate that the demand generated by international students is structurally dispersed and does not form clusters across the city.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"FAgtLeDyE3"}],"key":"xpsHmvIZfJ"}],"key":"Ef9z5wgVsS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"np.random.seed(55)\n\nk_values = list(range(1, 21))\nthreshold = 1.0  # Customize this if needed\n\n# Subplot grid\nn_cols = 5\nn_rows = (len(k_values) + n_cols - 1) // n_cols\nn_plots = len(k_values)\n\nfig, axes = plt.subplots(n_rows, n_cols, figsize=(20, 4 * n_rows))\naxes = axes.flatten()\n\n# Generate plots\nfor i, k in enumerate(k_values):\n    ax = axes[i]\n    \n    # Create spatial weights matrix\n    w_k = libpysal.weights.KNN.from_dataframe(uni_c, k=k)\n    w_k.transform = \"R\"\n    \n    # Compute spatial lag for this k\n    slag_col = f'!s_aus_slag_std_k{k}'\n    uni_c[slag_col] = lag_spatial(w_k, uni_c[\"!s_aus_std\"])\n\n    # Generate quadrant-based colors\n    colors = []\n    clusters = []\n    for x, y in zip(uni_c['!s_aus_std'], uni_c[slag_col]):\n        if abs(x) \u003c= threshold and abs(y) \u003c= threshold:\n            colors.append('#FBF0EA')         # Cream for Not Significant\n            clusters.append('NS')\n        elif x \u003e 0 and y \u003e 0:\n            colors.append('#F08080')         # Pink\n            clusters.append('HH')\n        elif x \u003e 0 and y \u003c 0:\n            colors.append('#C8E0D4')         # Light teal\n            clusters.append('LH')\n        elif x \u003c 0 and y \u003c 0:\n            colors.append('#5F968E')         # Dark teal\n            clusters.append('LL')\n        elif x \u003c 0 and y \u003e 0:\n            colors.append('#FCD5CE')         # Light Pink \n            clusters.append('HL')\n    \n    # Scatter plot\n    ax.scatter(\n        uni_c['!s_aus_std'], uni_c[slag_col],\n        c=colors, s=np.random.seed(55), edgecolor='white', linewidth=0.3, alpha=0.8\n    )\n\n    # Add regression line\n    sns.regplot(\n        x='!s_aus_std', y=slag_col, data=uni_c,\n        scatter=False, ci=None, line_kws={\"color\": '#999999', \"linewidth\": 1.2}, ax=ax\n    )\n\n    # Axes\n    ax.axvline(0, color='#aaaaaa', linestyle='--', linewidth=0.8)\n    ax.axhline(0, color='#aaaaaa', linestyle='--', linewidth=0.8)\n\n    # Moran calculation\n    moran_k = Moran(uni_c['!s_aus'], w_k)\n    moran_i = moran_k.I\n    p_val = moran_k.p_sim\n\n    # Title\n    ax.set_title(f'k={k}', fontsize=12)\n    #ax.set_title(f'k={k}\\nMoran\\'s I = {moran_i:.3f}, P-value = {p_val:.3f}', fontsize=9)\n    # Axis labels\n    if i % n_cols == 0:\n        ax.set_ylabel(\"spatial lag of standardised university int. demand (!s_aus_slag_std)\", fontsize=8)\n    if i \u003e= len(k_values) - n_cols:\n        ax.set_xlabel(\"standardised university international demand (!s_aus_std)\", fontsize=8)\n    if i % n_cols != 0:\n        ax.set_ylabel('')\n    if i \u003c n_plots - n_cols:\n        ax.set_xlabel('')\n\n    # Tight axes\n    ax.set_xlim(uni_c['!s_aus_std'].min() - 0.1, uni_c['!s_aus_std'].max() + 0.1)\n    ax.set_ylim(uni_c[slag_col].min() - 0.1, uni_c[slag_col].max() + 0.1)\n\n# Hide any extra subplots\nfor j in range(len(k_values), len(axes)):\n    axes[j].set_visible(False)\n\n# Layout\nfig.suptitle(\"Higher Education Universities International Students Demand Moran's I Scatterplots for Different Number of Neighbours (k)\", fontsize=16, y=0.98)\nplt.tight_layout()\nplt.subplots_adjust(top=0.93, hspace=0.5, wspace=0.5)\n\nsave_path = os.path.join(hf, \"Higher Education Universities International Students Demand Moran's I Scatterplots for Different Number of Neighbours (k).png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"XVQsupMezf"},{"type":"outputs","id":"JejLfdvCzjhT1d_Dy5MZn","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"76ac97c580c380abf688196964a3385b","path":"/rethinking_student_housing/build/76ac97c580c380abf688196964a3385b.png"},"text/plain":{"content":"\u003cFigure size 2000x1600 with 20 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"vBDr0T0vDC"}],"visibility":"show","key":"hMw6vrBmXN"}],"visibility":"show","key":"LacmiWUfpk"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Higher Education Universities International Students Demand Moran’s I Scatterplots for Different Number of Neighbours (k)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E00R7eWNtH"}],"key":"fTkmsaTXnT"}],"key":"RbQCxAXNHq"}],"key":"s6PWvpnl4C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"np.random.seed(55)\n\nk_values = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]\nmorans_I = []\np_values = []\n\nfor k in k_values:\n    w = libpysal.weights.KNN.from_dataframe(uni_c, k=k)\n    w.transform = \"R\"\n    moran = Moran(uni_c['!s_aus'], w)\n    morans_I.append(moran.I)\n    p_values.append(moran.p_sim)\n\n# Create DataFrame\nuni_k_test = pd.DataFrame({\n    'k': k_values,\n    \"Moran's I\": morans_I,\n    'P-value': p_values\n})\n\nuni_k_test","key":"lgnvlsfuyI"},{"type":"outputs","id":"h9JGIKxx3ZIyQ0WG2Auwt","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"k\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"Moran's I\",\"rawType\":\"float64\",\"type\":\"float\"},{\"name\":\"P-value\",\"rawType\":\"float64\",\"type\":\"float\"}],\"ref\":\"5da246f5-1d54-42c4-b5dc-907c74dc72a1\",\"rows\":[[\"0\",\"2\",\"-0.12662693483750795\",\"0.022\"],[\"1\",\"3\",\"-0.14082721274287052\",\"0.003\"],[\"2\",\"4\",\"-0.11909595849523595\",\"0.003\"],[\"3\",\"5\",\"-0.10195139471594733\",\"0.009\"],[\"4\",\"6\",\"-0.10223091320100855\",\"0.004\"],[\"5\",\"7\",\"-0.09655915356763259\",\"0.004\"],[\"6\",\"8\",\"-0.08431822832818471\",\"0.014\"],[\"7\",\"9\",\"-0.08246253993798484\",\"0.005\"],[\"8\",\"10\",\"-0.06572490947134065\",\"0.039\"],[\"9\",\"11\",\"-0.06010235064812827\",\"0.061\"],[\"10\",\"12\",\"-0.046248863148768464\",\"0.138\"],[\"11\",\"13\",\"-0.04482487279297591\",\"0.134\"],[\"12\",\"14\",\"-0.03847665308424382\",\"0.221\"],[\"13\",\"15\",\"-0.03463810564691144\",\"0.255\"],[\"14\",\"16\",\"-0.031578068851911736\",\"0.28\"],[\"15\",\"17\",\"-0.034662665155655484\",\"0.224\"],[\"16\",\"18\",\"-0.016068368852405847\",\"0.472\"],[\"17\",\"19\",\"-0.018201014348091446\",\"0.477\"],[\"18\",\"20\",\"-0.019881723187934273\",\"0.448\"]],\"shape\":{\"columns\":3,\"rows\":19}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003ek\u003c/th\u003e\n      \u003cth\u003eMoran's I\u003c/th\u003e\n      \u003cth\u003eP-value\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n      \u003ctd\u003e-0.126627\u003c/td\u003e\n      \u003ctd\u003e0.022\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e3\u003c/td\u003e\n      \u003ctd\u003e-0.140827\u003c/td\u003e\n      \u003ctd\u003e0.003\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e4\u003c/td\u003e\n      \u003ctd\u003e-0.119096\u003c/td\u003e\n      \u003ctd\u003e0.003\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e5\u003c/td\u003e\n      \u003ctd\u003e-0.101951\u003c/td\u003e\n      \u003ctd\u003e0.009\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e6\u003c/td\u003e\n      \u003ctd\u003e-0.102231\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e5\u003c/th\u003e\n      \u003ctd\u003e7\u003c/td\u003e\n      \u003ctd\u003e-0.096559\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e6\u003c/th\u003e\n      \u003ctd\u003e8\u003c/td\u003e\n      \u003ctd\u003e-0.084318\u003c/td\u003e\n      \u003ctd\u003e0.014\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e7\u003c/th\u003e\n      \u003ctd\u003e9\u003c/td\u003e\n      \u003ctd\u003e-0.082463\u003c/td\u003e\n      \u003ctd\u003e0.005\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e8\u003c/th\u003e\n      \u003ctd\u003e10\u003c/td\u003e\n      \u003ctd\u003e-0.065725\u003c/td\u003e\n      \u003ctd\u003e0.039\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e9\u003c/th\u003e\n      \u003ctd\u003e11\u003c/td\u003e\n      \u003ctd\u003e-0.060102\u003c/td\u003e\n      \u003ctd\u003e0.061\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e10\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003e-0.046249\u003c/td\u003e\n      \u003ctd\u003e0.138\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e11\u003c/th\u003e\n      \u003ctd\u003e13\u003c/td\u003e\n      \u003ctd\u003e-0.044825\u003c/td\u003e\n      \u003ctd\u003e0.134\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12\u003c/th\u003e\n      \u003ctd\u003e14\u003c/td\u003e\n      \u003ctd\u003e-0.038477\u003c/td\u003e\n      \u003ctd\u003e0.221\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e13\u003c/th\u003e\n      \u003ctd\u003e15\u003c/td\u003e\n      \u003ctd\u003e-0.034638\u003c/td\u003e\n      \u003ctd\u003e0.255\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e14\u003c/th\u003e\n      \u003ctd\u003e16\u003c/td\u003e\n      \u003ctd\u003e-0.031578\u003c/td\u003e\n      \u003ctd\u003e0.280\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e15\u003c/th\u003e\n      \u003ctd\u003e17\u003c/td\u003e\n      \u003ctd\u003e-0.034663\u003c/td\u003e\n      \u003ctd\u003e0.224\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e16\u003c/th\u003e\n      \u003ctd\u003e18\u003c/td\u003e\n      \u003ctd\u003e-0.016068\u003c/td\u003e\n      \u003ctd\u003e0.472\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e17\u003c/th\u003e\n      \u003ctd\u003e19\u003c/td\u003e\n      \u003ctd\u003e-0.018201\u003c/td\u003e\n      \u003ctd\u003e0.477\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e18\u003c/th\u003e\n      \u003ctd\u003e20\u003c/td\u003e\n      \u003ctd\u003e-0.019882\u003c/td\u003e\n      \u003ctd\u003e0.448\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"     k  Moran's I  P-value\n0    2  -0.126627    0.022\n1    3  -0.140827    0.003\n2    4  -0.119096    0.003\n3    5  -0.101951    0.009\n4    6  -0.102231    0.004\n5    7  -0.096559    0.004\n6    8  -0.084318    0.014\n7    9  -0.082463    0.005\n8   10  -0.065725    0.039\n9   11  -0.060102    0.061\n10  12  -0.046249    0.138\n11  13  -0.044825    0.134\n12  14  -0.038477    0.221\n13  15  -0.034638    0.255\n14  16  -0.031578    0.280\n15  17  -0.034663    0.224\n16  18  -0.016068    0.472\n17  19  -0.018201    0.477\n18  20  -0.019882    0.448","content_type":"text/plain"}}},"children":[],"key":"qNuhgTsBFg"}],"key":"bZuXXszgFH"}],"key":"MTLmrvagU0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Table XX. Higher Education Universities International Students Demand Moran’s I index and P-value for Different Number of Neighbors (k)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ujR8hZMLSS"}],"key":"GrzMoje0tw"}],"key":"xmBwba0u5K"}],"key":"EQrKngZFaR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Moran’s I distribution graph and P-value (Figure XX) show that the P-value takes acceptable values (P \u003c 0.05) when k is between 2 and 10. Since we are talking about global spatial autocorrelation, the purpose of which is to identify patterns throughout Berlin, it is necessary to choose the maximum value of k. At the same time, the P-value when choosing 10 nearest neighbours is critically close to the significance threshold. Therefore, the previous value ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GncsyIVfk5"},{"type":"inlineCode","value":"k=9","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"STaxuoSJn2"},{"type":"text","value":" was chosen.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sf6E9oC4Of"}],"key":"zAZwc2jlj5"}],"key":"vbztVq06XX"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(6, 6))\nplt.plot(uni_k_test['k'], uni_k_test[\"Moran's I\"], label=\"Moran's I\", color='#FEC5BB')\nplt.plot(uni_k_test['k'], uni_k_test['P-value'], label='P-value', color='#76A79D')\n\nplt.axhline(0.05, color='#A9CCC1', linestyle='--', linewidth=1.5, label=\"P = 0.05 (Significance Threshold)\")\nplt.grid(True, color='#cccccc', linestyle='--', alpha=0.3)\n\nplt.xlabel('k (number of neighbors)')\nplt.title(\"Moran's I and P-value\")\nplt.xticks(uni_k_test['k'])\nplt.legend(loc='best', frameon=False)\n\nsave_path = os.path.join(hf, \"International Students Demand Moran’s I index and P-value for Different Number of Neighbours (k).png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"show","key":"Q6oSbncJOM"},{"type":"outputs","id":"OSTFR_Dx5KFoknqJ8tqLH","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5ce32cc145b4b6d0e1da132006bb3cf6","path":"/rethinking_student_housing/build/5ce32cc145b4b6d0e1da132006bb3cf6.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"xKnjN8y3VB"}],"visibility":"show","key":"ctNnAY3X8U"}],"visibility":"remove","key":"LJbtIeq2XI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Higher Education Universities International Students Demand Moran’s I index and P-value for Different Number of Neighbours (k)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pqVynLnwOL"}],"key":"uKBtDYuQTw"}],"key":"rth77HMnD1"}],"key":"wrz1Ax6Uv0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Significance Threshold Test","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yErVwsscg2"}],"identifier":"significance-threshold-test","label":"Significance Threshold Test","html_id":"significance-threshold-test-1","implicit":true,"key":"ttIzLL5ky6"}],"key":"faHsm01xBA"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"By analogy with student accommodation capacity, the significance threshold was calculated as half of the median of the absolute value (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VZZsy7xOd4"},{"type":"inlineCode","value":"median_abs * 0.5","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jFNOPJ2Csa"},{"type":"text","value":").","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NtG8ZISvHd"}],"key":"bzEJmtYLLX"}],"key":"ye7taT1utX"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Option 1: Based on percentiles (recommended for your data)\nthreshold_percentile = np.percentile(np.abs(uni_c['!s_aus_std']), 75)  # 75th percentile of absolute values\nprint(f\"Option 1 - Percentile-based threshold: {threshold_percentile:.3f}\")\nprint(f\"  (75th percentile of absolute values)\")\n\n# Option 2: Based on standard deviation\nstd_dev = uni_c['!s_aus_std'].std()\nthreshold_std = 0.5 * std_dev  # 0.5 standard deviations\nprint(f\"Option 2 - Standard deviation-based threshold: {threshold_std:.3f}\")\nprint(f\"  (0.5 * standard deviation)\")\n\n# Option 3: Fixed threshold based on your data range\nthreshold_fixed = 550.0  # Fixed value appropriate for your range\nprint(f\"Option 3 - Fixed threshold: {threshold_fixed:.3f}\")\nprint(f\"  (Fixed value for your data range)\")\n\n# Option 4: Median-based threshold\nmedian_abs = np.median(np.abs(uni_c['!s_aus_std']))\nthreshold_median = median_abs * 0.5\nprint(f\"Option 4 - Median-based threshold: {threshold_median:.3f}\")\nprint(f\" (0.5 * median of absolute values)\")\n\nthresholds_to_test = [threshold_percentile, threshold_std, threshold_fixed, threshold_median]\n\nfor i, test_threshold in enumerate(thresholds_to_test, 1):\n    print(f\"\\nTest {i}: threshold = {test_threshold:.3f}\")\n    \n    # Count points in each category\n    ns_count = 0\n    hh_count = 0\n    lh_count = 0\n    ll_count = 0\n    hl_count = 0\n    \n    for x, y in zip(uni_c['!s_aus_std'], uni_c[slag_col]):\n        if abs(x) \u003c= test_threshold and abs(y) \u003c= test_threshold:\n            ns_count += 1\n        elif x \u003e 0 and y \u003e 0:\n            hh_count += 1\n        elif x \u003e 0 and y \u003c 0:\n            lh_count += 1\n        elif x \u003c 0 and y \u003c 0:\n            ll_count += 1\n        elif x \u003c 0 and y \u003e 0:\n            hl_count += 1\n    \n    total = len(uni_c)\n    print(f\"  NS: {ns_count} ({ns_count/total*100:.1f}%)\")\n    print(f\"  HH: {hh_count} ({hh_count/total*100:.1f}%)\")\n    print(f\"  LH: {lh_count} ({lh_count/total*100:.1f}%)\")\n    print(f\"  LL: {ll_count} ({ll_count/total*100:.1f}%)\")\n    print(f\"  HL: {hl_count} ({hl_count/total*100:.1f}%)\")","visibility":"remove","key":"i0bQ6bxhNx"},{"type":"outputs","id":"O4loPGXrP3xI7n9djDBcO","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Option 1 - Percentile-based threshold: 679.990\n  (75th percentile of absolute values)\nOption 2 - Standard deviation-based threshold: 828.251\n  (0.5 * standard deviation)\nOption 3 - Fixed threshold: 550.000\n  (Fixed value for your data range)\nOption 4 - Median-based threshold: 304.745\n (0.5 * median of absolute values)\n\nTest 1: threshold = 679.990\n  NS: 54 (76.1%)\n  HH: 2 (2.8%)\n  LH: 6 (8.5%)\n  LL: 5 (7.0%)\n  HL: 4 (5.6%)\n\nTest 2: threshold = 828.251\n  NS: 64 (90.1%)\n  HH: 2 (2.8%)\n  LH: 5 (7.0%)\n  LL: 0 (0.0%)\n  HL: 0 (0.0%)\n\nTest 3: threshold = 550.000\n  NS: 23 (32.4%)\n  HH: 4 (5.6%)\n  LH: 7 (9.9%)\n  LL: 23 (32.4%)\n  HL: 14 (19.7%)\n\nTest 4: threshold = 304.745\n  NS: 5 (7.0%)\n  HH: 5 (7.0%)\n  LH: 7 (9.9%)\n  LL: 34 (47.9%)\n  HL: 20 (28.2%)\n"},"children":[],"key":"DEXRrGPGdJ"}],"visibility":"show","key":"eZWaPskfpB"}],"visibility":"show","key":"AmCUfG38kq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spatial Weights \u0026 Moran’s I \u0026 Spatial Lag","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ghEBQzAC1Q"}],"identifier":"spatial-weights-morans-i-spatial-lag","label":"Spatial Weights \u0026 Moran’s I \u0026 Spatial Lag","html_id":"spatial-weights-morans-i-spatial-lag","implicit":true,"key":"QaOKieh3bg"}],"key":"dgA4zXt5nO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Generate spatial weights from the GeoDataFrame\nw = KNN.from_dataframe(uni_c, k=9) \nw.transform = \"R\"  # Row-standardize weights\n\nvalues = uni_c['!s_aus']\n\nmoran = Moran(values, w)\nprint(f\"Moran's I: {moran.I:.3f}\")\nprint(f\"P-value: {moran.p_sim:.3f}\")","key":"qz2LmnfSTb"},{"type":"outputs","id":"1d6Z9dPHfBTbTNiVY1c3h","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Moran's I: -0.082\nP-value: 0.009\n"},"children":[],"key":"SKByLyvKvF"}],"key":"DZwQxX96TV"}],"key":"vIdLIhpyhr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Moran’s I (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GZSjLlXPbL"},{"type":"inlineCode","value":"Moran's I: -0.082","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Gyuq817xpB"},{"type":"text","value":") indicates a weak negative spatial autocorrelation. In the context of urban planning, this indicates that higher education universities do not create spatial clusters; in other words, they are unevenly distributed throughout the city.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iz1xB61uaj"}],"key":"fj7EqSOFN2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"P-value (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LS7V84p8e9"},{"type":"inlineCode","value":"P-value: 0.007","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B5lOSKpaAC"},{"type":"text","value":") indicates that the probability of obtaining such a result by chance is 0.7%, i.e., the result obtained is statistically significant.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IxTOxzhisO"}],"key":"eVjrG8RFzu"}],"key":"OEx8WcYomB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spatial Lag \u0026 Standardised Spatial Lag","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C91ycoK2FZ"}],"identifier":"spatial-lag-standardised-spatial-lag","label":"Spatial Lag \u0026 Standardised Spatial Lag","html_id":"spatial-lag-standardised-spatial-lag-1","implicit":true,"key":"ojX55QD3B7"}],"key":"AxqjqvjTM2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Add spatial lag and standardized columns\nuni_c[\"!s_aus_slag\"] = lag_spatial(w, uni_c[\"!s_aus\"])\nuni_c[\"!s_aus_std\"] = uni_c[\"!s_aus\"] - uni_c[\"!s_aus\"].mean()\nuni_c[\"!s_aus_slag_std\"] = lag_spatial(w, uni_c[\"!s_aus_std\"])","key":"JJfebphfWm"},{"type":"outputs","id":"7LYUxsC7_fXd5cbVj9TMT","children":[],"key":"wsBOTbAhnf"}],"key":"IFgKGTMo20"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define thresholds for \"Not Significant\"\nthreshold = threshold_median\n\ncolors = []\nclusters = []\n\nfor x, y in zip(uni_c['!s_aus_std'], uni_c['!s_aus_slag_std']):\n    if abs(x) \u003c= threshold and abs(y) \u003c= threshold:\n        colors.append('#FBF0EA')         # Cream for Not Significant\n        clusters.append('NS')\n    elif x \u003e 0 and y \u003e 0:\n        colors.append('#F08080')         # Pink\n        clusters.append('HH')\n    elif x \u003e 0 and y \u003c 0:\n        colors.append('#C8E0D4')         # Light teal\n        clusters.append('LH')\n    elif x \u003c 0 and y \u003c 0:\n        colors.append('#5F968E')         # Dark teal\n        clusters.append('LL')\n    elif x \u003c 0 and y \u003e 0:\n        colors.append('#FCD5CE')         # Light Pink \n        clusters.append('HL')\n\nuni_c['color'] = colors\nuni_c['cluster_aus'] = clusters","visibility":"show","key":"RzClbIn4IJ"},{"type":"outputs","id":"se9FvXvF37McBcYf-mNU5","children":[],"visibility":"show","key":"tdjMWA4s7q"}],"visibility":"remove","key":"FEyInQViSf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The maps (Figure XX) visualise the different stages of preparing international demand data for spatial analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tfggwYPPnX"}],"key":"dv0fmEKcAT"}],"key":"dAzPM7XziV"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, axs  = plt.subplots(2, 2, figsize=(18, 12))\n\n# a. University Demand (!s_aus)\npgr.plot(ax=axs[0, 0], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[0, 0], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[0, 0], facecolor='none', edgecolor='#666666', linewidth=1)\nuni_c.plot(ax=axs[0, 0],\n          column='!s_aus',\n          cmap=cmap_pi,\n          markersize = np.sqrt(uni_c['!s_aus']),\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"university international demand\"},\n          vmin=0,\n          vmax=uni_c['!s_aus'].quantile(0.95))\naxs[0, 0].set_title('a. University International Demand (!s_aus)', fontsize=14, pad=15, fontweight='bold')\naxs[0, 0].set_axis_off()\n\n# b. University Demand Influence (!s_aus_slag)\npgr.plot(ax=axs[0, 1], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[0, 1], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[0, 1], facecolor='none', edgecolor='#666666', linewidth=1)\nuni_c.plot(ax=axs[0, 1],\n          column='!s_aus_slag',\n          cmap=cmap_pi,\n          markersize=np.sqrt(uni_c['!s_aus_slag']),\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"university international demand spatial lag\"},\n          vmin=0,\n          vmax=uni_c['!s_aus'].quantile(0.95))\naxs[0, 1].set_title('b. University International Demand Influence (!s_aus_slag)', fontsize=14, pad=15, fontweight='bold')\naxs[0, 1].set_axis_off()\n\n# c. Standardised University Demand (!s_all_std)\nmax_abs_value = max(abs(uni_c['!s_aus_std'].min()), abs(uni_c['!s_aus_std'].max()))\nvmin, vmax = -max_abs_value, max_abs_value\npgr.plot(ax=axs[1, 0], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[1, 0], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[1, 0], facecolor='none', edgecolor='#666666', linewidth=1)\nuni_c.plot(ax=axs[1, 0],\n          column='!s_aus_std',\n          cmap=cmap_mintpi,\n          markersize = np.sqrt(np.abs(uni_c['!s_aus_std'])),\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"standardised university international demand\"},\n          vmin=vmin,\n          vmax=vmax)\naxs[1, 0].set_title('c. Standardised University International Demand (!s_aus_std)', fontsize=14, pad=15, fontweight='bold')\naxs[1, 0].set_axis_off()\n\n# d. Standardised University Demand Influence (!s_aus_slag_std)\nmax_abs_value = max(abs(uni_c['!s_aus_slag_std'].min()), abs(uni_c['!s_aus_slag_std'].max()))\nvmin, vmax = -max_abs_value, max_abs_value\npgr.plot(ax=axs[1, 1], facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nbz.plot(ax=axs[1, 1], facecolor='none', edgecolor='#999999', linewidth=0.75)\nout.plot(ax=axs[1, 1], facecolor='none', edgecolor='#666666', linewidth=1)\nuni_c.plot(ax=axs[1, 1],\n          column='!s_aus_slag_std',\n          cmap=cmap_mintpi,\n          markersize=np.sqrt(np.abs(uni_c['!s_aus_slag_std'])),\n          alpha=0.9,\n          edgecolor='white',\n          linewidth=0.3,\n          legend=True,\n          legend_kwds={'shrink': 0.6, 'label': \"standardised university international demand spatial lag\"},\n          vmin=vmin,\n          vmax=vmax)\naxs[1, 1].legend(loc='lower center', ncol=2, frameon=False, prop={'size': 10})\naxs[1, 1].set_title('d. Standardised University International Demand Influence (!s_aus_slag_std)', fontsize=14, pad=15, fontweight='bold')\naxs[1, 1].set_axis_off()\n\nsave_path = os.path.join(hf, \"Stages of Preparing Higher Education Universities International Students Demand Data.png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"wiOoiPmIZe"},{"type":"outputs","id":"P2w1KaT1zgYs-teeu4wT7","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"73a5cb0b0987c775b9177c49175dab20","path":"/rethinking_student_housing/build/73a5cb0b0987c775b9177c49175dab20.png"},"text/plain":{"content":"\u003cFigure size 1800x1200 with 8 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"WczIzPVzHy"}],"visibility":"show","key":"Y8BVfqVe7b"}],"visibility":"show","key":"VsryloXpfs"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Stages of Preparing Higher Education Universities International Students Demand Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bV7BQb0RA3"}],"key":"NO7bElGOin"}],"key":"r2yygtXCdh"}],"key":"Jf5hfltZ49"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Moran’s graph (Figure XX) visualises the spatial relationships between standardised international university demand (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZTZSsken0T"},{"type":"inlineCode","value":"!s_aus_std","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MjcaWFsdgw"},{"type":"text","value":") and its spatial lag (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VEoGtnQNw8"},{"type":"inlineCode","value":"!s_aus_slag_std","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BBzIVj8WnR"},{"type":"text","value":"). The division into four quadrants allows us to identify characteristic spatial patterns of demand distribution and understand where areas of high competition or, conversely, a lack of educational attractiveness are forming.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KTi8kARscf"}],"key":"HX45BRlHb9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Q1 – High–High (HH)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ksybHevko8"}],"key":"XcRbHgVcNr"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QUEcfu7YUb"},{"type":"text","value":"These are clusters of high international demand, where universities with a large proportion of foreign students are located next to similarly significant neighbours. Such areas form stable ‘magnets’ for international students, for example, the College of Business and Law (HWR – 1,336 foreign students), the University of the Arts Berlin (UKB – 1,244 foreign students), and ESCP Business School Berlin (ESCP – 1,092 foreign students). At the same time, two of the three universities in the HH quadrant are publicly owned (HWR and UKB) and located in Willensdorf, while the private ESCP University is located in Charlottenburg. These three universities form a powerful spatial core of global education in West Berlin.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aY2d4HnrVm"}],"key":"Ow6MprV1AI"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Q2 – High–Low (HL)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"rG1byNwN1C"}],"key":"K7cqwUOLlV"},{"type":"break","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UgMpFgzFmS"},{"type":"text","value":"Spatial anomalies, where a university with high international demand is located among neighbouring universities with low values. This is the largest cluster among all universities. It mainly consists of individual private universities that have a localised impact and signal the beginning of the formation of new educational centres. Among the universities belonging to the HL cluster but funded by the state are the Technical University of Berlin, the Protestant University of Applied Sciences Berlin, and the Charité – University Medicine Berlin campuses in the south-west of the city.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"kODkYrBsJw"}],"key":"Sicri3vPV4"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Q3 – Low–Low (LL)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"XYd5BHy4Z2"}],"key":"bfgUdoilOi"},{"type":"break","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lZ1FmLfdYy"},{"type":"text","value":"Clusters of low demand, where both the university itself and its surroundings attract relatively few foreign students. LL zones indicate areas where international educational activity is weak, such as Pankow, Lichtenberg, Friedrichshain-Kreuzberg, and Neukölln. Among the reasons for unrealised educational potential, one can assume a lack of infrastructure, limited academic activity, or weak integration into the city’s structure.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rX5b7WxIu4"}],"key":"YwpKTAJWCz"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Q4 – Low–High (LH)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"tkFs3weSRn"}],"key":"TSaV5zWdBt"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"iAqxUci9en"},{"type":"text","value":"These are local failures, where a university demonstrates low international demand, but its environment demonstrates high demand. At the same time, seven of the nine universities in the LH quadrant are publicly owned. Universities such as the Free University of Berlin and Humboldt University of Berlin have the potential to participate in existing educational clusters, but are not yet strategically integrated into them.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"n4m5NuFcYI"}],"key":"ZCpbWSi33Z"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"This distribution indicates competition between universities, the existence of ‘hot spots’ of international activity, and, at the same time, structural territorial gaps.\nAll these patterns are important for studying the student housing crisis, as international demand directly correlates with increased pressure on the rental market, especially in highly attractive local clusters.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fsQN4gQpU5"}],"key":"xht8tQixU2"}],"key":"ku25GtmglB"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"f, ax = plt.subplots(1, figsize=(6, 6))\n\nscatter = ax.scatter(\n    x=uni_c['!s_aus_std'],\n    y=uni_c['!s_aus_slag_std'],\n    c=colors,\n    s=40,\n    edgecolor='white',\n    linewidth=0.3\n)\n\nsns.regplot(\n    x='!s_aus_std',\n    y='!s_aus_slag_std',\n    ci=None,\n    data=uni_c,\n    scatter=False,\n    line_kws={\"color\":'#cccccc', \"linewidth\": 2},\n    ax=ax\n)\n\nax.axvline(0, color='#cccccc', alpha=0.75, linestyle=\"--\")\nax.axhline(0, color='#cccccc', alpha=0.75, linestyle=\"--\")\n\nax.set_title(\"Moran Scatterplot: Standardised University International Demand\", fontsize=12, weight='bold')\nax.set_xlabel(\"standardised university international demand (!s_aus_std)\", fontsize=10)\nax.set_ylabel(\"spatial lag of standardised university international demand (!s_aus_slag_std)\", fontsize=10)\n\nax.text(4200, 600, \"High–High (HH)\", fontsize=9, color=\"gray\")\nax.text(4200, -300, \"Low–High (LH)\", fontsize=9, color=\"gray\") \nax.text(-500, -300, \"Low–Low (LL)\", fontsize=9, color=\"gray\") #\nax.text(-500, 600, \"High–Low (HL)\", fontsize=9, color=\"gray\") #\n\n\nax.set_xlim(uni_c['!s_aus_std'].min() - 0.5, uni_c['!s_aus_std'].max() + 0.5)\nax.set_ylim(uni_c['!s_aus_slag_std'].min() - 0.5, uni_c['!s_aus_slag_std'].max() + 0.5)\n\nsave_path = os.path.join(hf, \"Higher Education Universities International Students Demand Moran Scatterplot.png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"ba05mB9ofW"},{"type":"outputs","id":"1yKp2UOCcGvU_fSSh97yh","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"47929ea370dde2f6c07b52081df23282","path":"/rethinking_student_housing/build/47929ea370dde2f6c07b52081df23282.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"zev0iMbwzT"}],"visibility":"show","key":"Nusa4c78Q1"}],"visibility":"show","key":"e5xVLLJ5Vi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Higher Education Universities International Students Demand Moran Scatterplot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ppx2yRrDCI"}],"key":"WC5saHNWWp"}],"key":"uAW1xnObjN"}],"key":"sne3ob59xV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The map showing the spatial distribution of international student demand in Berlin (Figure XX) reveals that, unlike the supply of student housing, demand does not form stable clusters of high concentration. Instead of the expected spatial agglomeration around large public universities, there is a dispersion (scattering) of values. In other words, universities with high numbers of international students are not grouped geographically, but rather distributed in a fragmented manner and often separated from similar neighbours.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MdyAXP85ox"}],"key":"LGldL01ODs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The east-west divide highlights Berlin’s historical asymmetry: the West traditionally concentrates international academic demand, while the East remains unattractive in an international context.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NHj2I9vMM9"}],"key":"yqPoBTxKGH"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The demand for international students is distributed more chaotically and does not correlate with the spatial patterns of student housing supply, which exacerbates the structural imbalance between the housing market and the city’s academic infrastructure.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"k42VK9gybm"}],"key":"rHkhZPZ4JA"}],"key":"nn4P2RIHLy"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(figsize=(12, 12))\n\n# Replace pgr, bz, out with your base layers if needed\npgr.plot(ax=ax, facecolor='none', edgecolor='#cccccc', linewidth=0.5, linestyle=\"--\")\nmauer.plot(ax=ax, facecolor='none', edgecolor='#666666', linewidth=1.25, linestyle=\"--\")\nbz.plot(ax=ax, facecolor='none', edgecolor='#999999', linewidth=0.75)\nfor idx, row in bz.iterrows():\n    centroid = row['geometry'].centroid\n    txt = ax.text(\n        centroid.x, centroid.y,\n        str(row['namgem']),\n        fontsize=8, color='#666666', ha='center', va='center'\n    )\n    txt.set_path_effects([\n        path_effects.Stroke(linewidth=2, foreground='white'),\n        path_effects.Normal()\n    ])\n\nout.plot(ax=ax, facecolor='none', edgecolor='#666666', linewidth=1.25)\n\nuni_c.plot(ax=ax,\n           color=uni_c['color'],\n           markersize=np.sqrt(np.abs(uni_c['!s_aus_std'])) + 5,\n           alpha=0.9,\n           edgecolor='white',\n           linewidth=0.3)\n\nlegend_elements = [\n    mpatches.Patch(color='#F08080', label='High-High (HH)', edgecolor='none'),\n    mpatches.Patch(color='#FCD5CE', label='High-Low (HL)', edgecolor='none'),\n    mpatches.Patch(color='#C8E0D4', label='Low-High (LH)', edgecolor='none'),\n    mpatches.Patch(color='#5F968E', label='Low-Low (LL)', edgecolor='none'), \n    mpatches.Patch(color='#FBF0EA', label='Not Significant (NS)', edgecolor='#FAE1DD'), \n]\n\nuni_c['color'] = colors\nuni_c['cluster'] = clusters\n\nax.legend(handles=legend_elements, loc='lower center', ncol=5, frameon=False, prop={'size': 10})\nax.set_title('Higher Education Universities International Demand Dispersion in Berlin', fontsize=16, weight='bold')\nax.set_axis_off()\n\nsave_path = os.path.join(hf, \"Higher_Education_Universities_International_Demand_Dispersion_in_Berlin.png\")\nplt.savefig(save_path, dpi=300, bbox_inches=\"tight\")\n\nplt.tight_layout()\nplt.show()","visibility":"remove","key":"KdZLGAnaXl"},{"type":"outputs","id":"OJw8OysNqNtTNl0wF8lco","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a85dd59dcba412f1eb12e8c283df7834","path":"/rethinking_student_housing/build/a85dd59dcba412f1eb12e8c283df7834.png"},"text/plain":{"content":"\u003cFigure size 1200x1200 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"G3bLAW3zxT"}],"visibility":"show","key":"zneZWRY1bR"}],"visibility":"show","key":"vyXrw3cC1e"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure XX. Higher Education Universities International Demand Dispersion in Berlin","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F0NbvkXtKR"}],"key":"AmLjD1MUYe"}],"key":"ARLpqSCsAi"}],"key":"NyuT2CFP8X"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Export","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QwdjZP6QJ1"}],"identifier":"data-export","label":"Data Export","html_id":"data-export-1","implicit":true,"key":"dW7uhgCrEB"}],"key":"TMhdNj0LqM"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# List of columns to drop\ncols_to_drop = [f'!s_aus_slag_std_k{i}' for i in range(1, 21)]\n\n# Drop them from the GeoDataFrame\nuni_c = uni_c.drop(columns=cols_to_drop)","visibility":"show","key":"yVFqAtU5wW"},{"type":"outputs","id":"XwFokobSKHI2IoUBYH8kJ","children":[],"visibility":"show","key":"oGBQKyq1Bz"}],"visibility":"remove","key":"Bb1LekmXup"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The data on higher education universities’ international students demand obtained as a result of global spatial autocorrelation was collected for further market analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G0XCAmGZAj"}],"key":"jKJBZrU056"}],"key":"sTvFDLk4r3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hf = r'../outputs/2.4_global_spatial_autocorrelation/uni_int_demand_analysis.gpkg'\nuni_c.to_file(hf, driver=\"GPKG\")","key":"IAN39trwg8"},{"type":"outputs","id":"4aoCI6blxcW7nnyli4uFo","children":[],"key":"ypl46ZJj4k"}],"key":"NcUT1HYOae"}],"key":"i375WGU6ik"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"2.3 Descriptive Market Statistics","url":"/notebooks/descriptive-market-statistics","group":"2. Capacities, Demand \u0026 Spatial Distribution"},"next":{"title":"3.1 Overview","url":"/notebooks/overview-1","group":"3. Student Housing Market Imbalance"}}},"domain":"http://localhost:3000"},"project":{"bibliography":["references.bib"],"exports":[],"title":"Rethinking Student Housing in Berlin","authors":[{"nameParsed":{"literal":"Lazareva Nataliia","given":"Lazareva","family":"Nataliia"},"name":"Lazareva Nataliia","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Urban Design M.Sc.","given":"Urban Design","family":"M.Sc."},"name":"Urban Design M.Sc.","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Technical University of Berlin","given":"Technical University","non_dropping_particle":"of","family":"Berlin"},"name":"Technical University of Berlin","id":"contributors-myst-generated-uid-2"}],"github":"https://github.com/natashlazarpro/rethinking_student_housing","copyright":"2025","toc":[{"file":"intro.md"},{"children":[{"file":"notebooks/0.1_title_page.md"},{"file":"markdowns/0.2_table_of_contens.md"},{"file":"notebooks/0.3_list_of_figures.ipynb"},{"file":"notebooks/0.4_list_of_tables.ipynb"}],"title":"0. Prelimitary Pages"},{"children":[{"file":"notebooks/1.1_european_student_accommodation_crisis.ipynb"},{"file":"notebooks/1.2_berlin_housing_crisis_history.md"},{"file":"notebooks/1.3_theoretical_framework.md"},{"file":"notebooks/1.4_rethinking_student_housing.md"}],"title":"1. Introduction"},{"children":[{"file":"notebooks/2.1_overview.md"},{"file":"notebooks/2.2_urban_data_mining.ipynb"},{"file":"notebooks/2.3_descriptive_market_statistics.ipynb"},{"file":"notebooks/2.4_global_spatial_autocorrelation.ipynb"}],"title":"2. Capacities, Demand \u0026 Spatial Distribution"},{"children":[{"file":"notebooks/3.1_overview.md"},{"file":"notebooks/3.2_central_place_analysis.ipynb"},{"file":"notebooks/3.3_market_pressure_analysis.ipynb"}],"title":"3. Student Housing Market Imbalance"},{"children":[{"file":"notebooks/4.1_overview.md"},{"file":"notebooks/4.2_students_needs_and_preferences.ipynb"},{"file":"notebooks/4.3_students_experiences.ipynb"}],"title":"4. Students Behind the Numbers"},{"children":[{"file":"notebooks/5.1_conclusion.md"},{"file":"notebooks/5.2_discussion.md"},{"file":"notebooks/5.3_future_research.md"}],"title":"5. Data-Driven Decisions"},{"children":[{"file":"notebooks/6.1_references.ipynb"},{"file":"notebooks/xx_materials_and_data.ipynb"},{"file":"notebooks/xx_behavioral_study"},{"file":"notebooks/xx_color_palettes.ipynb"}],"title":"6. Appendix"}],"index":"index","pages":[{"level":1,"title":"0. Prelimitary Pages"},{"slug":"notebooks.title-page","title":"0.1 Title Page","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdowns.table-of-contens","title":"0.2 Table of Contents","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.list-of-figures","title":"0.3 List of Figures","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.list-of-tables","title":"0.4 List of Tables","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"1. Introduction"},{"slug":"notebooks.european-student-accommodation-crisis","title":"1.1 European Student Accommodation Crisis","description":"","date":"","thumbnail":"/rethinking_student_housing/build/countries_map-714d24d02c18e6dbce203f91f0a0c573.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.berlin-housing-crisis-history","title":"1.2 Berlin Housing Crisis History","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.theoretical-framework","title":"1.3 Theoretical Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.rethinking-student-housing","title":"1.4 Rethinking Student Housing in Berlin","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2. Capacities, Demand \u0026 Spatial Distribution"},{"slug":"notebooks.overview","title":"2.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.urban-data-mining","title":"2.2 Urban Data Mining","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.descriptive-market-statistics","title":"2.3 Descriptive Market Statistics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.global-spatial-autocorrelation","title":"2.4 Global Spatial Autocorrelation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"3. Student Housing Market Imbalance"},{"slug":"notebooks.overview-1","title":"3.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.central-place-analysis","title":"3.2 Central Place Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.market-pressure-analysis","title":"3.3 Market Pressure Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"4. Students Behind the Numbers"},{"slug":"notebooks.overview-2","title":"4.1 Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.students-needs-and-preferences","title":"4.2 Student Needs and Preferences","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.students-experiences","title":"4.3 Student Experiences","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"5. Data-Driven Decisions"},{"slug":"notebooks.conclusion","title":"5.1 Conclusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.discussion","title":"5.2 Reflection","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.future-research","title":"5.3 Future Research","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"6. Appendix"},{"slug":"notebooks.references","title":"6.1 References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.xx-materials-and-data","title":"Material \u0026 Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.xx-color-palettes","title":"Colour Palettes Design","description":"","date":"","thumbnail":"/rethinking_student_housing/build/color_test-b14dc3465d49509a7b93f53f06a18503.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/rethinking_student_housing/build/manifest-7B0967AD.js";
import * as route0 from "/rethinking_student_housing/build/root-EDJFWIEV.js";
import * as route1 from "/rethinking_student_housing/build/routes/$-AD65NCUT.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/rethinking_student_housing/build/entry.client-PCJPW7TK.js");</script></body></html>